<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [JDEV] [az at ftc.ru: [jabberd] jabberd crashes]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5BJDEV%5D%20%5Baz%40ftc.ru%3A%20%5Bjabberd%5D%20jabberd%20crashes%5D&In-Reply-To=%3C20030105033931.GA16310%40reks.ftc.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="073998.html">
   <LINK REL="Next"  HREF="073996.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[JDEV] [az at ftc.ru: [jabberd] jabberd crashes]</H1>
    <B>Eugeny Korekin</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5BJDEV%5D%20%5Baz%40ftc.ru%3A%20%5Bjabberd%5D%20jabberd%20crashes%5D&In-Reply-To=%3C20030105033931.GA16310%40reks.ftc.ru%3E"
       TITLE="[JDEV] [az at ftc.ru: [jabberd] jabberd crashes]">az at ftc.ru
       </A><BR>
    <I>Sat Jan  4 21:39:31 CST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="073998.html">[JDEV] client to client communication using jabber?
</A></li>
        <LI>Next message: <A HREF="073996.html">[JDEV] Parsing of jabber.xml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73990">[ date ]</a>
              <a href="thread.html#73990">[ thread ]</a>
              <a href="subject.html#73990">[ subject ]</a>
              <a href="author.html#73990">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>----- Forwarded message from Eugeny Korekin &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">az at ftc.ru</A>&gt; -----

Date: Sat, 4 Jan 2003 16:12:49 +0600
From: Eugeny Korekin &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">az at ftc.ru</A>&gt;
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jabberd at jabberstudio.org</A>
Subject: [jabberd] jabberd crashes
Delivered-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">az at localhost.ftc.ru</A>
Delivered-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jabberd at jabberstudio.org</A>
X-OriginalArrivalTime: 04 Jan 2003 10:12:49.0602 (UTC) FILETIME=[D5CC8220:01C2B3D9]
X-MailScanner: Found to be clean
X-MailScanner-SpamCheck: 
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jabberd at jabberstudio.org</A>

I have jabberd 1.4.2 on solaris 8(sparc), and it crashes often.
Here is one of backtraces:

...
This GDB was configured as &quot;sparc-sun-solaris2.8&quot;...
Core was generated by `jabberd/jabberd -D -B -h im.ftc.ru'.
Program terminated with signal 6, Abort.
...
(gdb) bt
#0  0xff01bed4 in _libc_kill () from /usr/lib/libc.so.1
#1  0xfefb57c4 in abort () from /usr/lib/libc.so.1
#2  0x25f78 in pmalloc (p=0x0, size=16) at pool.c:168
#3  0x2a6d4 in spool_new (p=0x0) at str.c:119
#4  0x239cc in jid_full (id=0x2e85b8) at jid.c:167
#5  0x20e60 in xdb_act (xc=0xb9580, owner=0x2e85b8, 
    ns=0xfef60c00 &quot;jabber:iq:auth&quot;, act=0xfef60c10 &quot;check&quot;, match=0x0, 
    data=0x563fd8) at xdb.c:277
#6  0xfef4e42c in mod_auth_plain_jane (m=0x1d0518, arg=0x0)
    at mod_auth_plain.c:70
#7  0xfef47b14 in js_mapi_call (si=0xba080, e=5, packet=0x564eb0, 
    user=0x5ed998, s=0x0) at modules.c:160
#8  0xfef48184 in js_authreg (arg=0x564eb0) at authreg.c:70
#9  0x2130c in mtq_main (arg=0xe7f20) at mtq.c:151
#10 0xff3069c0 in pth_spawn_trampoline () from /usr/local/lib/libpth.so.14

in frame #8:
(gdb) p user-&gt;id-&gt;user    
$2 = 0x0

Is that wrong?

In the end of debug log:
Sat Jan  4 10:23:40 2003  mio.c:620 mio while loop, working
Sat Jan  4 10:23:40 2003  mio.c:380 _mio_accept calling accept on fd #9
Sat Jan  4 10:23:40 2003  mio_ssl.c:238 SSL accepting socket with new session 3f5bc8
Sat Jan  4 10:23:40 2003  mio_ssl.c:251 Accept blocked, returning
Sat Jan  4 10:23:40 2003  mio.c:407 new socket accepted (fd: 53, ip: 172.16.254.163, port: 1321)
Sat Jan  4 10:23:40 2003  mio.c:607 mio while loop top
Sat Jan  4 10:23:40 2003  mio.c:620 mio while loop, working
Sat Jan  4 10:23:40 2003  mio.c:607 mio while loop top
Sat Jan  4 10:23:40 2003  mio.c:620 mio while loop, working
Sat Jan  4 10:23:40 2003  mio.c:760 MIO read from socket 24: &lt;xdb id='274' type='error' to='sessions' from='xdb_auth_cpile' ns='jabber:iq:auth'/&gt;
Sat Jan  4 10:23:40 2003  base_accept.c:120 process XML: m:24F878 state:3, arg:B1868, x:976758
Sat Jan  4 10:23:40 2003  deliver.c:474 DELIVER 1:sessions &lt;xdb id='274' type='error' to='sessions' from='xdb_auth_cpile' ns='jabber:iq:auth'/&gt;
Sat Jan  4 10:23:40 2003  deliver.c:678 delivering to instance 'sessions'
Sat Jan  4 10:23:40 2003  xdb.c:52 xdb_results checking xdb packet &lt;xdb id='274'
type='error' to='sessions' from='xdb_auth_cpile' ns='jabber:iq:auth'/&gt;
Memory Leak! [pmalloc received NULL pool, unable to track allocation, exiting]
Debug output is enabled, can not background.
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">sol at im.ftc.ru</A>/&#1087;&#9552;&#1087;&#9567;&#1087;&#9568;&#1087;&#9580;&#1103;&#1087;&#9567;
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">garry at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">larin at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">tata at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">marti at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">green at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">ollyak at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">epanch at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">AndikD at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">Igorl at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">sakhapov at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">taxapark at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">Slavik at im.ftc.ru</A>/Just another jabber client
New session for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hlodvig at im.ftc.ru</A>/Just another jabber client
Sat Jan  4 10:23:41 2003  dnsrv.c:155 dnsrv: Read error on coprocess(1): 9 Bad file number
Sat Jan  4 10:23:41 2003  dnsrv.c:169 DNSRV CHILD: out of loop.. exiting normal
Debug output is enabled, can not background.
 

We are dying from abort() in pmalloc, which receives 0 as arg.

I am using module xdb_auth_cpile module to autentificate users trough ldap, does that matters?
xdb_auth_cpile is separate process, which sends and receives messages to/from jabberd

at the end of xdb_auth_cpile debug log:
SEND: &lt;xdb id='274' type='error' to='sessions' from='xdb_auth_cpile' ns='jabber:iq:auth'/&gt;
startTag: creating new node for xdb
dispatching xdb
SEND: &lt;xdb id='275' type='error' to='sessions' from='xdb_auth_cpile' ns='jabber:iq:auth'/&gt;
RECV: &lt;xdb type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">nasedkin at im.ftc.ru</A>' from='sessions' ns='jabber:iq:auth' id='276'/&gt;&lt;xdb type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">srg at im.ftc.ru</A>' from='sessions' ns='jabber:iq:auth' id='277'/&gt;&lt;xdb type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">ustas at im.ftc.ru</A>' from='sessions' ns='jabber:iq:auth' id='278'/&gt;&lt;xdb type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">yulia at im.ftc.ru</A>' from='sessions' ns='jabber:iq:auth' id='279'/&gt;&lt;xdb type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">shus at im.ftc.ru</A>' from='sessions' ns='jabber:iq:auth' id='280'/&gt;
startTag: creating new node for xdb
dispatching xdb
SEND: &lt;xdb id='276' type='result' to='sessions' from='xdb_auth_cpile' ns='jabber:iq:auth'&gt;&lt;query xmlns='jabber:iq:auth'/&gt;&lt;/xdb&gt;
send: Cannot determine peer address at /usr/local/lib/perl5/site_perl/5.6.1/Jabber/Connection.pm line 402

i think, xdb_auth_cpile sees, that jabberd are dead and dies too.

WBW, Eugeny &lt;az at ftc ru&gt;
_______________________________________________
Jabberd mailing list
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">Jabberd at jabberstudio.org</A>
<A HREF="http://jabberstudio.org/cgi-bin/mailman/listinfo/jabberd">http://jabberstudio.org/cgi-bin/mailman/listinfo/jabberd</A>

----- End forwarded message -----
WBW, Eugeny &lt;az at ftc ru&gt;

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="073998.html">[JDEV] client to client communication using jabber?
</A></li>
	<LI>Next message: <A HREF="073996.html">[JDEV] Parsing of jabber.xml
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#73990">[ date ]</a>
              <a href="thread.html#73990">[ thread ]</a>
              <a href="subject.html#73990">[ subject ]</a>
              <a href="author.html#73990">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
