<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] last presence confusion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20last%20presence%20confusion&In-Reply-To=%3C476AF21A.5000201%40stpeter.im%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="085461.html">
   <LINK REL="Next"  HREF="085463.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] last presence confusion</H1>
    <B>Peter Saint-Andre</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20last%20presence%20confusion&In-Reply-To=%3C476AF21A.5000201%40stpeter.im%3E"
       TITLE="[jdev] last presence confusion">stpeter at stpeter.im
       </A><BR>
    <I>Thu Dec 20 16:52:10 CST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="085461.html">[jdev] Jabber Live meeting?
</A></li>
        <LI>Next message: <A HREF="085463.html">[jdev] last presence confusion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#85462">[ date ]</a>
              <a href="thread.html#85462">[ thread ]</a>
              <a href="subject.html#85462">[ subject ]</a>
              <a href="author.html#85462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Someone pinged me via IM about XEP-0012 and last unavailable presence,
but promptly disappeared so I was not able to reply to him. Since
perhaps his confusion is common, I figured I would post his message here:

***

Displaying status messages of offline contacts is very, very useful. At
start, client sends only a presence=available information to server and
then server sends it to all contacts in roster. But I think server
should also send a jabber:iq:last request - without this functionality
client has 2 options - either to send jabber:iq:last requests to all
contacts in roster manually (but it's simply flooding the server!) or
not to do it at all (causing people unable to see status messages of
offline contacts at all, which is not very nice).
ejabberd uses this XEP, so a problem is very common

***

This reflects a misunderstanding of core XMPP functionality. In
particular see this text in rfc3921bis:

4.3.2.  Server Processing of Inbound Presence Probe

   Upon receiving a presence probe from the user's server on behalf of
   the user, the contact's server SHOULD reply as follows:

&lt;snip/&gt;

   2.  Else, if the contact has no available resources, the server MUST
       either (1) reply to the presence probe by sending to the user the
       full XML of the last presence stanza of type &quot;unavailable&quot;
       received by the server from the contact, or (2) not reply at all.

So a nice server will return the last unavailable presence information
(with a Delayed Delivery flag), thus obviating the need for a flood of
jabber:iq:last requests.

Peter

-- 
Peter Saint-Andre
<A HREF="https://stpeter.im/">https://stpeter.im/</A>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 7338 bytes
Desc: S/MIME Cryptographic Signature
URL: &lt;<A HREF="https://www.jabber.org/jdev/attachments/20071220/5450cfd3/attachment-0002.bin">https://www.jabber.org/jdev/attachments/20071220/5450cfd3/attachment-0002.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="085461.html">[jdev] Jabber Live meeting?
</A></li>
	<LI>Next message: <A HREF="085463.html">[jdev] last presence confusion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#85462">[ date ]</a>
              <a href="thread.html#85462">[ thread ]</a>
              <a href="subject.html#85462">[ subject ]</a>
              <a href="author.html#85462">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
