<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [JDEV] Source Code of JabberIM
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=%5BJDEV%5D%20Source%20Code%20of%20JabberIM&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006355.html">
   <LINK REL="Next"  HREF="006358.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[JDEV] Source Code of JabberIM</H1>
    <B>saradhi</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=%5BJDEV%5D%20Source%20Code%20of%20JabberIM&In-Reply-To="
       TITLE="[JDEV] Source Code of JabberIM">saradhi at virnt
       </A><BR>
    <I>Sat Feb 24 05:32:22 CST 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="006355.html">[JDEV] s2s configuratoin
</A></li>
        <LI>Next message: <A HREF="006358.html">[JDEV] Source Code of JabberIM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6357">[ date ]</a>
              <a href="thread.html#6357">[ thread ]</a>
              <a href="subject.html#6357">[ subject ]</a>
              <a href="author.html#6357">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can i get the Source Code of JabberIM Client in C++/VC++????

SARADHI

*****  GOD WON'T ASK WHAT YOUR JOB TITLE WAS, BUT WILL ASK IF YOU PERFORMED
YOUR JOB TO THE BEST OF YOUR ABILITY  *****


-----Original Message-----
From: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-admin at jabber.org</A> [mailto:<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-admin at jabber.org</A>]
Sent: Tuesday, February 20, 2001 11:30 PM
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Subject: jdev digest, Vol 1 #660 - 14 msgs



Send jdev mailing list submissions to
	<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

To subscribe or unsubscribe via the web, visit
	<A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>
or, via email, send a message with subject or body 'help' to
	<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-request at jabber.org</A>
You can reach the person managing the list at
	<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-admin at jabber.org</A>

When replying, please edit your Subject line so it is more specific than
&quot;Re: Contents of jdev digest...&quot;


Today's Topics:

  1. Re: RSS-Transport (Peter Saint-Andre)
  2. Software plan (Jakob Nanneson)
  3. Flash 5 &amp; Jabber question redux (Drash, Jim [EESUS])
  4. Auto Account Creation (Michael Bauer)
  5. RE: Auto Account Creation (Todd Bradley)
  6. Re: Online status on a webpage (Kok Leong)
  7. Regarding The Source Code of the Development Server (saradhi)
  8. Jabber DevZone News - jer - Win32 Server Port? (Jabber DevZone)
  9. [patch users.c] (Rodolphe Duge de Bernonville)
  10. [patch mod_presence.c] (Rodolphe Duge de Bernonville)
  11. Bug in base_accpet? (Gang Liu)
  12. Re: Regarding The Source Code of the Development Server (Peter
Saint-Andre)
  13. Re: Regarding The Source Code of the Development Server (Michael
Wilson)
  14. [patch client.c] (Rodolphe Duge de Bernonville)

--__--__--

Message: 1
Date: Mon, 19 Feb 2001 11:29:21 -0700
From: Peter Saint-Andre &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">stpeter at jabber.org</A>&gt;
Organization: <A HREF="http://www.jabber.org/">http://www.jabber.org/</A>
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Subject: Re: [JDEV] RSS-Transport
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

Last I heard was this:

<A HREF="http://mailman.jabber.org/pipermail/jdev/2001-February/005035.html">http://mailman.jabber.org/pipermail/jdev/2001-February/005035.html</A>

Peter

--
Peter Saint-Andre
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">stpeter at jabber.org</A>

Robert Temple wrote:
&gt;<i> 
</I>&gt;<i> Whats the status of this transport?   Is there one that works with 1.4?
</I>&gt;<i> -Robert
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> jdev mailing list
</I>&gt;<i> <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> <A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>
</I>
--__--__--

Message: 2
From: &quot;Jakob Nanneson&quot; &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jakob at rum65.com</A>&gt;
To: &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>&gt;
Date: Mon, 19 Feb 2001 21:08:47 +0100
charset=&quot;iso-8859-1&quot;
Subject: [JDEV] Software plan
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

Hi.

I have from time to time under a couple of months written a little plan of
how an &quot;instant messenger model icq&quot;-software could look like. What
functions that people wants and so on. I'm very pleased with my work but a
long time I didn't know where to use my thoughts, then I found Jabber - a
great idea, but the software I've seen isn't too good. Somehow I want to
develop a program for the system, but I don't know how... I'm not really in
to that programming thing. But I'll keep checking out Jabber so maybe I'll
be back soon with some questions.

/jakob.


--__--__--

Message: 3
From: &quot;Drash, Jim [EESUS]&quot; &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">JDrash at EESUS.JNJ.com</A>&gt;
To: &quot;Jabber-Dev (E-mail)&quot; &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at mailman.jabber.org</A>&gt;
Date: Mon, 19 Feb 2001 15:58:00 -0500
boundary=&quot;----_=_NextPart_001_01C09AB6.A4848ED0&quot;
Subject: [JDEV] Flash 5 &amp; Jabber question redux
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

This message is in MIME format. Since your mail reader does not understand
this format, some or all of this message may not be legible.

------_=_NextPart_001_01C09AB6.A4848ED0
Content-Type: text/plain;
	charset=&quot;iso-8859-1&quot;

I have not seen the answer to this question:

	Since Flash 5 and Jabber do different things relative to XML (DOM
vs. SAX, respectively &lt;as I understand it&gt;), would it not be possible to
write a transport for Jabber to handle this stuff? If so, is anyone looking
at this?  Please excuse my ignorance, if this has already been asked and
answered. So far, what parts of the mailing list archive I have browsed,
have decried the fact that such a thing did not exist in Jabber already (and
I guess some folks were expecting it in Jabber 1.4).

Thanks in advance,
jim drash


------_=_NextPart_001_01C09AB6.A4848ED0
Content-Type: text/html;
	charset=&quot;iso-8859-1&quot;
Content-Transfer-Encoding: quoted-printable

&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2//EN&quot;&gt;
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;META HTTP-EQUIV=3D&quot;Content-Type&quot; CONTENT=3D&quot;text/html; =
charset=3Diso-8859-1&quot;&gt;
&lt;META NAME=3D&quot;Generator&quot; CONTENT=3D&quot;MS Exchange Server version =
5.5.2654.19&quot;&gt;
&lt;TITLE&gt;Flash 5 &amp;amp; Jabber question redux&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;I have not seen the answer to this =
question:&lt;/FONT&gt;
&lt;/P&gt;

&lt;P&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;FONT SIZE=3D2 =
FACE=3D&quot;Arial&quot;&gt;Since Flash 5 and Jabber do different things relative to =
XML (DOM vs. SAX, respectively &amp;lt;as I understand it&amp;gt;), would it =
not be possible to write a transport for Jabber to handle this stuff? =
If so, is anyone looking at this?&amp;nbsp; Please excuse my ignorance, if =
this has already been asked and answered. So far, what parts of the =
mailing list archive I have browsed, have decried the fact that such a =
thing did not exist in Jabber already (and I guess some folks were =
expecting it in Jabber 1.4).&lt;/FONT&gt;&lt;/P&gt;

&lt;P&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;Thanks in advance,&lt;/FONT&gt;
&lt;BR&gt;&lt;FONT SIZE=3D2 FACE=3D&quot;Arial&quot;&gt;jim drash&lt;/FONT&gt;
&lt;/P&gt;

&lt;/BODY&gt;
&lt;/HTML&gt;
------_=_NextPart_001_01C09AB6.A4848ED0--

--__--__--

Message: 4
Date: Mon, 19 Feb 2001 16:53:13 -0700
From: Michael Bauer &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">bauer at jabber.com</A>&gt;
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Subject: [JDEV] Auto Account Creation
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>


How would you go about automatically creating accounts for all other IM
services (AIM, Yahoo, etc) you don't currently have and to hide them so
a user would never have to know about any other account other than their
Jabber account?

--__--__--

Message: 5
From: Todd Bradley &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">TBradley at jabber.com</A>&gt;
To: &quot;'<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>'&quot; &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>&gt;
Subject: RE: [JDEV] Auto Account Creation
Date: Mon, 19 Feb 2001 17:17:47 -0700
charset=&quot;iso-8859-1&quot;
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

&gt;<i> How would you go about automatically creating accounts for 
</I>&gt;<i> all other IM
</I>&gt;<i> services (AIM, Yahoo, etc) 
</I>
That sounds like a tough one.  Since these IM
services generally allow account creation through
a web interface, the only way I can think of to
do that is this:

Look at the web pages to register accounts for
these other IM systems.  At some point, there
are probably HTML forms getting submitted.  You
could write a script to interact with the IM's
webserver directly and submit those forms with
whatever field values you choose.

This would break whenever Yahoo (or whoever)
changes their web registration.  It would also
be illegal, because all the other IM systems
require you to &quot;read&quot; and accept a terms of
service agreement.  This script would be im-
personating that user and accepting the terms
on their behalf.  I suppose you might get
around that by presenting the new Jabber user
with the terms of service from each of the
other IM systems and have them accept them all
en masse.  But I'm no lawyer.

Besides, even if you could legally do this, 
you'd probably piss Yahoo (or whoever) off
if you did it without their permission.  By 
hiding the Yahoo account from the Jabber user,
Yahoo wouldn't be getting any benefit from the
arrangement.

Technically, I suppose one other way to do this
is reverse engineer the other IM protocol to see
the data stream they send to register a new user.
Then, rather than manipulating a web page, you
could write a program to spoof that data stream.
This should be possible with any IM system that 
has a standalone client app, unless it requires
you to reply to an email verification or some-
thing.  I'd imagine Yahoo would be just as un-
happy at you spoofing a new user registration
data stream as they'd be if you spoofed their
web registration forms.


Todd.

--__--__--

Message: 6
Date: Tue, 20 Feb 2001 08:51:20 +0800
From: Kok Leong &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">chan.kok.leong at biztone.com</A>&gt;
Organization: Biztone.Com
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Subject: Re: [JDEV] Online status on a webpage
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

*This message was transferred with a trial version of CommuniGate(tm) Pro*
Lance is right. I want to be able to get presence info for cross-IM JIDs
through
a jabber server ( in this case, it's my own server ) . I won't be able to do
that if I were to only use Robert's solution. IMHO, I could use that
solution if
I were to display online status for MSN-IM IDs and only IDs that I have
added to
my MSN buddy list.
Thanks for both of your suggestions...

&quot;Lance (pyzr)&quot; wrote:

&gt;<i> *This message was transferred with a trial version of CommuniGate(tm) Pro*
</I>&gt;<i> Yeah, im not contending that. But how would you be able to get the status
</I>of
&gt;<i> another user? And its VB script that does that i believe, and can't only
</I>be
&gt;<i> shown in IE.  That simply pulls info from some object off your system that
</I>&gt;<i> is controlled by MSN messenger and outputs it into HTML. He wants (or at
</I>&gt;<i> least from what i understood it as) is to get the presence info from any
</I>&gt;<i> JID.. through jabber itself...
</I>&gt;<i>
</I>&gt;<i> -pyzr
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-admin at jabber.org</A> [mailto:<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-admin at jabber.org</A>]On Behalf Of
</I>&gt;<i> Robert Temple
</I>&gt;<i> Sent: Monday, February 19, 2001 11:52 AM
</I>&gt;<i> To: '<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>'
</I>&gt;<i> Subject: RE: [JDEV] Online status on a webpage
</I>&gt;<i>
</I>&gt;<i> no no.  If you go to the msn home page and you sign into msn messenger,
</I>&gt;<i> it shows your buddy list on that home page.  It uses the COM object in
</I>&gt;<i> the messenger exe to build that buddy list.
</I>&gt;<i>
</I>&gt;<i> -Robert
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Lance Hall [mailto:<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">pyzr at pyzr.com</A>]
</I>&gt;<i> Sent: Monday, February 19, 2001 3:39 AM
</I>&gt;<i> To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> Subject: RE: [JDEV] Online status on a webpage
</I>&gt;<i>
</I>&gt;<i> I think you mis-understood what he was wanting. What you proposed wouldn't
</I>&gt;<i> get the presence for anyone but yourself.
</I>&gt;<i>
</I>&gt;<i> Check out:
</I>&gt;<i> <A HREF="http://dev.jabber.org/projects/project.trp?id=58">http://dev.jabber.org/projects/project.trp?id=58</A>
</I>&gt;<i> Its a php script that will log into a jabber server, and can get the
</I>&gt;<i> presence of any JID. It works fine for me. But you have to subscribe to
</I>the
&gt;<i> script obviously... because of the way presence architecture is built. I
</I>had
&gt;<i> proposed a universally accessible presence (basically a namespace that the
</I>&gt;<i> client can choose what the result will be) for situations just like this.
</I>If
&gt;<i> the client does not want his presence accessible through this namespace
</I>then
&gt;<i> that is up to him.. it can be disabled. Since there is no standard yet, i
</I>&gt;<i> created my own namespace for my FusionIM client, for just this purpose.
</I>&gt;<i>
</I>&gt;<i> Lance
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-admin at jabber.org</A> [mailto:<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-admin at jabber.org</A>]On Behalf Of
</I>&gt;<i> Robert Temple
</I>&gt;<i> Sent: Monday, February 19, 2001 3:00 AM
</I>&gt;<i> To: '<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>'
</I>&gt;<i> Subject: RE: [JDEV] Online status on a webpage
</I>&gt;<i>
</I>&gt;<i> You can do it like MSN messenger does it.  In IE, JavaScript accesses the
</I>&gt;<i> Messenger application's COM object and asks it for the status of buddies,
</I>&gt;<i> and the draws them accordingly.
</I>&gt;<i>
</I>&gt;<i> -Robert
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Kok Leong [mailto:<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">chan.kok.leong at biztone.com</A>]
</I>&gt;<i> Sent: Sunday, February 18, 2001 7:22 PM
</I>&gt;<i> To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> Subject: [JDEV] Online status on a webpage
</I>&gt;<i>
</I>&gt;<i> *This message was transferred with a trial version of CommuniGate(tm) Pro*
</I>&gt;<i> Hi,
</I>&gt;<i> I've looked at the archives and did not find anything on how to view a
</I>&gt;<i> user's online status on a webpage. An example would be Yahoo where it
</I>&gt;<i> provides a link to be included in a html page and updates the page (
</I>&gt;<i> showing online or offline icons ) accordingly.
</I>&gt;<i> I could think of using Jabberbeans to interface to the server through a
</I>&gt;<i> servlet and have the servlet generate online status on the html page...
</I>&gt;<i> Is there any other way to do this?
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> jdev mailing list
</I>&gt;<i> <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> <A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> jdev mailing list
</I>&gt;<i> <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> <A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> jdev mailing list
</I>&gt;<i> <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> <A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> jdev mailing list
</I>&gt;<i> <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> <A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> jdev mailing list
</I>&gt;<i> <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> <A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>
</I>

--__--__--

Message: 7
From: saradhi &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">saradhi at virnt</A>&gt;
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Date: Tue, 20 Feb 2001 11:11:02 +0530
charset=&quot;iso-8859-1&quot;
Subject: [JDEV] Regarding The Source Code of the Development Server
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>


HI,
	How can i get the Source Code in C++/VC++ of the Jabber Server???
Thanks in Advance.
SARADHI
Associative Consultant
Virinchi Consultants Limited
Surabhi Plaza, Vikrampuri,
Secunderabad, A.P. , India
*91 (040) 7890 662 - 665
mail: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">saradhi at virinchi.com</A>


*****  GOD WON'T ASK WHAT YOUR JOB TITLE WAS, BUT WILL ASK IF YOU PERFORMED
YOUR JOB TO THE BEST OF YOUR ABILITY  *****


--__--__--

Message: 8
Date: Tue, 20 Feb 2001 00:24:04 -0800
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
From: Jabber DevZone &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">webmaster at jabber.org</A>&gt;
Subject: [JDEV] Jabber DevZone News - jer - Win32 Server Port?
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

Win32 Server Port?

I've written up some ideas on what it would take to port the current
codebase to win32 at <A HREF="http://core.jabber.org/win32.html.">http://core.jabber.org/win32.html.</A>  I'd
appreciate any feedback, and would love to find one or more
individuals  ready to take on this challenge :)

--__--__--

Message: 9
Date: Tue, 20 Feb 2001 11:22:23 +0100
From: Rodolphe Duge de Bernonville &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">rod at idealx.com</A>&gt;
Organization: IDEALX S.A.S.
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Subject: [JDEV] [patch users.c]
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

With asynchronous IO and heavy load, problems
may occure in jsm/users.c.


- js__usercount may be wrong.

- If the xdb_get call to retrieve user name and password is too
long, you can have many calls to ghash_put for the same
user. This will corrupt the udata field in the session struct.
So you must test after the xdb_get call if the user
is already in the cache.

+ finally : this cache and the reference counter was the source of 
many problems (see a precedent mail of david, <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">dlecorfec at idealx.com</A>, 
he has had to increase this counter in jsm/modules.c in js_mapi_call
). And I have seen that if a session was too long to open (ie when 
a _js_session_start is in a mtq), it may happen that the udata 
struct was deleted ... so I have put a 

s-&gt;u-&gt;ref++;  in js_session_new
and a  
s-&gt;u-&gt;ref--;  in _js_session_start

and finally to avoid that, I have decided that for a user with a session
the entry in this cache is permanent until he leave ...
so just put a

s-&gt;u-&gt;ref--; in _js_session_end





@@ -57,7 +57,12 @@
      * is positive, or if there are active sessions
      * we can't free it, so return immediately
      */
-    if(u-&gt;ref &gt; 0 || (u-&gt;sessions != NULL &amp;&amp; ++js__usercount))
+    if (u-&gt;sessions != NULL){
+	js__usercount++;
+	return 1;
+    }
+
+    if(u-&gt;ref &gt; 0)
         return 1;
 
     log_debug(ZONE,&quot;freeing %s&quot;,u-&gt;user);
@@ -114,11 +132,11 @@
 udata js_user(jsmi si, jid id, HASHTABLE ht)
 {
     pool p;
-    udata cur, newu;
-    char *ustr;
+    udata cur, newu, tmpu = NULL;
+    char *ustr, *u;
     xmlnode x;
     jid uid;
-
+    
     if(si == NULL || id == NULL || id-&gt;user == NULL) return NULL;
 
     /* get the host hash table if it wasn't provided */
@@ -158,9 +179,14 @@
     newu-&gt;id = jid_new(p,jid_full(uid));
 
     /* got the user, add it to the user list */
-    ghash_put(ht,newu-&gt;user,newu);
+    if ((tmpu=ghash_get(ht, u)) == NULL)
+	ghash_put(ht,newu-&gt;user,newu);
+    else{
+	pool_free(p);
+	newu = tmpu;
+    }
+
     log_debug(ZONE,&quot;js_user debug %X
%X&quot;,ghash_get(ht,newu-&gt;user),newu);
 
     return newu;
 }
-

--__--__--

Message: 10
Date: Tue, 20 Feb 2001 11:41:42 +0100
From: Rodolphe Duge de Bernonville &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">rod at idealx.com</A>&gt;
Organization: IDEALX S.A.S.
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Subject: [JDEV] [patch mod_presence.c]
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

Under heavy load and for an unknow reason (for the moment :)

_js_session_end may be call before a last call to mod_presence.

this will free the pres field in the session struct via
xmlnode_free(s-&gt;presence)
which will cause many problems in the mod_presence module in 
the mod_presence_out call. 

I think it is because of the xdb_get call to have the roster.
So, for the moment, (it works but not very nice), after each xdb call 
in this function, I recommend to do that :


/* push to roster subscriptions */
    roster = xdb_get(m-&gt;si-&gt;xc, m-&gt;user-&gt;id, NS_ROSTER);
/*  WARNING : possible to have s-&gt;presence modify by js_session_end  */
    if (m-&gt;s-&gt;exit_flag == 1){
	xmlnode_free(m-&gt;packet-&gt;x);
	xmlnode_free(roster);
	return M_HANDLED;
    }

--__--__--

Message: 11
Date: Tue, 20 Feb 2001 20:37:23 +0800
From: Gang Liu &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">gang_l at 21cn.com</A>&gt;
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">gang_l at 21cn.com</A>
To: &quot;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>&quot; &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>&gt;
Subject: [JDEV] Bug in base_accpet?
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

Hi,

	I use base_accpet to setup xdb_file in another linux box. Jabber
server is 1.4 release.Linux is RedHat 6.1.But jabberd often hang up in xdb
request.I also use tcpdump to see network traffic.When jabberd do something
like below, nothing is captured by tcpdump.
	Thanks for your help.

Tue Feb 20 20:24:00 2001  deliver.c:460 DELIVER 2:vista.internal &lt;xdb
type='get'
 to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">amx at vista.internal</A>' from='sessions' ns='jabber:iq:roster' id='61'/&gt;
Tue Feb 20 20:24:00 2001  deliver.c:649 delivering to instance
'xdb.vista.intern
al'
Tue Feb 20 20:24:00 2001  mio.c:898 mio_write called on x: 81D4850 buffer:
(null
)
Tue Feb 20 20:24:00 2001  xdb.c:201 xdb_get() waiting for <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">amx at vista.internal</A>
jab
ber:iq:roster
Tue Feb 20 20:24:15 2001  users.c:82 checking users for host vista.internal
Tue Feb 20 20:24:15 2001  usercount 1   total users
Tue Feb 20 20:24:19 2001  deliver.c:460 DELIVER 2:vista.internal &lt;xdb
type='get'
 to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">amx at vista.internal</A>' from='sessions' ns='jabber:iq:roster' id='61'/&gt;
Tue Feb 20 20:24:19 2001  deliver.c:649 delivering to instance
'xdb.vista.intern
al'
Tue Feb 20 20:24:19 2001  mio.c:898 mio_write called on x: 81FC930 buffer:
(null
)
Tue Feb 20 20:24:30 2001  deliver.c:460 DELIVER 2:vista.internal &lt;xdb
type='get'
 to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">amx at vista.internal</A>' from='sessions' ns='jabber:iq:roster' id='61'/&gt;
Tue Feb 20 20:24:30 2001  deliver.c:649 delivering to instance
'xdb.vista.intern
al'
Tue Feb 20 20:24:30 2001  mio.c:898 mio_write called on x: 81F8D00 buffer:
(nu


Jabber Server config:

....
&lt;xdb id=&quot;xdb.vista.internal&quot;&gt;
 	&lt;host/&gt;
    &lt;accept&gt;
        &lt;ip/&gt;
        &lt;port&gt;5280&lt;/port&gt;
        &lt;secret&gt;secret&lt;/secret&gt;
    &lt;/accept&gt;
&lt;/xdb&gt;
....



xdb_file config:

&lt;jabber&gt;

  &lt;service id=&quot;xdb.vista.internal&quot;&gt;
    &lt;host/&gt;
    &lt;connect&gt;
      &lt;ip&gt;192.168.0.1&lt;/ip&gt;
      &lt;port&gt;5280&lt;/port&gt;
      &lt;secret&gt;secret&lt;/secret&gt;
    &lt;/connect&gt;
  &lt;/service&gt;

  &lt;log id='xdblog'&gt;
    &lt;host/&gt;
    &lt;format&gt;%d: [%t] (%h): %s&lt;/format&gt;
    &lt;file&gt;./xdb-error.log&lt;/file&gt;
    &lt;stderr/&gt;
  &lt;/log&gt;

  &lt;xdb id=&quot;xdb_handler&quot;&gt;
    &lt;host&gt;vista.internal&lt;/host&gt;
    &lt;load&gt;&lt;xdb_file&gt;./xdb_file/xdb_file.so&lt;/xdb_file&gt;&lt;/load&gt;
    &lt;xdb_file
xmlns=&quot;jabber:config:xdb_file&quot;&gt;&lt;spool&gt;./spool&lt;/spool&gt;&lt;/xdb_file&gt;
  &lt;/xdb&gt;

&lt;/jabber&gt;


Regards,

- Lg

2001-2-20 20:22:14

--
  Gang Liu / Vista Team / ShenZhen City / China
  Email: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">gang_l at 21cn.com</A> &amp; <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">gang_l at hotmail.com</A>
  Phone: +86 13923425035   
  ICQ: 70670666   Jabber: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">gang_l at jabber.org</A>




--__--__--

Message: 12
Date: Tue, 20 Feb 2001 06:32:45 -0700
From: Peter Saint-Andre &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">peter at saint-andre.com</A>&gt;
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Subject: Re: [JDEV] Regarding The Source Code of the Development Server
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

As discussed here ...

<A HREF="http://docs.jabber.org/no-sgml/faq.trp#language">http://docs.jabber.org/no-sgml/faq.trp#language</A>

... the core server is written in C.

Peter

saradhi wrote:

&gt;<i> HI,
</I>&gt;<i>         How can i get the Source Code in C++/VC++ of the Jabber Server???
</I>&gt;<i> Thanks in Advance.
</I>&gt;<i> SARADHI
</I>&gt;<i> Associative Consultant
</I>&gt;<i> Virinchi Consultants Limited
</I>&gt;<i> Surabhi Plaza, Vikrampuri,
</I>&gt;<i> Secunderabad, A.P. , India
</I>&gt;<i> *91 (040) 7890 662 - 665
</I>&gt;<i> mail: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">saradhi at virinchi.com</A>
</I>&gt;<i>
</I>&gt;<i> *****  GOD WON'T ASK WHAT YOUR JOB TITLE WAS, BUT WILL ASK IF YOU
</I>PERFORMED
&gt;<i> YOUR JOB TO THE BEST OF YOUR ABILITY  *****
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> jdev mailing list
</I>&gt;<i> <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> <A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>
</I>

--__--__--

Message: 13
Date: Tue, 20 Feb 2001 13:37:45 +0000
From: Michael Wilson &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">mwilson at myopenapps.com</A>&gt;
Organization: MyOpenApps.com (Insight ASP)
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Subject: Re: [JDEV] Regarding The Source Code of the Development Server
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

Peter Saint-Andre wrote:
&gt;<i> As discussed here ...
</I>
Well, stated anyway. I don't question the decision to implement in
C; doubtless it made sense given the requirements and skills
available. Still it would be nice to hear /why/ C was chosen instead
of C++ or something more RAD-friendly. Since the focus of Jabber
is design simplicity and functionality rather than raw performance I
wouldn't have been suprised if it was written in Python ;&gt;

+--
|<i> Michael Wilson               &quot;Smart Applications - Tools for life&quot;
</I>|<i> Java Developer                           available @
</I>|<i> Insight ASP LTD                   <A HREF="http://www.myopenapps.com">http://www.myopenapps.com</A>
</I>+----------------------Open Source Innovation-----------------------

--__--__--

Message: 14
Date: Tue, 20 Feb 2001 15:42:33 +0100
From: Rodolphe Duge de Bernonville &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">rod at idealx.com</A>&gt;
Organization: IDEALX S.A.S.
To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
Subject: [JDEV] [patch client.c]
Reply-To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>

In pthsock/client.c

The jabber server may be overloaded by a user who
send big xml tag or data.

Furthermore when a user has not sent his username/password,
he can send request that are bufferized inside client.c.
This should be limited to 10 requests before being disconnected
(auth, presence, roster, filter, agents ...). This would 
avoid high intensive memory and cpu (when the user send his
user/password)
usage.

Patch for the first part : 

--- jabber2/jabberd/lib/lib.h	Thu Feb  1 22:21:43 2001
+++ ../MODIF/jabber2/jabberd/lib/lib.h	Tue Feb 20 15:10:57 2001
@@ -557,6 +557,7 @@
                             KARMA_HEARTBEAT seconds */
 #define KARMA_PENALTY -5 /* where you go when you hit 0 karma */
 #define KARMA_RESTORE 5  /* where you go when you payed your penelty or
INIT */
+#define MAXNODESIZE 8192
 
 struct karma
 {
@@ -566,6 +567,8 @@
     int inc,dec; /* how much to increment/decrement */
     int penalty,restore; /* what penalty (&lt;0) or restore (&gt;0) */
     time_t last_update; /* time this was last incremented */
+    int maxnodesize;
+    int conf_maxnodesize;
 };
 
 struct karma *karma_new(pool p); /* creates a new karma object, with
default values */

--- jabber2/jabberd/mio_xml.c	Thu Jan 18 08:43:40 2001
+++ ../MODIF/jabber2/jabberd/mio_xml.c	Tue Feb 20 15:17:06 2001
@@ -29,6 +29,8 @@
  *
--------------------------------------------------------------------------*/
 
 #include &lt;jabberd.h&gt;
+extern xmlnode greymatter__;
+
 
 /* *******************************************
  * Internal Expat Callbacks
@@ -83,6 +85,8 @@
 	    }
 	    m-&gt;stacknode = parent;
     }
+
+    m-&gt;k.maxnodesize = 0;
 }
 
 void _mio_xstream_CDATA(mio m, const char* cdata, int len)
@@ -118,8 +122,26 @@
 void _mio_xml_parser(mio m, const void *buf, size_t bufsz)
 {
     /* init the parser if this is the first read call */
-    if(m-&gt;parser == NULL)
-        _mio_xstream_init(m);
+    if(m-&gt;parser == NULL){
+	xmlnode io = xmlnode_get_tag(greymatter__, &quot;io&quot;);
+
+	m-&gt;k.maxnodesize = 0;
+	m-&gt;k.conf_maxnodesize =  j_atoi(xmlnode_get_data(xmlnode_get_tag(io,
&quot;maxnodesize&quot;)), MAXNODESIZE);
+	_mio_xstream_init(m);
+    }
+
+    if ( (m-&gt;k.maxnodesize += bufsz) &gt; m-&gt;k.conf_maxnodesize){
+        if(m-&gt;cb != NULL)
+        {
+            (*(mio_std_cb)m-&gt;cb)(m, MIO_ERROR, m-&gt;cb_arg);
+            mio_write(m, NULL, &quot;&lt;stream:error&gt;Invalid
XML&lt;/stream:error&gt;&quot;, -1);
+            mio_close(m);
+        }
+	
+	return;
+    }
+
+    fprintf(stderr, &quot;_mio_xml_parser : m-&gt;k.maxnodesize : %d\n&quot;,
m-&gt;k.maxnodesize  );
 
     if(XML_Parse(m-&gt;parser, buf, bufsz, 0) == 0)
         if(m-&gt;cb != NULL)
@@ -129,3 +151,4 @@
             mio_close(m);
         }
 }
+


--- jabber2/pthsock/client.c	Sat Feb  3 23:46:57 2001
+++ ../MODIF/jabber2/pthsock/client.c	Tue Feb 20 15:32:41 2001
@@ -44,6 +44,7 @@
 
 #include &lt;jabberd.h&gt;
 #define DEFAULT_AUTH_TIMEOUT 0
+#define MAX_REQ_BEFORE_AUTH 10
 
 /* socket manager instance */
 typedef struct smi_st
@@ -54,6 +55,7 @@
     HASHTABLE users;
     xmlnode cfg;
     char *host;
+    int nreqbeforeauth;
 } *smi, _smi;
 
 typedef enum { state_UNKNOWN, state_AUTHD } user_state;
@@ -303,6 +305,10 @@
                 q = pmalloco(xmlnode_pool(x), sizeof(_mio_wbq));
                 q-&gt;x = x;
                 pth_msgport_put(cd-&gt;pre_auth_mp, (void*)q);
+		if (pth_msgport_pending(cd-&gt;pre_auth_mp) &gt;
cd-&gt;si-&gt;nreqbeforeauth){
+		    mio_write(m, NULL, &quot;&lt;stream:error&gt;Too many
requests&lt;/stream:error&gt;&lt;/stream:stream&gt;&quot;, -1);
+		    mio_close(m);
+		}
                 return;
             }
             else if (NSCHECK(q, NS_AUTH))
@@ -434,6 +440,8 @@
     s__i-&gt;cfg = xdb_get(xc, jid_new(xmlnode_pool(x),
&quot;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">config at -internal</A>&quot;), &quot;jabber:config:pth-csock&quot;);
 
     s__i-&gt;host = host = i-&gt;id;
+    s__i-&gt;nreqbeforeauth = 
j_atoi(xmlnode_get_data(xmlnode_get_tag(s__i-&gt;cfg, &quot;nreqbeforeauth&quot;)),
MAX_REQ_BEFORE_AUTH);
+
 
     k.val     =KARMA_INIT;
     k.bytes   = 0;



--__--__--

_______________________________________________
jdev mailing list
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
<A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>


End of jdev Digest


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006355.html">[JDEV] s2s configuratoin
</A></li>
	<LI>Next message: <A HREF="006358.html">[JDEV] Source Code of JabberIM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6357">[ date ]</a>
              <a href="thread.html#6357">[ thread ]</a>
              <a href="subject.html#6357">[ subject ]</a>
              <a href="author.html#6357">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
