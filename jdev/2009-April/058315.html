<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] update on XMPP location (wherein beer is offered)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20update%20on%20XMPP%20location%20%28wherein%20beer%20is%20offered%29&In-Reply-To=%3C9090DBE6366A4B5C8CEEC37CC2799F1C%40movsoftware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="058306.html">
   <LINK REL="Next"  HREF="058316.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] update on XMPP location (wherein beer is offered)</H1>
    <B>Stephen Pendleton</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20update%20on%20XMPP%20location%20%28wherein%20beer%20is%20offered%29&In-Reply-To=%3C9090DBE6366A4B5C8CEEC37CC2799F1C%40movsoftware.com%3E"
       TITLE="[jdev] update on XMPP location (wherein beer is offered)">pendleto at movsoftware.com
       </A><BR>
    <I>Mon Apr  6 09:57:23 CDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="058306.html">[jdev] update on XMPP location (wherein beer is offered)
</A></li>
        <LI>Next message: <A HREF="058316.html">[jdev] update on XMPP location (wherein beer is offered)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58315">[ date ]</a>
              <a href="thread.html#58315">[ thread ]</a>
              <a href="subject.html#58315">[ subject ]</a>
              <a href="author.html#58315">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I can't seem to get this to work. For example I send:

&lt;iq to=&quot;butler.buddycloud.com&quot; type=&quot;get&quot; xml:lang=&quot;en&quot; id=&quot;location1&quot;&gt;
	&lt;locationquery xmlns=&quot;urn:xmpp:locationquery:0&quot;&gt;
		&lt;timestamp&gt;2009-04-05T08:09:56Z&lt;/timestamp&gt;
		&lt;publish&gt;true&lt;/publish&gt;
		&lt;reference&gt;
			&lt;id&gt;262:07:51520:34124757&lt;/id&gt;
			&lt;type&gt;cell&lt;/type&gt;
			&lt;signalstrength&gt;88&lt;/signalstrength&gt;
		&lt;/reference&gt;		
	&lt;/locationquery&gt;
	&lt;locationquery xmlns=&quot;urn:xmpp:locationquery:0&quot;&gt;
		&lt;timestamp&gt;2009-04-05T08:09:56Z&lt;/timestamp&gt;
		&lt;reference&gt;
			&lt;id&gt;262:07:51520:34104756&lt;/id&gt;
			&lt;type&gt;cell&lt;/type&gt;
			&lt;signalstrength&gt;88&lt;/signalstrength&gt;
		&lt;/reference&gt;		
	&lt;/locationquery&gt;
	&lt;locationquery xmlns=&quot;urn:xmpp:locationquery:0&quot;&gt;
		&lt;timestamp&gt;2009-04-05T08:09:56Z&lt;/timestamp&gt;
		&lt;reference&gt;
			&lt;id&gt;262:07:51520:34084753&lt;/id&gt;
			&lt;type&gt;cell&lt;/type&gt;
			&lt;signalstrength&gt;88&lt;/signalstrength&gt;
		&lt;/reference&gt;		
	&lt;/locationquery&gt;
&lt;/iq&gt;
and I get back the placename OK. I then send the nearby places query and get
an error back:

&lt;iq to=&quot;butler.buddycloud.com&quot; type=&quot;get&quot; id=&quot;nearbyplaces1&quot;&gt;
	&lt;command xmlns=&quot;<A HREF="http://jabber.org/protocol/commands&quot;">http://jabber.org/protocol/commands&quot;</A>
node=&quot;location&quot;&gt;
		&lt;x xmlns=&quot;jabber:x:data&quot; type=&quot;form&quot;&gt;
			&lt;field type=&quot;hidden&quot; var=&quot;FORM_TYPE&quot;&gt;
	
&lt;value&gt;buddycloud:location:places_near&lt;/value&gt;
			&lt;/field&gt;
		&lt;/x&gt;
	&lt;/command&gt;
&lt;/iq&gt;

and get back:
&lt;iq from=&quot;butler.buddycloud.com&quot; to=&quot;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">spendleton at movsoftware.com</A>/spark&quot;
id=&quot;nearbyplaces1&quot; type=&quot;error&quot; xml:lang=&quot;en-GB&quot;&gt;
	&lt;command xmlns=&quot;<A HREF="http://jabber.org/protocol/commands&quot;">http://jabber.org/protocol/commands&quot;</A>
node=&quot;location&quot;&gt;
		&lt;x xmlns=&quot;jabber:x:data&quot; type=&quot;form&quot;&gt;
			&lt;field type=&quot;hidden&quot; var=&quot;FORM_TYPE&quot;&gt;
	
&lt;value&gt;buddycloud:location:places_near&lt;/value&gt;
			&lt;/field&gt;
		&lt;/x&gt;
	&lt;/command&gt;
&lt;error code=&quot;500&quot; type=&quot;wait&quot;&gt;&lt;internal-server-error
xmlns=&quot;urn:ietf:params:xml:ns:xmpp-stanzas&quot;/&gt;&lt;text
xmlns=&quot;urn:ietf:params:xml:ns:xmpp-stanzas&quot;/&gt;&lt;/error&gt;&lt;/iq&gt;


Also, I dont understand the &lt;publish&gt;true&lt;/publish&gt; stanza. In the case
where I am sending cellids what is it publishing to my PEP node? Not my
lat/lon right, because you do not have lat/lon mappings from cellids to
lat/long coordinates and I dont have a placename published with that
lat/lon.

Also, if I remove or set the &lt;publish&gt; to &lt;publish&gt;false&lt;/publish&gt; I get
back:

iq from=&quot;butler.buddycloud.com&quot; to=&quot;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">spendleton at movsoftware.com</A>/spark&quot;
id=&quot;location31&quot; type=&quot;result&quot;&gt;&lt;geoloc
xmlns=&quot;<A HREF="http://jabber.org/protocol/geoloc&quot;">http://jabber.org/protocol/geoloc&quot;</A>
xml:lang=&quot;en&quot;&gt;&lt;accuracy&gt;1000000&lt;/accuracy&gt;&lt;/geoloc&gt;&lt;/iq&gt;

Not sure what this means.

Thanks
-----Original Message-----
From: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-bounces at jabber.org</A> [mailto:<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-bounces at jabber.org</A>] On Behalf Of
Simon Tennant
Sent: 04/01/2009 3:10 PM
To: Jabber/XMPP software development list
Subject: Re: [jdev] update on XMPP location (wherein beer is offered)


Stephen Pendleton wrote:
&gt;<i> I like this a lot. How does the &quot;nearby&quot; query work? Does it returned 
</I>&gt;<i> bookmarked places that are owned by the submitting jid, or any 
</I>&gt;<i> bookmarked place nearby? What is &quot;cellpatternquality&quot; mean?
</I>A place can have one of two modes.

    * Public places are those that can be shared with other people. Eg
      my placemark for Starbucks would be useful to others.
    * Private places are those that will not be shared with others. For
      example my placemark called &quot;Home sweet home&quot; is probably not
      useful to others on the network (and/or I want it to be private to
      just me and only shared with my friends).

butler.buddycloud.com will only show public in a nearby query. These will be
public places from all users. Additionally you can subscribe to a place
which then places it on your own list of places that you are placed at in
the future.

CellPatternQuality reflects the certainty of the place.  How &quot;distinct&quot; it
is. For example when you are driving the location butler will be seeing lots
of new wifi and cell towers. Saving a placemark at that point will save it
but it will be a &quot;blurry&quot; pattern in the database. 
Better would be to wait a moment, submit a couple more location queries,
watch for the cellpatternquality to increase to 100% and then send a
placemark save stanza.  Then the butler will be far more likely to
accurately place you back at that point in the future.

&gt;<i> Also, how does the component push my location to my PEP node if I am 
</I>&gt;<i> on another server? Would this be allowed by XMPP servers? I would be 
</I>&gt;<i> interested in seeing these stanzas though to test it out.
</I>Indeed for non-buddycloud.com domains PEP would not work. There are two
solutions for this that we are looking at. Either:

    * having the remote non buddycloud node publish their own pep node
      after getting a reply to their location query stanza or
    * granting publisher rights to butler.buddycloud.com on your own
      pubsub geoloc node and passing the address to this node as part of
      the location query. The query results would then be published on
      your behalf in XEP-0080 (user location) format as well as being
      returned to the client.

&gt;<i> There is another application we are working on that involves XEP-0255. 
</I>&gt;<i> It currently supports what you are calling &quot;beacon logs&quot; stanzas to 
</I>&gt;<i> return back postal addresses. The system uses a combination of wifi 
</I>&gt;<i> access points/mobile
</I>&gt;<i> towers to pinpoint your position and return back a lat/lon. It is very
</I>&gt;<i> accurate in a populated area.
</I>The butler does a best effort on the lookup of lat/long too and publishes it
as part of the XEP-0080 stack. I don't think we fill out the post code for
general locations (we do for known places) but this could presumably be
added with access to the right lat/long -&gt; postcode mapping tables.  It's
not something that we have spent too much time on. Our main efforts in
butler development have focused on making location something social by
describing it as known places like home or work or &quot;on the road in munich&quot;
(travelling) or  &quot;near  Jo's house&quot; for example.

S.

-- 
Simon Tennant
Buddycloud
uk: +44 20 7043 6756               de: +49 89 420 955 854  
uk: +44 78 5335 6047               de: +49 17 8545 0880
email and xmpp: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">simon at buddycloud.com</A>
<A HREF="http://buddycloud.com">http://buddycloud.com</A>

_______________________________________________
JDev mailing list
Forum: <A HREF="http://www.jabberforum.org/forumdisplay.php?f=20">http://www.jabberforum.org/forumdisplay.php?f=20</A>
Info: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">http://mail.jabber.org/mailman/listinfo/jdev</A>
Unsubscribe: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">JDev-unsubscribe at jabber.org</A>
_______________________________________________



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="058306.html">[jdev] update on XMPP location (wherein beer is offered)
</A></li>
	<LI>Next message: <A HREF="058316.html">[jdev] update on XMPP location (wherein beer is offered)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58315">[ date ]</a>
              <a href="thread.html#58315">[ thread ]</a>
              <a href="subject.html#58315">[ subject ]</a>
              <a href="author.html#58315">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
