<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] update on XMPP location (wherein beer is offered)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20update%20on%20XMPP%20location%20%28wherein%20beer%20is%20offered%29&In-Reply-To=%3C49DA4AF7.1080806%40buddycloud.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="058315.html">
   <LINK REL="Next"  HREF="058318.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] update on XMPP location (wherein beer is offered)</H1>
    <B>Helge Timenes</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20update%20on%20XMPP%20location%20%28wherein%20beer%20is%20offered%29&In-Reply-To=%3C49DA4AF7.1080806%40buddycloud.com%3E"
       TITLE="[jdev] update on XMPP location (wherein beer is offered)">helge at buddycloud.com
       </A><BR>
    <I>Mon Apr  6 13:33:27 CDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="058315.html">[jdev] update on XMPP location (wherein beer is offered)
</A></li>
        <LI>Next message: <A HREF="058318.html">[jdev] update on XMPP location (wherein beer is offered)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58316">[ date ]</a>
              <a href="thread.html#58316">[ thread ]</a>
              <a href="subject.html#58316">[ subject ]</a>
              <a href="author.html#58316">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Stephen Pendleton wrote:
&gt;<i> I can't seem to get this to work. For example I send:
</I>&gt;<i>
</I>&gt;<i> &lt;iq to=&quot;butler.buddycloud.com&quot; type=&quot;get&quot; xml:lang=&quot;en&quot; id=&quot;location1&quot;&gt;
</I>&gt;<i> 	&lt;locationquery xmlns=&quot;urn:xmpp:locationquery:0&quot;&gt;
</I>&gt;<i> 		&lt;timestamp&gt;2009-04-05T08:09:56Z&lt;/timestamp&gt;
</I>&gt;<i> 		&lt;publish&gt;true&lt;/publish&gt;
</I>&gt;<i> 		&lt;reference&gt;
</I>&gt;<i> 			&lt;id&gt;262:07:51520:34124757&lt;/id&gt;
</I>&gt;<i> 			&lt;type&gt;cell&lt;/type&gt;
</I>&gt;<i> 			&lt;signalstrength&gt;88&lt;/signalstrength&gt;
</I>&gt;<i> 		&lt;/reference&gt;		
</I>&gt;<i> 	&lt;/locationquery&gt;
</I>&gt;<i> 	&lt;locationquery xmlns=&quot;urn:xmpp:locationquery:0&quot;&gt;
</I>&gt;<i> 		&lt;timestamp&gt;2009-04-05T08:09:56Z&lt;/timestamp&gt;
</I>&gt;<i> 		&lt;reference&gt;
</I>&gt;<i> 			&lt;id&gt;262:07:51520:34104756&lt;/id&gt;
</I>&gt;<i> 			&lt;type&gt;cell&lt;/type&gt;
</I>&gt;<i> 			&lt;signalstrength&gt;88&lt;/signalstrength&gt;
</I>&gt;<i> 		&lt;/reference&gt;		
</I>&gt;<i> 	&lt;/locationquery&gt;
</I>&gt;<i> 	&lt;locationquery xmlns=&quot;urn:xmpp:locationquery:0&quot;&gt;
</I>&gt;<i> 		&lt;timestamp&gt;2009-04-05T08:09:56Z&lt;/timestamp&gt;
</I>&gt;<i> 		&lt;reference&gt;
</I>&gt;<i> 			&lt;id&gt;262:07:51520:34084753&lt;/id&gt;
</I>&gt;<i> 			&lt;type&gt;cell&lt;/type&gt;
</I>&gt;<i> 			&lt;signalstrength&gt;88&lt;/signalstrength&gt;
</I>&gt;<i> 		&lt;/reference&gt;		
</I>&gt;<i> 	&lt;/locationquery&gt;
</I>&gt;<i> &lt;/iq&gt;
</I>&gt;<i>   
</I>At the moment our server don't like multiple &lt;locationquery&gt; elements in 
an &lt;iq&gt;. There is no particularly good reason for this and I will fix it.

&gt;<i> and I get back the placename OK. I then send the nearby places query and get
</I>&gt;<i> an error back:
</I>&gt;<i>
</I>&gt;<i> &lt;iq to=&quot;butler.buddycloud.com&quot; type=&quot;get&quot; id=&quot;nearbyplaces1&quot;&gt;
</I>&gt;<i> 	&lt;command xmlns=&quot;<A HREF="http://jabber.org/protocol/commands&quot;">http://jabber.org/protocol/commands&quot;</A>
</I>&gt;<i> node=&quot;location&quot;&gt;
</I>&gt;<i> 		&lt;x xmlns=&quot;jabber:x:data&quot; type=&quot;form&quot;&gt;
</I>&gt;<i> 			&lt;field type=&quot;hidden&quot; var=&quot;FORM_TYPE&quot;&gt;
</I>&gt;<i> 	
</I>&gt;<i> &lt;value&gt;buddycloud:location:places_near&lt;/value&gt;
</I>&gt;<i> 			&lt;/field&gt;
</I>&gt;<i> 		&lt;/x&gt;
</I>&gt;<i> 	&lt;/command&gt;
</I>&gt;<i> &lt;/iq&gt;
</I>&gt;<i>
</I>&gt;<i> and get back:
</I>&gt;<i> &lt;iq from=&quot;butler.buddycloud.com&quot; to=&quot;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">spendleton at movsoftware.com</A>/spark&quot;
</I>&gt;<i> id=&quot;nearbyplaces1&quot; type=&quot;error&quot; xml:lang=&quot;en-GB&quot;&gt;
</I>&gt;<i> 	&lt;command xmlns=&quot;<A HREF="http://jabber.org/protocol/commands&quot;">http://jabber.org/protocol/commands&quot;</A>
</I>&gt;<i> node=&quot;location&quot;&gt;
</I>&gt;<i> 		&lt;x xmlns=&quot;jabber:x:data&quot; type=&quot;form&quot;&gt;
</I>&gt;<i> 			&lt;field type=&quot;hidden&quot; var=&quot;FORM_TYPE&quot;&gt;
</I>&gt;<i> 	
</I>&gt;<i> &lt;value&gt;buddycloud:location:places_near&lt;/value&gt;
</I>&gt;<i> 			&lt;/field&gt;
</I>&gt;<i> 		&lt;/x&gt;
</I>&gt;<i> 	&lt;/command&gt;
</I>&gt;<i> &lt;error code=&quot;500&quot; type=&quot;wait&quot;&gt;&lt;internal-server-error
</I>&gt;<i> xmlns=&quot;urn:ietf:params:xml:ns:xmpp-stanzas&quot;/&gt;&lt;text
</I>&gt;<i> xmlns=&quot;urn:ietf:params:xml:ns:xmpp-stanzas&quot;/&gt;&lt;/error&gt;&lt;/iq&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>   
</I>Something wrong was probably not right there (!) Possibly to do with the 
above.
&gt;<i> Also, I dont understand the &lt;publish&gt;true&lt;/publish&gt; stanza. In the case
</I>&gt;<i> where I am sending cellids what is it publishing to my PEP node? Not my
</I>&gt;<i> lat/lon right, because you do not have lat/lon mappings from cellids to
</I>&gt;<i> lat/long coordinates and I dont have a placename published with that
</I>&gt;<i> lat/lon.
</I>&gt;<i>   
</I>It will publish as much info as can be derived from your references. We 
do have a rudimentary cell to lat/lon database, and if a match is found 
it wil use this to derive your coordinates. If not it will default to 
the center of your country (derived from MCC) associated with a huuuuge 
error. From lat/lon it will try to obtain region, city and area names 
(with a little help from geonames.org).

Note that the publish will most likely fail, since your host server will 
propably let our server publish to your PEP node on your behalf. Some 
configuration might be needed for this to work I believe.
&gt;<i> Also, if I remove or set the &lt;publish&gt; to &lt;publish&gt;false&lt;/publish&gt; I get
</I>&gt;<i> back:
</I>&gt;<i>
</I>&gt;<i> iq from=&quot;butler.buddycloud.com&quot; to=&quot;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">spendleton at movsoftware.com</A>/spark&quot;
</I>&gt;<i> id=&quot;location31&quot; type=&quot;result&quot;&gt;&lt;geoloc
</I>&gt;<i> xmlns=&quot;<A HREF="http://jabber.org/protocol/geoloc&quot;">http://jabber.org/protocol/geoloc&quot;</A>
</I>&gt;<i> xml:lang=&quot;en&quot;&gt;&lt;accuracy&gt;1000000&lt;/accuracy&gt;&lt;/geoloc&gt;&lt;/iq&gt;
</I>&gt;<i>
</I>&gt;<i> Not sure what this means.
</I>&gt;<i>   
</I>This is probably related to your error above. Some how no results could 
be found (even so it suggest an error for your location had it been 
found. Er...  right)
&gt;<i> Thanks
</I>&gt;<i>   
</I>Your're welcome

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="058315.html">[jdev] update on XMPP location (wherein beer is offered)
</A></li>
	<LI>Next message: <A HREF="058318.html">[jdev] update on XMPP location (wherein beer is offered)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#58316">[ date ]</a>
              <a href="thread.html#58316">[ thread ]</a>
              <a href="subject.html#58316">[ subject ]</a>
              <a href="author.html#58316">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
