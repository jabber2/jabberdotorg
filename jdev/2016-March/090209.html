<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] How do I know when a MUC server restarts?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20How%20do%20I%20know%20when%20a%20MUC%20server%20restarts%3F&In-Reply-To=%3C56D83C70.2020506%40louiz.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="090208.html">
   <LINK REL="Next"  HREF="090210.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] How do I know when a MUC server restarts?</H1>
    <B>Florent Le Coz</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20How%20do%20I%20know%20when%20a%20MUC%20server%20restarts%3F&In-Reply-To=%3C56D83C70.2020506%40louiz.org%3E"
       TITLE="[jdev] How do I know when a MUC server restarts?">louiz at louiz.org
       </A><BR>
    <I>Thu Mar  3 13:30:24 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="090208.html">[jdev] How do I know when a MUC server restarts?
</A></li>
        <LI>Next message: <A HREF="090210.html">[jdev] How do I know when a MUC server restarts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#90209">[ date ]</a>
              <a href="thread.html#90209">[ thread ]</a>
              <a href="subject.html#90209">[ subject ]</a>
              <a href="author.html#90209">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/03/2016 02:19 PM, Stephen Paul Weber wrote:
&gt;<i> I am writing a external component (using it with Prosody right now) 
</I>&gt;<i> that allows users to join MUCs on other servers.  When a remote server 
</I>&gt;<i> restarts, I see this is my prosody log:
</I>&gt;<i>
</I>&gt;<i> info    outgoing s2s stream singpolyma.net-&gt;chat.yax.im closed: 
</I>&gt;<i> system-shutdown (Received SIGTERM)
</I>&gt;<i>
</I>&gt;<i> Now, my component is not running on singpolyma.net (that is a 
</I>&gt;<i> different domain on the same Prosody instance), but either maybe all 
</I>&gt;<i> s2s were incoming at the time since no one had said anything recently?
</I>&gt;<i>
</I>&gt;<i> Anyway, looking at the logs on my component, I don't see any stanza 
</I>&gt;<i> indicating anything about this.  I mean, I guess that makes sense.  
</I>&gt;<i> Server restarts don't generate stanzas.
</I>&gt;<i>
</I>&gt;<i> The problem is that when they restart the server, it comes back up 
</I>&gt;<i> with all MUCs empty and I need to get everyone on my component to 
</I>&gt;<i> re-join.  But as it the component actually thinks they are still in 
</I>&gt;<i> the MUC!
</I>&gt;<i>
</I>&gt;<i> Other XMPP clients I use seem to (sometimes after awhile) detect this 
</I>&gt;<i> situation somehow and tell me I'm no longer in the room (or try to 
</I>&gt;<i> re-join).  How are they doing this?  Is this some quirk of the 
</I>&gt;<i> external component protocol where normally Prosody would generate this 
</I>&gt;<i> kind of stanza to a client?  Or what else could I be missing?  I 
</I>&gt;<i> really need to solve this issue...
</I>&gt;<i>
</I>&gt;<i> Many thanks for any help!
</I>&gt;<i>
</I>
I&#8217;m also interested by this issue, this is annoying for the users. I 
already asked for ways to solve this (on the jdev@ muc, for example, I 
believe), and the conclusion was to ping my own in-room JID (e.g. 
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at conference.example.com</A>/MyNick) once in a while.

If the room considers that the client is not in the room, then it should 
get an error instead of a ping result.

That&#8217;s what poezio does. It has some issues, though (notably, with some 
&#8220;buggy&#8221; servers, when you&#8217;re connected behind the same nick, with two 
different full-jid, and you send the ping request to yourself, the room 
may route the result to the wrong resource (i.e not the one who sent the 
request), and then the client falsely believes that it is not connected 
to the room).

I wish there was a better solution.

-- 
louiz&#8217;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="090208.html">[jdev] How do I know when a MUC server restarts?
</A></li>
	<LI>Next message: <A HREF="090210.html">[jdev] How do I know when a MUC server restarts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#90209">[ date ]</a>
              <a href="thread.html#90209">[ thread ]</a>
              <a href="subject.html#90209">[ subject ]</a>
              <a href="author.html#90209">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
