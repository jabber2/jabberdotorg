<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] Presence subscription handling bugs in various Jabber	software
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20Presence%20subscription%20handling%20bugs%20in%20various%20Jabber%0A%09software&In-Reply-To=%3C20050206151206.GC21618%40serwis2.beta%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="050351.html">
   <LINK REL="Next"  HREF="050352.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] Presence subscription handling bugs in various Jabber	software</H1>
    <B>Jacek Konieczny</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20Presence%20subscription%20handling%20bugs%20in%20various%20Jabber%0A%09software&In-Reply-To=%3C20050206151206.GC21618%40serwis2.beta%3E"
       TITLE="[jdev] Presence subscription handling bugs in various Jabber	software">jajcus at bnet.pl
       </A><BR>
    <I>Sun Feb  6 09:12:06 CST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="050351.html">[jdev] Jabber/Helix Grant dead?
</A></li>
        <LI>Next message: <A HREF="050352.html">[jdev] Presence subscription handling bugs in various	Jabbersoftware
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50349">[ date ]</a>
              <a href="thread.html#50349">[ thread ]</a>
              <a href="subject.html#50349">[ subject ]</a>
              <a href="author.html#50349">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Most of us know, that some transports abuse 
&lt;presence type='subscribed'/&gt; stanzas, in a way which is now forbidden
by the XMPP-IM specification. That is done because of a very old bug in
jabberd-1.x based servers, which accept and process this stanza. It is
not good, when anyone is able to add himself to other's roster.

Now, when more and more servers aim at the XMPP compliance I thought
such features and abuses are going to die. Unfortunately it seems that
I am wrong.

Some users of my server complain, that some users of other servers are
able to add themselves to their rosters. It looks like this:

  a - user of my server
  A - my server
  B - the other server
  b - the other user

  They are connected like this:

  a ----(c2s)---- A ------- (s2s) ------ B ------- b
  (any        (ejabberd)              (some      (some
  client)                              server)    client)

  &quot;a&quot; does not have &quot;b&quot; in his roster, then &quot;b&quot; does &quot;something&quot; that
  add it to &quot;a&quot;'s roster by sending &lt;presence type='subscribed'/&gt;
  although &quot;a&quot; have never requested it.

Two such cases where reported to me. In the first case, the server &quot;B&quot;
was jabber.org (jabberd-1.4.x AFAIK), and the client &quot;b&quot; was (most
probably) Psi.

In the second case &quot;B&quot; was WP Jabber (JSM/JSM version 1.1.5 for
pthreaded server (Linux 2.6.x)), and &quot;b&quot; Psi (Psi/0.9.3 (SuSE Linux
9.2 (i586))).

Server &quot;A&quot; is always the same: ejabberd/0.7.5 (unix/linux 2.6.7)
Client &quot;a&quot; doesn't matter.

Please note, that for that scenario to work there must be bugs
on both servers (&quot;A&quot; which should not accept that stanza and &quot;B&quot;, which should
not forward it from its client) and a misfeature on the client &quot;b&quot; (I have
found nothing in the XMPP specs that forbids client to send unsolicited
&lt;presence type=&quot;subscribed&quot; /&gt;). So we have bugs in at least free server
implementations (ejabberd, jabberd 1.4.x and WP Jabber) and annoying (for users
of buggy servers) misfeature of at least one client (I may be wrong here if it
is not the client which generates the &quot;subscribed&quot; stanza). That doesn't look good, as 
it seems a very big part of global Jabber infrastructure is broken :-(

Or maybe I am wrong and there is only one bug somehere?

I will submit a bug report to the maintainers of the software I use (ejabberd). And
I ask you to check your software, and submit the bugs reports or fix the bugs too.

Greets,
	Jacek

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="050351.html">[jdev] Jabber/Helix Grant dead?
</A></li>
	<LI>Next message: <A HREF="050352.html">[jdev] Presence subscription handling bugs in various	Jabbersoftware
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#50349">[ date ]</a>
              <a href="thread.html#50349">[ thread ]</a>
              <a href="subject.html#50349">[ subject ]</a>
              <a href="author.html#50349">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
