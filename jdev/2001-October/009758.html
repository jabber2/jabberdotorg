<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [JDEV] SSL Yet Again
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=%5BJDEV%5D%20SSL%20Yet%20Again&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009711.html">
   <LINK REL="Next"  HREF="009713.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[JDEV] SSL Yet Again</H1>
    <B>Chris Pile</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=%5BJDEV%5D%20SSL%20Yet%20Again&In-Reply-To="
       TITLE="[JDEV] SSL Yet Again">cpile at snoogans.co.uk
       </A><BR>
    <I>Fri Oct  5 10:02:41 CDT 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="009711.html">[JDEV] SSL Yet Again
</A></li>
        <LI>Next message: <A HREF="009713.html">[JDEV] Re: New Patent Policy at W3C
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9758">[ date ]</a>
              <a href="thread.html#9758">[ thread ]</a>
              <a href="subject.html#9758">[ subject ]</a>
              <a href="author.html#9758">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Top darts!

Seems to work ok.

I done the following:

FreeBSD4.3
- checked out jabber2 from the CVS
- installed pth-1.4.0:
   &quot;pkg-add -r
<A HREF="ftp://ftp.freebsd.org/pub/FreeBSD/releases/i386/4.3-RELEASE/packages/devel/pth-1.4.0.tgz&quot;">ftp://ftp.freebsd.org/pub/FreeBSD/releases/i386/4.3-RELEASE/packages/devel/pth-1.4.0.tgz&quot;</A>
- installed gmake:
   &quot;pkg-add -r
<A HREF="ftp://ftp.freebsd.org/pub/FreeBSD/releases/i386/4.3-RELEASE/packages/devel/gmake-3.79.1.tgz&quot;">ftp://ftp.freebsd.org/pub/FreeBSD/releases/i386/4.3-RELEASE/packages/devel/gmake-3.79.1.tgz&quot;</A>
- &quot;./configure --enable-ssl&quot;
- &quot;gmake&quot;
   compiled fine
- customised jabber.xml

Tested connecting with JabberIM 1.10.0.6 on W2K.  Using the OpenSSL
libraries from:
<A HREF="http://download.sourceforge.net/jabbercom/jabbercom_openssl096.zip">http://download.sourceforge.net/jabbercom/jabbercom_openssl096.zip</A>

Here is some output.

--

su-2.05# netstat -an
Active Internet connections (including servers)
Proto Recv-Q Send-Q  Local Address          Foreign Address       
(state)
tcp4       0      0  192.168.1.1.5223    192.168.1.2.3243     
ESTABLISHED



Fri Oct  5 15:34:00 2001  mtq 8147100 leaving to pth
Fri Oct  5 15:34:00 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:00 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:00 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:01 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:01 2001  mio.c:377 _mio_accept calling accept on fd #8
Fri Oct  5 15:34:01 2001  mio_ssl.c:230 SSL accepting socket with new
session 80c7900
Fri Oct  5 15:34:01 2001  mio_ssl.c:243 Accept blocked, returning
Fri Oct  5 15:34:01 2001  mio.c:404 new socket accepted (fd: 14, ip:
192.168.1.2, port: 3134)
Fri Oct  5 15:34:01 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:01 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:01 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:01 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:01 2001  mio.c:755 MIO read from socket 14:
Fri Oct  5 15:34:01 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:01 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:01 2001  mio_ssl.c:145 Asked to read 8191 bytes from 14
Fri Oct  5 15:34:01 2001  mio_ssl.c:159 Read blocked, returning
Fri Oct  5 15:34:01 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:01 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:01 2001  mio_ssl.c:145 Asked to read 8191 bytes from 14
Fri Oct  5 15:34:01 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:01 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:01 2001  mio_ssl.c:145 Asked to read 8191 bytes from 14
Fri Oct  5 15:34:01 2001  mio.c:755 MIO read from socket 14:
&lt;stream:stream to=&quot;jabber.example.com&quot; xmlns=&quot;jabber:client&quot;
xmlns:stream=&quot;<A HREF="http://etherx.jabber.org/streams&quot;">http://etherx.jabber.org/streams&quot;</A>&gt;
Fri Oct  5 15:34:01 2001  c2s [client.c:265] pthsock_client_read called
with: m:808DA80 flag:2 arg:80906C0
Fri Oct  5 15:34:01 2001  c2s [client.c:298] root received for 14
Fri Oct  5 15:34:01 2001  c2s [client.c:303] Recieved connection to:
jabber.example.com
Fri Oct  5 15:34:01 2001  mio.c:1037 mio_write called on x: 0 buffer:
&lt;?xml version='1.0'?&gt;&lt;stream:stream
xmlns:stream='<A HREF="http://etherx.jabber.org/streams'">http://etherx.jabber.org/streams'</A> id='3BBDC4D9'
xmlns='jabber:client' from='jabber.example.com'&gt;
Fri Oct  5 15:34:01 2001  mio.c:276 write_dump writing data: &lt;?xml
version='1.0'?&gt;&lt;stream:stream
xmlns:stream='<A HREF="http://etherx.jabber.org/streams'">http://etherx.jabber.org/streams'</A> id='3BBDC4D9'
xmlns='jabber:client' from='jabber.example.com'&gt;
Fri Oct  5 15:34:01 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:01 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:01 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:01 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:01 2001  mio_ssl.c:145 Asked to read 8191 bytes from 14
Fri Oct  5 15:34:01 2001  mio.c:755 MIO read from socket 14: &lt;iq
type=&quot;get&quot; id=&quot;JCOM_8&quot;&gt;&lt;query
xmlns=&quot;jabber:iq:auth&quot;&gt;&lt;username&gt;chris&lt;/username&gt;&lt;/query&gt;&lt;/iq&gt;
Fri Oct  5 15:34:01 2001  c2s [client.c:265] pthsock_client_read called
with: m:808DA80 flag:3 arg:80906C0
Fri Oct  5 15:34:01 2001  deliver.c:460 DELIVER 4:jabber.example.com
&lt;route type='auth' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">chris at jabber.example.com</A>'
from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">14 at c2s</A>/808DA80'&gt;&lt;iq type='get' id='JCOM_8'&gt;&lt;query
xmlns='jabber:iq:auth'&gt;&lt;username&gt;chris&lt;/username&gt;&lt;/query&gt;&lt;/iq&gt;&lt;/route&gt;
Fri Oct  5 15:34:01 2001  deliver.c:651 delivering to instance
'sessions'
Fri Oct  5 15:34:01 2001  deliver.c:83 (8090240)incoming packet &lt;route
type='auth' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">chris at jabber.example.com</A>' from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">14 at c2s</A>/808DA80'&gt;&lt;iq
type='get' id='JCOM_8'&gt;&lt;query
xmlns='jabber:iq:auth'&gt;&lt;username&gt;chris&lt;/username&gt;&lt;/query&gt;&lt;/iq&gt;&lt;/route&gt;
Fri Oct  5 15:34:01 2001  util.c:92 config query auth
Fri Oct  5 15:34:01 2001  mtq 8147000 entering from pth
Fri Oct  5 15:34:01 2001  mtq 8147000 one call 815FC38
Fri Oct  5 15:34:01 2001  authreg.c:52 auth request
Fri Oct  5 15:34:01 2001  users.c:132
js_user(<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">chris at jabber.example.com</A>,8166000)
.
.
Fri Oct  5 15:34:01 2001  mio.c:604 mio while loop top
Fri Oct  5 15:34:01 2001  mio.c:617 mio while loop, working
Fri Oct  5 15:34:01 2001  mio_ssl.c:145 Asked to read 8191 bytes from 14
Fri Oct  5 15:34:01 2001  mio.c:755 MIO read from socket 14: &lt;iq
id=&quot;vcard_356&quot; type=&quot;get&quot; to=&quot;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">chris at jabber.snoogans.co.uk</A>/Jabber Instant
Messenger&quot;&gt;&lt;query xmlns=&quot;vcard-temp&quot;/&gt;&lt;/iq&gt;
.
.
Fri Oct  5 15:34:43 2001  mio.c:871 MIO is shutting down
Fri Oct  5 15:34:43 2001  c2s [client.c:265] pthsock_client_read called
with: m:808DA80 flag:4 arg:80906C0
Fri Oct  5 15:34:43 2001  c2s [client.c:270] io_select Socket 14 close
notification
Fri Oct  5 15:34:43 2001  mio_ssl.c:132 SSL Cleanup for 80c7900
Fri Oct  5 15:34:43 2001  mio.c:363 freed MIO socket
Fri Oct  5 15:34:43 2001  mio.c:363 freed MIO socket
Fri Oct  5 15:34:43 2001  mio.c:363 freed MIO socket

--

Looks like the whole mio loop works when &quot;SSL_ERROR_WANT_*&quot; occurs. 
Takes a few goes but gets there in the end.  Let me know if you need
anymore debug output, I only grabbed a few chunks that look relevant.

I still want to do some more testing, but so far so good.  Sorry for
delay in response but hadn't checked the list for a few days.


Thanks,
Chris.

temas wrote:
&gt;<i> 
</I>&gt;<i> Ok, I think we've got it this time.  Current CVS works on the places I
</I>&gt;<i> could test that didn't work previously.  I would love if people could
</I>&gt;<i> test this ASAP and let me know so it can be in 1.4.2.
</I>&gt;<i> 
</I>&gt;<i> --temas
</I>&gt;<i> 
</I>&gt;<i>   ------------------------------------------------------------------------
</I>&gt;<i>    Part 1.2Type: application/pgp-signature
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009711.html">[JDEV] SSL Yet Again
</A></li>
	<LI>Next message: <A HREF="009713.html">[JDEV] Re: New Patent Policy at W3C
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9758">[ date ]</a>
              <a href="thread.html#9758">[ thread ]</a>
              <a href="subject.html#9758">[ subject ]</a>
              <a href="author.html#9758">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
