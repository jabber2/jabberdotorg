<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [JDEV] coredump with xdb_sql and user profile changes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5BJDEV%5D%20coredump%20with%20xdb_sql%20and%20user%20profile%20changes&In-Reply-To=%3C3BC3908A.8050708%40ritcey.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="068394.html">
   <LINK REL="Next"  HREF="068399.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[JDEV] coredump with xdb_sql and user profile changes</H1>
    <B>Benjamin Ritcey</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5BJDEV%5D%20coredump%20with%20xdb_sql%20and%20user%20profile%20changes&In-Reply-To=%3C3BC3908A.8050708%40ritcey.com%3E"
       TITLE="[JDEV] coredump with xdb_sql and user profile changes">jdev at ritcey.com
       </A><BR>
    <I>Tue Oct  9 19:04:26 CDT 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="068394.html">[JDEV] Using Java Socket and JAXP1.1 DefaultHandler
</A></li>
        <LI>Next message: <A HREF="068399.html">[JDEV] coredump with xdb_sql and user profile changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68396">[ date ]</a>
              <a href="thread.html#68396">[ thread ]</a>
              <a href="subject.html#68396">[ subject ]</a>
              <a href="author.html#68396">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all,

I've run into an odd problem -- I'm running jabberd 1.4.1 and xdb_sql 
1.1 w/ MySQL -- things are working well enough (some oddities), but I 
have run into a major problem/bug --

With my setup, if a user changes their profile a couple of times (2 or 
3), it crashes the server (the client is JIM 1.10, if that matters).

In looking at the logs, I can see what appears to be some sort of memory 
corruption;

line 6593 of <A HREF="http://www.ritcey.com/jabber/jabberd.out">http://www.ritcey.com/jabber/jabberd.out</A> shows:

xdb_file.c:251 decaching @&#197;$@@&#197;$@jabberbox.ritcey.com/crashtest2.xml

that garbage should be './spool/' -- up to that point, that's what the 
other decaching log entries read.  Right after that appears in the log, 
the next attempt to update the profile results in a coredump -- 
backtrace at <A HREF="http://www.ritcey.com/jabber/backtrace,">http://www.ritcey.com/jabber/backtrace,</A> but I'm not sure if 
it's valid - the damage has been done by the time it dumps core.

Oddly enough, the profile updates never take, tho the database does get 
updated (xdb_sql bug, I assume).

jabber.xml and xdb_sql.xml are also available at 
<A HREF="http://www.ritcey.com/jabber/">http://www.ritcey.com/jabber/</A> (I didn't include the files, since they 
are fairly large).

I suspect it is because of xdb_sql and its interaction with xdb_file, 
but I'm not quite sure what it is.

Frankly, I don't care about the profiles (internal, captive audience, 
accounts will be created by the admin, etc.), so if the vcard could be 
flat-out disabled to fix this, that would be fine too.

I didn't see anything like this on the mailing lists (searchable 
archives anywhere?) nor Google.

Any ideas?

Thanks for your time and a cool chunk of software.

-b


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="068394.html">[JDEV] Using Java Socket and JAXP1.1 DefaultHandler
</A></li>
	<LI>Next message: <A HREF="068399.html">[JDEV] coredump with xdb_sql and user profile changes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#68396">[ date ]</a>
              <a href="thread.html#68396">[ thread ]</a>
              <a href="subject.html#68396">[ subject ]</a>
              <a href="author.html#68396">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
