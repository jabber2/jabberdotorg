<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] [Security] Spoofing of iq ids and misbehaving servers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20%5BSecurity%5D%20Spoofing%20of%20iq%20ids%20and%20misbehaving%20servers&In-Reply-To=%3CC4A51B04-4654-4F90-8528-352603C8497E%40thijsalkema.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="089828.html">
   <LINK REL="Next"  HREF="089830.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] [Security] Spoofing of iq ids and misbehaving servers</H1>
    <B>Thijs Alkemade</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20%5BSecurity%5D%20Spoofing%20of%20iq%20ids%20and%20misbehaving%20servers&In-Reply-To=%3CC4A51B04-4654-4F90-8528-352603C8497E%40thijsalkema.de%3E"
       TITLE="[jdev] [Security] Spoofing of iq ids and misbehaving servers">me at thijsalkema.de
       </A><BR>
    <I>Thu Jan 30 15:58:09 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="089828.html">[jdev] [Security] Spoofing of iq ids and misbehaving servers
</A></li>
        <LI>Next message: <A HREF="089830.html">[jdev] [Security]   Spoofing of iq ids and misbehaving servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#89829">[ date ]</a>
              <a href="thread.html#89829">[ thread ]</a>
              <a href="subject.html#89829">[ subject ]</a>
              <a href="author.html#89829">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 30 jan. 2014, at 16:36, Alexander Holler &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">holler at ahsoftware.de</A>&gt; wrote:

&gt;<i> Am 30.01.2014 13:49, schrieb Thijs Alkemade:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Then we have Facebook. All replies to iqs without 'to' have
</I>&gt;&gt;<i> from='chat.facebook.com':
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> C: &lt;iq type='get' id='purple3a6232a6'&gt;&lt;ping xmlns='urn:xmpp:ping'/&gt;&lt;/iq&gt;
</I>&gt;&gt;<i> S: &lt;iq from='chat.facebook.com' id='purple3a6232a6' type='result'/&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> jabber.org itself shows a similar problem:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> C: &lt;iq type='set' id='purplec5ae5254'&gt;
</I>&gt;&gt;<i>       &lt;session xmlns='urn:ietf:params:xml:ns:xmpp-session'/&gt;
</I>&gt;&gt;<i>    &lt;/iq&gt;
</I>&gt;&gt;<i> S: &lt;iq from='jabber.org' type='result' id='purplec5ae5254'/&gt;
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I would say that is correct (and I do the same in my server). No 'to' means the target ('to') is the server.
</I>&gt;<i> 
</I>&gt;<i> Unfortunately, CVE-2013-6483 still isn't public, so I wonder what the problem is when a non-existing 'to' will be replaced by a 'to' with the servers jid (usually just the domain). If I read the Pidgin Security Advisory correctly, some servers do forward iq-replies which do contain a 'from' of the server, which is the real problem. So those failing servers do seem to miss a check for the validity of the 'from'.
</I>&gt;<i> 
</I>&gt;<i> But replying to an iq without a 'to' with an iq with a 'from' of the server is imho correct.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Alexander Holler
</I>
No, that&#8217;s wrong. <A HREF="http://xmpp.org/rfcs/rfc6120.html#rules-noto-IQ:">http://xmpp.org/rfcs/rfc6120.html#rules-noto-IQ:</A>

&quot;If the server receives an IQ stanza with no 'to' attribute, it MUST process
the stanza on behalf of the account from which received the stanza, ... by
returning an appropriate IQ stanza of type &quot;result&quot; or &quot;error&quot;, responding as
if the server were the bare JID of the sending entity.&quot;

Thijs

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://www.jabber.org/jdev/attachments/20140130/2a22a3ca/attachment-0001.html">https://www.jabber.org/jdev/attachments/20140130/2a22a3ca/attachment-0001.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: &lt;<A HREF="https://www.jabber.org/jdev/attachments/20140130/2a22a3ca/attachment-0001.pgp">https://www.jabber.org/jdev/attachments/20140130/2a22a3ca/attachment-0001.pgp</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="089828.html">[jdev] [Security] Spoofing of iq ids and misbehaving servers
</A></li>
	<LI>Next message: <A HREF="089830.html">[jdev] [Security]   Spoofing of iq ids and misbehaving servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#89829">[ date ]</a>
              <a href="thread.html#89829">[ thread ]</a>
              <a href="subject.html#89829">[ subject ]</a>
              <a href="author.html#89829">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
