<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [JDEV] NAT Issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5BJDEV%5D%20NAT%20Issues&In-Reply-To=%3C00121613201400.00353%40dennis%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="034495.html">
   <LINK REL="Next"  HREF="034499.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[JDEV] NAT Issues</H1>
    <B>Dennis Noordsij</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5BJDEV%5D%20NAT%20Issues&In-Reply-To=%3C00121613201400.00353%40dennis%3E"
       TITLE="[JDEV] NAT Issues">dennis.noordsij at wiral.com
       </A><BR>
    <I>Sat Dec 16 05:20:14 CST 2000</I>
    <P><UL>
        <LI>Previous message: <A HREF="034495.html">[JDEV] NAT Issues
</A></li>
        <LI>Next message: <A HREF="034499.html">[JDEV] NAT Issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34497">[ date ]</a>
              <a href="thread.html#34497">[ thread ]</a>
              <a href="subject.html#34497">[ subject ]</a>
              <a href="author.html#34497">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Michael,

There is a gem floating around on Freshmeat: an ip_masq_icq module. When you 
connect to ICQ the ip_masq_icq module on the server (I assume you are 
familiar with the masqing modules for irc, realaudio, quake, etc) remembers 
the UIN that connected with respect to the internal IP address it came from. 
When a message comes in (and supposedly also file transfer initiations) the 
masq module knows to forward this to your IP address. 

I can not promise file transfers work as I have not tried it myself, but I 
can be behind a NAT box with ICQ and people can send me messages without 
having to go through the ICQ server. Ie a direct message to the NAT box gets 
forwarded to my PC. I believe the module is also pretty up-to-date with 
regard to the ICQ protocol.

But to get back to the actual question :-) 

Clients could attempt a negotiation, ie talk through the server while they 
each try to open a port and connect to it, ie first they try to set up a 
connection from A to B, then from B to A, then if that doesnt work either 
(both NAT'ed) the sender can HTTP POST it somewhere and B can fetch it. This 
has additional advantages that not both people have to be online for it work 
and a sender can send files very quickly if bandwidth allows without having 
to wait for the receiver to receive the file on his 19k2 modem because a 
(squid proxy accelerated) webserver is handling that.

Just some thoughts :)

Oh, and what about using some kind of proxy on gateway machines? Socks or 
something? 

Best regards,
Dennis 


On Saturday 16 December 2000 10:45, Michael Brown wrote:
&gt;<i> [Just before I start, I should mention that I haven't had a great deal of
</I>&gt;<i> experience sending and receiving files from a Jabber client, so if I am
</I>&gt;<i> missing something please let me know]
</I>&gt;<i>
</I>&gt;<i> I've just been fooling with ICQ a bit and it got me thinking - (how) does
</I>&gt;<i> Jabber handle this problem?
</I>&gt;<i>
</I>&gt;<i> The problem with ICQ is that the file transfer almost never works.  The
</I>&gt;<i> reason for this is simple.  I, and most of my friends either are behind a
</I>&gt;<i> firewall or a NAT server.
</I>&gt;<i>
</I>&gt;<i> Just talking about NAT for a bit - this means that I cannot receive any
</I>&gt;<i> files (or chat sessions, or anything else that requires a direct
</I>&gt;<i> connection).  I can send files fine because opening an outgoing connection
</I>&gt;<i> from a NAT client with no problem, but as soon as someone tries to open a
</I>&gt;<i> connection to me (send me a file) the request gets to the NAT server and it
</I>&gt;<i> has no idea which client to forward it to.
</I>&gt;<i>
</I>&gt;<i> The end user perception of this problem is that &quot;ICQ is flaky&quot; or &quot;I can
</I>&gt;<i> never seem to be able to download half the songs I try to in Napster&quot;, and
</I>&gt;<i> this is going to translate into &quot;Jabber will never let me send files&quot; etc.
</I>&gt;<i> I think this is going to be a major problem with Jabber, because we are
</I>&gt;<i> going to want to establish direct connections for anything that is too
</I>&gt;<i> large or inappropriate to go through the server.
</I>&gt;<i>
</I>&gt;<i> Since NAT is used by ICS in any Microsoft OS later than Win98SE, I think
</I>&gt;<i> there will be more and more clients connect behind NAT servers.  Also I
</I>&gt;<i> believe (and can someone correct me if I am wrong please) that Linuxs IP
</I>&gt;<i> Masquerading is the same thing (although a lot harder to spell).
</I>&gt;<i>
</I>&gt;<i> I believe that some &quot;NAT aware&quot; applications place the private IP address
</I>&gt;<i> inside the packet, so that the NAT server can route packets to the correct
</I>&gt;<i> NAT client, but I also under stand that there must be something configured
</I>&gt;<i> on the NAT server machine to enable it to do this (I think MS calls this a
</I>&gt;<i> &quot;NAT Editor&quot; - the supply one for ftp I believe).
</I>&gt;<i>
</I>&gt;<i> Has this be covered already?  If so, is there a solution?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Michael.
</I>&gt;<i>
</I>&gt;<i> [Of course thinking more about this, I am not sure how I get the first
</I>&gt;<i> incoming
</I>&gt;<i> message in ICQ, unless the first one always comes though the server.
</I>&gt;<i> Hmmm...]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> jdev mailing list
</I>&gt;<i> <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;<i> <A HREF="http://mailman.jabber.org/listinfo/jdev">http://mailman.jabber.org/listinfo/jdev</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="034495.html">[JDEV] NAT Issues
</A></li>
	<LI>Next message: <A HREF="034499.html">[JDEV] NAT Issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34497">[ date ]</a>
              <a href="thread.html#34497">[ thread ]</a>
              <a href="subject.html#34497">[ subject ]</a>
              <a href="author.html#34497">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
