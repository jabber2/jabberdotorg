<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] XMPP on Android, Round #2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20XMPP%20on%20Android%2C%20Round%20%232&In-Reply-To=%3C4CD1286B.2000404%40measite.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="088535.html">
   <LINK REL="Next"  HREF="088537.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] XMPP on Android, Round #2</H1>
    <B>Rene Treffer</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20XMPP%20on%20Android%2C%20Round%20%232&In-Reply-To=%3C4CD1286B.2000404%40measite.de%3E"
       TITLE="[jdev] XMPP on Android, Round #2">treffer+jdev at measite.de
       </A><BR>
    <I>Wed Nov  3 03:16:27 CST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="088535.html">[jdev] XMPP on Android, Round #2
</A></li>
        <LI>Next message: <A HREF="088537.html">[jdev] XMPP on Android, Round #2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88536">[ date ]</a>
              <a href="thread.html#88536">[ thread ]</a>
              <a href="subject.html#88536">[ subject ]</a>
              <a href="author.html#88536">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/03/2010 01:06 AM, Stephen Pendleton wrote:
&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-bounces at jabber.org</A> [mailto:<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-bounces at jabber.org</A>] On Behalf Of
</I>&gt;<i> Rene Treffer
</I>&gt;<i> Sent: Tuesday, November 02, 2010 6:33 PM
</I>&gt;<i> To: Jabber/XMPP software development list
</I>&gt;<i> Subject: Re: [jdev] XMPP on Android, Round #2
</I>&gt;<i>
</I>&gt;<i> On 11/02/2010 10:24 PM, Stephen Pendleton wrote:
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-bounces at jabber.org</A> [mailto:<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-bounces at jabber.org</A>] On Behalf
</I>&gt;<i> Of
</I>&gt;&gt;<i> Rene Treffer
</I>&gt;&gt;<i> Sent: Tuesday, November 02, 2010 4:09 PM
</I>&gt;&gt;<i> To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;&gt;<i> Subject: Re: [jdev] XMPP on Android, Round #2
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 11/01/2010 10:14 PM, Stephen Pendleton wrote:
</I>&gt;&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;&gt;<i> From: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-bounces at jabber.org</A> [mailto:<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev-bounces at jabber.org</A>] On Behalf
</I>&gt;&gt;<i> Of Yann Leboulanger
</I>&gt;&gt;&gt;<i> Sent: Monday, November 01, 2010 4:27 PM
</I>&gt;&gt;&gt;<i> To: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">jdev at jabber.org</A>
</I>&gt;&gt;&gt;<i> Subject: Re: [jdev] XMPP on Android, Round #2
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Couldn't Stream managment help for that?
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://xmpp.org/extensions/xep-0198.html">http://xmpp.org/extensions/xep-0198.html</A>
</I>&gt;&gt;<i> 2. How do you get *less* pushes/pulls if stanzas cause push notifies. I
</I>&gt;&gt;<i> don't get that one, either.
</I>&gt;&gt;<i> 3. Semi-frequently is still better than for-nearly-every-stanza. You are
</I>&gt;&gt;<i> asking to keep the connection short lived? I don't expect the
</I>&gt;&gt;<i> stanza/reconnect ratio to improve due to that. And there is no stanza
</I>&gt;&gt;<i> reduction due to the system. I don't get how your suggestion is going to
</I>&gt;&gt;<i> improve the situation as you still wake the network and cpu at the same
</I>&gt;&gt;<i> rate.
</I>&gt;<i> I think I am not being clear.
</I>&gt;<i>
</I>&gt;<i> Here is an example, you have your XMPP service running on your phone. It is
</I>&gt;<i> in the background, in your pocket, etc. You aren't interested in all the
</I>&gt;<i> &lt;presence&gt;, pubsub, PEP, etc stanzas. You are only interested in &lt;message&gt;
</I>&gt;<i> stanzas so you can be notified when a message is waiting to be read. If you
</I>&gt;<i> maintain a constant XMPP TCP connection you are getting tons of stanzas you
</I>&gt;<i> aren't interested in. In addition you are going to have to partially wake
</I>&gt;<i> lock the device in order to keep the TCP connection from getting torn down
</I>&gt;<i> when the device CPU sleeps. This is going to kill your device and is frowned
</I>&gt;<i> upon in the android world.
</I>
There is no wake lock for GSM/TCP. It simply doesn't exist. And you
*have* a TCP connection in your pocket, in the background, it's called
Cloud to Device. Wake Lock keeps your system in an awake state as if the
user would actually use it. Usefull e.g. for in-game animations. Useless
for network or general IO wait. It's usually held because you can't rely
e.g. on Thread.sleep, but you CAN reply on read() to terminate as soon
as there is data available. I've build everything to not rely on timing
but on events / wakeups caused by external sources.

TCP gets killed after weeks on old kernels and after days for new
kernels. Where did you get the assumption that TCP would get killed all
the time?

The second part, filtering, is SIFT, and the power saving is *unrelated*
to keeping a second connection open.

BTW, I am using the time tick intent, thus doing keepalive when every
other app does networking, too. This is why I never show up in the
battery list.

&gt;<i> In an alternate scenario you could use the Google push service to be
</I>&gt;<i> notified when a &lt;message&gt; stanza is available to be read on the server. Only
</I>&gt;<i> then would you reconnect to the XMPP server and retrieve the &lt;message&gt;
</I>&gt;<i> stanza. Actually I misread the XEP-0198 though, it seems that it will
</I>&gt;<i> retransmit all the &quot;missed&quot; stanzas. What we would need is for it to only
</I>&gt;<i> retransmit the stanzas of interest, like SIFT. So maybe a combination of the
</I>&gt;<i> stream resume feature + SIFT would work here.
</I>&gt;<i>
</I>&gt;<i> I'm not sure about you, but 95% of the time my phone is on I am not
</I>&gt;<i> receiving any XMPP messages that require my attention. I don't want to
</I>&gt;<i> maintain an active TCP connection 100% of the time just to get the 5%.
</I>
Oh well, but even 5% would wake your xmpp all the time, thus causing
massive battery drains as you keep your system in a quite-active state
for several seconds.

You are assuming a 19:1 ratio. Thus you are doing feature negotation
with tls, zlib initialization and sasl.
- 3 stream header roundtrips / 6 xml openings,
- 4 Sasl stanzas
- 4 negotiation elements
- 1 resume
So at least 12 packages that are going over the wire, in exchange for
hopefully 19 saved ones.... But we have multiple TCP roundtrips and
alike. I'd guess that this doesn't save any battery.

Regards,
    Rene Treffer

&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> JDev mailing list
</I>&gt;<i> Forum: <A HREF="http://www.jabberforum.org/forumdisplay.php?f=20">http://www.jabberforum.org/forumdisplay.php?f=20</A>
</I>&gt;<i> Info: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">http://mail.jabber.org/mailman/listinfo/jdev</A>
</I>&gt;<i> Unsubscribe: <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">JDev-unsubscribe at jabber.org</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="088535.html">[jdev] XMPP on Android, Round #2
</A></li>
	<LI>Next message: <A HREF="088537.html">[jdev] XMPP on Android, Round #2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88536">[ date ]</a>
              <a href="thread.html#88536">[ thread ]</a>
              <a href="subject.html#88536">[ subject ]</a>
              <a href="author.html#88536">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
