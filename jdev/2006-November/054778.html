<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] message events + chat state notifications
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20message%20events%20%2B%20chat%20state%20notifications&In-Reply-To=%3C200611032110.04726.ogoffart%40kde.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="054775.html">
   <LINK REL="Next"  HREF="054779.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] message events + chat state notifications</H1>
    <B>Olivier Goffart</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20message%20events%20%2B%20chat%20state%20notifications&In-Reply-To=%3C200611032110.04726.ogoffart%40kde.org%3E"
       TITLE="[jdev] message events + chat state notifications">ogoffart at kde.org
       </A><BR>
    <I>Fri Nov  3 14:09:59 CST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="054775.html">[jdev] Re: message events + chat state notifications
</A></li>
        <LI>Next message: <A HREF="054779.html">[jdev] message events + chat state notifications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54778">[ date ]</a>
              <a href="thread.html#54778">[ thread ]</a>
              <a href="subject.html#54778">[ subject ]</a>
              <a href="author.html#54778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Le vendredi 3 novembre 2006 18:36, Peter Saint-Andre a &#233;crit&#160;:
&gt;<i> IMHO it's about time to actively deprecate the old message events
</I>&gt;<i> protocol (XEP-0022) in favor of chat state notifications (XEP-0085).
</I>
But 85 and 22 are IMO two completely different things.
Appart the composing notification, they covers different layer.

XEP-0022 is usefull to let know that the user has actually read the message, 
or if the message is stored offline.  XEP-0085 doesn't let you do that.

Maybe the composing event should be marked as deprecated in xep-0022 , but i 
don't think the whole xep-0022 should be deprecated.


&gt;<i> However, that means many clients will support both for a while. In
</I>&gt;<i> certain scenarios that can result in use of message events instead of
</I>&gt;<i> chat state notifications. Consider the following example (where both
</I>&gt;<i> clients support both protocols):
</I>&gt;<i>
</I>&gt;<i> 1. Romeo sends an initial chat message to Juliet with 85 + 22 extensions.
</I>&gt;<i>
</I>&gt;<i> 2. Juliet doesn't reply immediately.
</I>&gt;<i>
</I>&gt;<i> 3. Romeo sends a second chat message to Juliet with 22 extenions only
</I>&gt;<i> (since 22 is message-based but rule 2 in Section 5.1 of XEP-0085 says
</I>&gt;<i> not to include 85 extensions after the first message).
</I>&gt;<i>
</I>&gt;<i> 4. Now Juliet sends a reply. Her client looks at the last message
</I>&gt;<i> received from Romeo and includes the 22 extension (but not the 85
</I>&gt;<i> extension) in her first message to Romeo.
</I>&gt;<i>
</I>&gt;<i> As a result, the clients end up using 22 instead of 85, even though
</I>&gt;<i> Romeo's client probably preferred to use 85.
</I>
This is not an issue, the client which support XEP 85 need to remember the 
state (active) from the first message.  The reason is that even if the client 
only support XEP 85, the second message will contains no extention.


&gt;<i> IMHO the solution is for Juliet's client to prefer the use of 85 and
</I>&gt;<i> toggle a bit that says &quot;Romeo sent me 85 extensions, use those in this
</I>&gt;<i> chat session&quot;. So the chat-session-level bit (85 support) takes
</I>&gt;<i> precedence over the message-level bit (22 support).
</I>
yes, exactly.

&gt;<i> Thanks to Mikael Berthe of the mcabber project for pointing this out to me!
</I>&gt;<i>
</I>&gt;<i> BTW, Mikael and discovered that several existing clients act like
</I>&gt;<i> Juliet's client in the above example, but I'm not naming names here. :)
</I>&gt;<i>
</I>&gt;<i> (And there are still clients that support only message events, but I'm
</I>&gt;<i> poking the relevant developers directly...)
</I>
Personally, in Kopete, I do support both 22 and 85, and i use both of them all 
the time.

--
Olivier (aka Gof)
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
URL: &lt;<A HREF="https://www.jabber.org/jdev/attachments/20061103/f7ae5ca0/attachment-0001.pgp">https://www.jabber.org/jdev/attachments/20061103/f7ae5ca0/attachment-0001.pgp</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="054775.html">[jdev] Re: message events + chat state notifications
</A></li>
	<LI>Next message: <A HREF="054779.html">[jdev] message events + chat state notifications
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#54778">[ date ]</a>
              <a href="thread.html#54778">[ thread ]</a>
              <a href="subject.html#54778">[ subject ]</a>
              <a href="author.html#54778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
