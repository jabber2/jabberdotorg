<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=%5Bjdev%5D%20Different%20behaviors%20of%20ejabbered%20and%20openFire%20in%20pushing%0A%09messages%20to%20the%20client%21&In-Reply-To=46779398.5080805%40defuze.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026348.html">
   <LINK REL="Next"  HREF="026353.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!</H1>
    <B>Tran Thai Son</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=%5Bjdev%5D%20Different%20behaviors%20of%20ejabbered%20and%20openFire%20in%20pushing%0A%09messages%20to%20the%20client%21&In-Reply-To=46779398.5080805%40defuze.org"
       TITLE="[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!">tofoneo at gmail.com
       </A><BR>
    <I>Tue Jun 19 03:56:47 CDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="026348.html">[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!
</A></li>
        <LI>Next message: <A HREF="026353.html">[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26349">[ date ]</a>
              <a href="thread.html#26349">[ thread ]</a>
              <a href="subject.html#26349">[ subject ]</a>
              <a href="author.html#26349">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the information, too.
Now all we can do is to make the client as fault-tolerant as possible :)

On 19/06/07, Sylvain Hellegouarch &lt;<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">sh at defuze.org</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Thanks for this summary because I've been reading these sections of RFC
</I>&gt;<i> 3921 *a lot* and there are so many different combinations that I lose it
</I>&gt;<i> quickly.
</I>&gt;<i>
</I>&gt;<i> /me pokes psa too. A diagram of all the different interactions would go
</I>&gt;<i> a long way /me thinks
</I>&gt;<i>
</I>&gt;<i> - Sylvain
</I>&gt;<i>
</I>&gt;<i> Mridul Muralidharan a &#233;crit :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   I think Peter is in the process of clarifying the bis spec on the
</I>&gt;<i> &gt; subscription appendix's. /me pokes psa :)
</I>&gt;<i> &gt; It might be a good idea to wait for that to be complete ... currently,
</I>&gt;<i> &gt; the state of specs is a bit icky from an impl point of view (though
</I>&gt;<i> &gt; well defined).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Roughly, 3921 says these :
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - a user can add any contact to his roster, this does not trigger a
</I>&gt;<i> &gt; presence subscription request - but a roster push(*) will occur.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - a user can ask for subscription to contact : (if contact is not in
</I>&gt;<i> &gt; the user's roster (step 1 omitted), it gets automatically added) this
</I>&gt;<i> &gt; triggers a roster push(*) with change in subscription status (ask
</I>&gt;<i> &gt; attribute).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - if contact is online, subscribe is pushed to all available resources
</I>&gt;<i> &gt; using rules similar to roster push(*).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - if contact is offline or no resource is available which satisfies
</I>&gt;<i> &gt; rule for roster push(*), this is stored for later delivery.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - if contact rejects subscription (unsubscribed), this triggers a
</I>&gt;<i> &gt; roster update in user's roster appropriately (must not result in
</I>&gt;<i> &gt; removal of entry - I see that some servers remove the contact's jid
</I>&gt;<i> &gt; from user roster) and a corresponding roster push(*).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - 3921 says that the unsubscribed must be delivered to the user's
</I>&gt;<i> &gt; resources(*).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; (*) The roster push above will happen only to all resources which have
</I>&gt;<i> &gt; requested (or modified) roster in some way (including asking for
</I>&gt;<i> &gt; subscription).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Similar steps above when contact's approves subscription.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The state table related to inbound unsubscribe, unsubscribed and
</I>&gt;<i> &gt; subscribed could be changed for 3921 bis spec (it has already been
</I>&gt;<i> &gt; changed for subscribed). If I am not wrong, the last step above would
</I>&gt;<i> &gt; not happen - that is, unsubscribe(d) will not be routed to the user.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Here, I assumed that there is no subscription between user &amp; contact,
</I>&gt;<i> &gt; if that is present, it just adds more to the flow - refer to section 9
</I>&gt;<i> &gt; in 3921 [1]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hope this clarifies. The steps above are the same irrespective of
</I>&gt;<i> &gt; whether it is a local contact, s2s contact, clustered configuration or
</I>&gt;<i> &gt; other combinations.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; Mridul
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [1] <A HREF="http://www.xmpp.org/rfcs/rfc3921.html#substates">http://www.xmpp.org/rfcs/rfc3921.html#substates</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Tran Thai Son wrote:
</I>&gt;<i> &gt;&gt; Hi all,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I am writing a client and I've experienced different behaviors from
</I>&gt;<i> &gt;&gt; different servers in handling client's actions such as add / accept /
</I>&gt;<i> &gt;&gt; deny subscription requests. What surprised me is that it seems there
</I>&gt;<i> &gt;&gt; is no standard behaviors ( e.g. processes of treating actions, order
</I>&gt;<i> &gt;&gt; of notification messages pushing to the clients...) for the server.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; E.g.:
</I>&gt;<i> &gt;&gt; - ejabbered 1.1.3 always adds the incoming contact to the user's
</I>&gt;<i> &gt;&gt; roster (with the subscription status = 0, means no relationship)
</I>&gt;<i> &gt;&gt; before pushing the subscription (add-friend) request to the user. So
</I>&gt;<i> &gt;&gt; the client gets two messages: one to notify that there is an item
</I>&gt;<i> &gt;&gt; added, the next to notify that there is a subscription request.
</I>&gt;<i> &gt;&gt; - meanwhile, openFire 3.3.1 does not add the contact before, so you
</I>&gt;<i> &gt;&gt; get only the later message. One (probably) bug I found: even when the
</I>&gt;<i> &gt;&gt; client sent a message denying the subscription request, the server
</I>&gt;<i> &gt;&gt; still adds the contact to the user's roster (with subscription= 0)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Furthermore, with the same actions from the clients, the number  and
</I>&gt;<i> &gt;&gt; order of messages that the servers send significantly different.
</I>&gt;<i> &gt;&gt; E.g.
</I>&gt;<i> &gt;&gt; - ejabbered 1.1.3 tends to not to send any message to the contact
</I>&gt;<i> &gt;&gt; with subscription = 0. Example: If user B denied a subscription
</I>&gt;<i> &gt;&gt; request from user B (means no relationship at the moment), B will not
</I>&gt;<i> &gt;&gt; receive the next unsubscription request from A, but with openFire
</I>&gt;<i> &gt;&gt; 3.3.1, it will.
</I>&gt;<i> &gt;&gt; - Furthermore, I found the order of messages that openFire pushes to
</I>&gt;<i> &gt;&gt; the clients rather annoying. For example, if user A removes user B
</I>&gt;<i> &gt;&gt; from its roster (and therefore B will also remove A - my
</I>&gt;<i> &gt;&gt; implementation), A will receive &quot;unsubscribed&quot; and &quot;unsubscribe&quot;
</I>&gt;<i> &gt;&gt; (respectively) from B before received the notification that its
</I>&gt;<i> &gt;&gt; removal was done. So you cannot trust that: when you remove a contact
</I>&gt;<i> &gt;&gt; from your roster, you won't receive unexpected message from that
</I>&gt;<i> &gt;&gt; contact; You also see that contact still in your roster for a while
</I>&gt;<i> &gt;&gt; (with subscription = 0).
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Does any body experience similar problems ?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Son.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://www.jabber.org/jdev/attachments/20070619/75a1bac5/attachment.htm">https://www.jabber.org/jdev/attachments/20070619/75a1bac5/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026348.html">[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!
</A></li>
	<LI>Next message: <A HREF="026353.html">[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26349">[ date ]</a>
              <a href="thread.html#26349">[ thread ]</a>
              <a href="subject.html#26349">[ subject ]</a>
              <a href="author.html#26349">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
