<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20Different%20behaviors%20of%20ejabbered%20and%20openFire%20in%20pushing%0A%09messages%20to%20the%20client%21&In-Reply-To=%3C4678005A.5050209%40defuze.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="055643.html">
   <LINK REL="Next"  HREF="055640.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!</H1>
    <B>Sylvain Hellegouarch</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=Re%3A%20%5Bjdev%5D%20Different%20behaviors%20of%20ejabbered%20and%20openFire%20in%20pushing%0A%09messages%20to%20the%20client%21&In-Reply-To=%3C4678005A.5050209%40defuze.org%3E"
       TITLE="[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!">sh at defuze.org
       </A><BR>
    <I>Tue Jun 19 11:12:10 CDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="055643.html">[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!
</A></li>
        <LI>Next message: <A HREF="055640.html">[jdev] JSJaC review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55644">[ date ]</a>
              <a href="thread.html#55644">[ thread ]</a>
              <a href="subject.html#55644">[ subject ]</a>
              <a href="author.html#55644">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>/me waves at Peter!

Peter Saint-Andre a &#233;crit :
&gt;<i> All will be revealed in rfc3921bis. :)
</I>&gt;<i>
</I>&gt;<i> But I need to finish my edits to rfc3920bis first...
</I>&gt;<i>
</I>&gt;<i> Soon.
</I>&gt;<i>
</I>&gt;<i> /psa
</I>&gt;<i>
</I>&gt;<i> Sylvain Hellegouarch wrote:
</I>&gt;&gt;<i> Thanks for this summary because I've been reading these sections of 
</I>&gt;&gt;<i> RFC 3921 *a lot* and there are so many different combinations that I 
</I>&gt;&gt;<i> lose it quickly.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /me pokes psa too. A diagram of all the different interactions would 
</I>&gt;&gt;<i> go a long way /me thinks
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - Sylvain
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Mridul Muralidharan a &#233;crit :
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>   I think Peter is in the process of clarifying the bis spec on the 
</I>&gt;&gt;&gt;<i> subscription appendix's. /me pokes psa :)
</I>&gt;&gt;&gt;<i> It might be a good idea to wait for that to be complete ... 
</I>&gt;&gt;&gt;<i> currently, the state of specs is a bit icky from an impl point of 
</I>&gt;&gt;&gt;<i> view (though well defined).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Roughly, 3921 says these :
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> - a user can add any contact to his roster, this does not trigger a 
</I>&gt;&gt;&gt;<i> presence subscription request - but a roster push(*) will occur.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> - a user can ask for subscription to contact : (if contact is not in 
</I>&gt;&gt;&gt;<i> the user's roster (step 1 omitted), it gets automatically added) 
</I>&gt;&gt;&gt;<i> this triggers a roster push(*) with change in subscription status (ask
</I>&gt;&gt;&gt;<i> attribute).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> - if contact is online, subscribe is pushed to all available 
</I>&gt;&gt;&gt;<i> resources using rules similar to roster push(*).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> - if contact is offline or no resource is available which satisfies 
</I>&gt;&gt;&gt;<i> rule for roster push(*), this is stored for later delivery.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> - if contact rejects subscription (unsubscribed), this triggers a 
</I>&gt;&gt;&gt;<i> roster update in user's roster appropriately (must not result in 
</I>&gt;&gt;&gt;<i> removal of entry - I see that some servers remove the contact's jid 
</I>&gt;&gt;&gt;<i> from user roster) and a corresponding roster push(*).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> - 3921 says that the unsubscribed must be delivered to the user's 
</I>&gt;&gt;&gt;<i> resources(*).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> (*) The roster push above will happen only to all resources which 
</I>&gt;&gt;&gt;<i> have requested (or modified) roster in some way (including asking 
</I>&gt;&gt;&gt;<i> for subscription).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Similar steps above when contact's approves subscription.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The state table related to inbound unsubscribe, unsubscribed and 
</I>&gt;&gt;&gt;<i> subscribed could be changed for 3921 bis spec (it has already been 
</I>&gt;&gt;&gt;<i> changed for subscribed). If I am not wrong, the last step above 
</I>&gt;&gt;&gt;<i> would not happen - that is, unsubscribe(d) will not be routed to the 
</I>&gt;&gt;&gt;<i> user.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Here, I assumed that there is no subscription between user &amp; 
</I>&gt;&gt;&gt;<i> contact, if that is present, it just adds more to the flow - refer 
</I>&gt;&gt;&gt;<i> to section 9 in 3921 [1]
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hope this clarifies. The steps above are the same irrespective of 
</I>&gt;&gt;&gt;<i> whether it is a local contact, s2s contact, clustered configuration 
</I>&gt;&gt;&gt;<i> or other combinations.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Regards,
</I>&gt;&gt;&gt;<i> Mridul
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> [1] <A HREF="http://www.xmpp.org/rfcs/rfc3921.html#substates">http://www.xmpp.org/rfcs/rfc3921.html#substates</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Tran Thai Son wrote:
</I>&gt;&gt;&gt;&gt;<i> Hi all,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I am writing a client and I've experienced different behaviors from 
</I>&gt;&gt;&gt;&gt;<i> different servers in handling client's actions such as add / accept 
</I>&gt;&gt;&gt;&gt;<i> / deny subscription requests. What surprised me is that it seems 
</I>&gt;&gt;&gt;&gt;<i> there is no standard behaviors ( e.g. processes of treating 
</I>&gt;&gt;&gt;&gt;<i> actions, order of notification messages pushing to the clients...) 
</I>&gt;&gt;&gt;&gt;<i> for the server.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> E.g.:
</I>&gt;&gt;&gt;&gt;<i> - ejabbered 1.1.3 always adds the incoming contact to the user's 
</I>&gt;&gt;&gt;&gt;<i> roster (with the subscription status = 0, means no relationship) 
</I>&gt;&gt;&gt;&gt;<i> before pushing the subscription (add-friend) request to the user. 
</I>&gt;&gt;&gt;&gt;<i> So the client gets two messages: one to notify that there is an 
</I>&gt;&gt;&gt;&gt;<i> item added, the next to notify that there is a subscription request.
</I>&gt;&gt;&gt;&gt;<i> - meanwhile, openFire 3.3.1 does not add the contact before, so you 
</I>&gt;&gt;&gt;&gt;<i> get only the later message. One (probably) bug I found: even when 
</I>&gt;&gt;&gt;&gt;<i> the client sent a message denying the subscription request, the 
</I>&gt;&gt;&gt;&gt;<i> server still adds the contact to the user's roster (with 
</I>&gt;&gt;&gt;&gt;<i> subscription= 0)
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Furthermore, with the same actions from the clients, the number  
</I>&gt;&gt;&gt;&gt;<i> and order of messages that the servers send significantly different.
</I>&gt;&gt;&gt;&gt;<i> E.g.
</I>&gt;&gt;&gt;&gt;<i> - ejabbered 1.1.3 tends to not to send any message to the contact 
</I>&gt;&gt;&gt;&gt;<i> with subscription = 0. Example: If user B denied a subscription 
</I>&gt;&gt;&gt;&gt;<i> request from user B (means no relationship at the moment), B will 
</I>&gt;&gt;&gt;&gt;<i> not receive the next unsubscription request from A, but with 
</I>&gt;&gt;&gt;&gt;<i> openFire 3.3.1, it will.
</I>&gt;&gt;&gt;&gt;<i> - Furthermore, I found the order of messages that openFire pushes 
</I>&gt;&gt;&gt;&gt;<i> to the clients rather annoying. For example, if user A removes user 
</I>&gt;&gt;&gt;&gt;<i> B from its roster (and therefore B will also remove A - my 
</I>&gt;&gt;&gt;&gt;<i> implementation), A will receive &quot;unsubscribed&quot; and &quot;unsubscribe&quot; 
</I>&gt;&gt;&gt;&gt;<i> (respectively) from B before received the notification that its 
</I>&gt;&gt;&gt;&gt;<i> removal was done. So you cannot trust that: when you remove a 
</I>&gt;&gt;&gt;&gt;<i> contact from your roster, you won't receive unexpected message from 
</I>&gt;&gt;&gt;&gt;<i> that contact; You also see that contact still in your roster for a 
</I>&gt;&gt;&gt;&gt;<i> while (with subscription = 0).
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Does any body experience similar problems ?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Son.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="055643.html">[jdev] Different behaviors of ejabbered and openFire in pushing	messages to the client!
</A></li>
	<LI>Next message: <A HREF="055640.html">[jdev] JSJaC review
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#55644">[ date ]</a>
              <a href="thread.html#55644">[ thread ]</a>
              <a href="subject.html#55644">[ subject ]</a>
              <a href="author.html#55644">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
