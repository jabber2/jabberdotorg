<tt>
&lt;!doctype&nbsp;html&nbsp;public&nbsp;&quot;-//w3c//dtd&nbsp;html&nbsp;4.0&nbsp;transitional//en&quot;&gt;<br>
&lt;html&gt;<br>
&amp;nbsp;<br>
&lt;br&gt;We&nbsp;have&nbsp;had&nbsp;the&nbsp;same&nbsp;problem&nbsp;running&nbsp;on&lt;b&gt;&nbsp;Solaris&nbsp;8&nbsp;&lt;/b&gt;using&nbsp;&lt;b&gt;Jabber<br>
1.4.1&lt;/b&gt;&nbsp;and&nbsp;&lt;b&gt;Conference&nbsp;0.4.1&lt;/b&gt;<br>
&lt;br&gt;We&nbsp;have&nbsp;tracked&nbsp;the&nbsp;problem&nbsp;to&nbsp;the&nbsp;function&nbsp;&lt;i&gt;xmlnode_insert_node()&amp;nbsp;&lt;/i&gt;<br>
in&nbsp;the&nbsp;file&nbsp;&lt;i&gt;xmlnode.c&lt;/i&gt;&nbsp;of&nbsp;the<br>
&lt;br&gt;Jabber&nbsp;server.<br>
&lt;p&gt;The&nbsp;fix&nbsp;to&nbsp;the&nbsp;problem&nbsp;is&nbsp;to&nbsp;change&nbsp;the&nbsp;following&nbsp;statement&nbsp;in&nbsp;the&nbsp;function<br>
&lt;i&gt;xmlnode_insert_data()&lt;/i&gt;<br>
:<br>
&lt;p&gt;&lt;i&gt;xmlnode_insert_cdata(parent,&nbsp;xmlnode_get_data(node),&nbsp;xmlnode_get_datasz(node));&lt;/i&gt;<br>
&lt;p&gt;This&nbsp;statement&nbsp;will&nbsp;work&nbsp;if&nbsp;the&nbsp;function&nbsp;&lt;i&gt;xmlnode_get_datasz()&lt;/i&gt;<br>
is&nbsp;evaluated&nbsp;before<br>
&lt;br&gt;&lt;i&gt;xmlnode_get_data()&lt;/i&gt;.&nbsp;This&nbsp;is&nbsp;clearly&nbsp;not&nbsp;the&nbsp;case&nbsp;on&nbsp;my&nbsp;version<br>
of&nbsp;the&nbsp;jabber&nbsp;server&nbsp;compiled&nbsp;on&nbsp;Solaris&nbsp;with&nbsp;gcc.&nbsp;The&nbsp;'C'&nbsp;standard&nbsp;does<br>
not&nbsp;specify&nbsp;the&nbsp;order&nbsp;of&nbsp;evaluation&nbsp;of&nbsp;functions/expresssions&nbsp;that&nbsp;are<br>
passed&nbsp;as&nbsp;parameters&nbsp;to&nbsp;a&nbsp;function,&nbsp;it&nbsp;only&nbsp;says&nbsp;that&nbsp;they&nbsp;will&nbsp;be&nbsp;evaluated<br>
-&nbsp;the&nbsp;order&nbsp;of&nbsp;which&amp;nbsp;&nbsp;is&nbsp;implementation&amp;nbsp;&nbsp;dependent&nbsp;(which&nbsp;explains<br>
why&nbsp;it&nbsp;works&nbsp;on&nbsp;some&nbsp;systems).<br>
&lt;p&gt;To&nbsp;fix&nbsp;the&nbsp;problem&nbsp;we&nbsp;changed&nbsp;the&nbsp;statement&nbsp;to&nbsp;the&nbsp;following:<br>
&lt;p&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;dataSize&lt;/i&gt;<br>
&lt;br&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&nbsp;...&lt;/i&gt;<br>
&lt;br&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;dataSize&nbsp;=&nbsp;xmlnode_get_datasz(node);&lt;/i&gt;<br>
&lt;br&gt;&lt;i&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;xmlnode_insert_cdata(parent,&nbsp;xmlnode_get_data(node),<br>
dataSize);&lt;/i&gt;<br>
&lt;p&gt;to&nbsp;ensures&nbsp;that&nbsp;&lt;i&gt;xmlnode_get_datasz()&lt;/i&gt;&nbsp;is&nbsp;evaluated&nbsp;first.<br>
&lt;p&gt;This&nbsp;works&nbsp;for&nbsp;us;&nbsp;if&nbsp;there&nbsp;is&nbsp;another&nbsp;fix&nbsp;for&nbsp;this&nbsp;please&nbsp;let&nbsp;us&nbsp;know.<br>
&lt;br&gt;&amp;nbsp;<br>
&lt;p&gt;Jens&nbsp;Alfke&nbsp;wrote:<br>
&lt;blockquote&nbsp;TYPE=CITE&gt;On&nbsp;Thursday,&nbsp;September&nbsp;20,&nbsp;2001,&nbsp;at&nbsp;10:35&nbsp;PM,&nbsp;jabber@msg.net<br>
wrote:<br>
&lt;p&gt;&gt;&nbsp;I&nbsp;am&nbsp;also&amp;nbsp;&nbsp;getting&nbsp;conference&nbsp;messages&nbsp;truncated,&nbsp;often&nbsp;at&nbsp;the<br>
first<br>
&lt;br&gt;&gt;&nbsp;byte<br>
&lt;br&gt;&gt;&nbsp;of&nbsp;a&nbsp;one-liner.&nbsp;Using&nbsp;JabberIM&nbsp;I&nbsp;will&nbsp;type&nbsp;something&nbsp;like:<br>
&lt;br&gt;&gt;<br>
&lt;br&gt;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;I&nbsp;see&nbsp;this&nbsp;problem&nbsp;too,&nbsp;looks<br>
like&nbsp;it&nbsp;is&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;server?<br>
&lt;br&gt;&gt;<br>
&lt;br&gt;&gt;&nbsp;And&nbsp;what&nbsp;the&nbsp;participants&nbsp;see&nbsp;and&nbsp;what&nbsp;I&nbsp;get&nbsp;echoed&nbsp;back&nbsp;is&nbsp;just:<br>
&lt;br&gt;&gt;<br>
&lt;br&gt;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;I<br>
&lt;p&gt;I&nbsp;haven't&nbsp;seen&nbsp;this&nbsp;exact&nbsp;behavior.&nbsp;What&nbsp;I&nbsp;see&nbsp;is&nbsp;that&nbsp;messages&nbsp;get<br>
&lt;br&gt;truncated&nbsp;at&nbsp;XML&nbsp;metacharacters&nbsp;(&nbsp;&amp;lt;,&nbsp;&gt;,&nbsp;',&nbsp;&quot;,&nbsp;&amp;amp;).&nbsp;In&nbsp;my&nbsp;client<br>
I<br>
&lt;br&gt;preprocess&nbsp;messages&nbsp;to&nbsp;convert&nbsp;these&nbsp;to&nbsp;more&nbsp;innocuous&nbsp;characters&nbsp;such<br>
&lt;br&gt;as&nbsp;curly&nbsp;quotes.<br>
&lt;p&gt;--Jens<br>
&lt;p&gt;_______________________________________________<br>
&lt;br&gt;jdev&nbsp;mailing&nbsp;list<br>
&lt;br&gt;jdev@jabber.org<br>
&lt;br&gt;&lt;a&nbsp;href=&quot;http://mailman.jabber.org/listinfo/jdev&quot;&gt;http://mailman.jabber.org/listinfo/jdev&lt;/a&gt;&lt;/blockquote&gt;<br>
&lt;/html&gt;<br>

</tt>
