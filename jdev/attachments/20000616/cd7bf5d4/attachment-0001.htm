<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;content=&quot;text/html;&nbsp;charset=gb2312&quot;&nbsp;http-equiv=Content-Type&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;5.00.2920.0&quot;&nbsp;name=GENERATOR&gt;<br>
&lt;STYLE&gt;&lt;/STYLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;bgColor=#ffffff&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Hi,&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;in&nbsp;libfaim&nbsp;aim_snac.c&nbsp;function&nbsp;<br>
&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;int&nbsp;aim_cleansnacs(struct&nbsp;aim_session_t&nbsp;<br>
*sess,&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;maxage)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;&nbsp;struct&nbsp;aim_snac_t&nbsp;<br>
*cur;&lt;BR&gt;&amp;nbsp;&nbsp;struct&nbsp;aim_snac_t&nbsp;*remed&nbsp;=&nbsp;NULL;&lt;BR&gt;&amp;nbsp;&nbsp;time_t&nbsp;<br>
curtime;&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&nbsp;cur&nbsp;=&nbsp;sess-&amp;gt;outstanding_snacs;&lt;BR&gt;&amp;nbsp;&nbsp;<br>
&lt;BR&gt;&amp;nbsp;&nbsp;curtime&nbsp;=&nbsp;time(&amp;amp;curtime);&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&nbsp;while&nbsp;<br>
(cur)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(&nbsp;(cur)&nbsp;<br>
&amp;amp;&amp;amp;&nbsp;(((cur-&amp;gt;issuetime)&nbsp;+&nbsp;maxage)&nbsp;&amp;lt;&nbsp;curtime))&lt;BR&gt;&amp;nbsp;{&lt;BR&gt;#if&nbsp;<br>
DEBUG&nbsp;&amp;gt;&nbsp;1&lt;BR&gt;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;aimsnac:&nbsp;WARNING&nbsp;purged&nbsp;obsolete&nbsp;snac&nbsp;<br>
%08lx\n&quot;,&nbsp;cur-&amp;gt;id);&lt;BR&gt;#endif&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&nbsp;remed&nbsp;=&nbsp;aim_remsnac(sess,&nbsp;<br>
cur-&amp;gt;id);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(remed)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;<br>
(remed-&amp;gt;data)&lt;BR&gt;&amp;nbsp;&amp;nbsp;free(remed-&amp;gt;data);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
free(remed);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;after&nbsp;exec&nbsp;this&nbsp;statment,it&nbsp;<br>
cause&nbsp;a&nbsp;crash&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
size=2&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;BR&gt;&amp;nbsp;}&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
cur&nbsp;=&nbsp;cur-&amp;gt;next;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&nbsp;return&nbsp;0;&lt;BR&gt;}&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;so&nbsp;maybe&nbsp;change&nbsp;function&nbsp;to&nbsp;this&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;BR&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;int&nbsp;aim_cleansnacs(struct&nbsp;aim_session_t&nbsp;<br>
*sess,&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;int&nbsp;maxage)&lt;BR&gt;{&lt;BR&gt;&amp;nbsp;&nbsp;struct&nbsp;aim_snac_t&nbsp;<br>
*cur;&lt;BR&gt;&amp;nbsp;&nbsp;&lt;STRONG&gt;&lt;FONT&nbsp;color=#ff0000&gt;struct&nbsp;aim_snac_t&nbsp;<br>
*curnext;&lt;/FONT&gt;&lt;/STRONG&gt;&lt;BR&gt;&amp;nbsp;&nbsp;struct&nbsp;aim_snac_t&nbsp;*remed&nbsp;=&nbsp;NULL;&lt;BR&gt;&amp;nbsp;&nbsp;<br>
time_t&nbsp;curtime;&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&nbsp;cur&nbsp;=&nbsp;sess-&amp;gt;outstanding_snacs;&lt;BR&gt;&amp;nbsp;&nbsp;<br>
&lt;BR&gt;&amp;nbsp;&nbsp;curtime&nbsp;=&nbsp;time(&amp;amp;curtime);&lt;BR&gt;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&nbsp;while&nbsp;<br>
(cur)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;STRONG&gt;&lt;FONT&nbsp;<br>
color=#ff0000&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;curnext&nbsp;=&nbsp;<br>
cur;&lt;/FONT&gt;&lt;/STRONG&gt;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(&nbsp;(cur)&nbsp;&amp;amp;&amp;amp;&nbsp;<br>
(((cur-&amp;gt;issuetime)&nbsp;+&nbsp;maxage)&nbsp;&amp;lt;&nbsp;curtime))&lt;BR&gt;&amp;nbsp;{&lt;BR&gt;#if&nbsp;DEBUG&nbsp;&amp;gt;&nbsp;<br>
1&lt;BR&gt;&amp;nbsp;&amp;nbsp;&nbsp;printf(&quot;aimsnac:&nbsp;WARNING&nbsp;purged&nbsp;obsolete&nbsp;snac&nbsp;%08lx\n&quot;,&nbsp;<br>
cur-&amp;gt;id);&lt;BR&gt;#endif&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&nbsp;remed&nbsp;=&nbsp;aim_remsnac(sess,&nbsp;<br>
cur-&amp;gt;id);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;(remed)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if&nbsp;<br>
(remed-&amp;gt;data)&lt;BR&gt;&amp;nbsp;&amp;nbsp;free(remed-&amp;gt;data);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
free(remed);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;after&nbsp;exec&nbsp;this&nbsp;statment,it&nbsp;<br>
cause&nbsp;a&nbsp;crash&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
size=2&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;BR&gt;&amp;nbsp;}&lt;BR&gt;&lt;STRONG&gt;&lt;FONT&nbsp;<br>
color=#ff0000&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cur&nbsp;=&nbsp;<br>
curnext;&lt;/FONT&gt;&lt;/STRONG&gt;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&lt;BR&gt;&amp;nbsp;&nbsp;return&nbsp;<br>
0;&lt;BR&gt;}&lt;/FONT&gt;&lt;/DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;&lt;/FONT&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
