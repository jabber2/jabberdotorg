<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&nbsp;http-equiv=Content-Type&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;5.00.2920.0&quot;&nbsp;name=GENERATOR&gt;<br>
&lt;STYLE&gt;&lt;/STYLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;bgColor=#ffffff&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;I&nbsp;have&nbsp;experienced&nbsp;a&nbsp;problem&nbsp;<br>
with&nbsp;the&nbsp;AIM&nbsp;0.9.5&nbsp;transport&nbsp;not&nbsp;sending&nbsp;'online'&nbsp;presence&nbsp;updates&nbsp;back&nbsp;<br>
to&lt;/FONT&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&nbsp;the&nbsp;WinJab&nbsp;client&nbsp;if&nbsp;a&nbsp;buddy&nbsp;logs&nbsp;back&nbsp;in&nbsp;<br>
after&nbsp;having&nbsp;logged&nbsp;out&nbsp;once&nbsp;while&nbsp;my&nbsp;WinJab&amp;nbsp;was&nbsp;online.&nbsp;Here&nbsp;is&nbsp;a&nbsp;code&nbsp;<br>
segment&nbsp;from&nbsp;buddies.c,&nbsp;lines&nbsp;267+&amp;nbsp;&nbsp;in&nbsp;function&nbsp;<br>
at_parse_incoming():&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Courier&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;was_away&nbsp;=&nbsp;<br>
buddy-&amp;gt;is_away;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
if(userinfo-&amp;gt;flags&amp;amp;AIM_FLAG_AWAY)&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
buddy-&amp;gt;is_away&nbsp;=&nbsp;1;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
else&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;buddy-&amp;gt;is_away&nbsp;=&nbsp;<br>
0;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Courier&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;if(buddy-&amp;gt;is_away&nbsp;==&nbsp;0&nbsp;<br>
&amp;amp;&amp;amp;&nbsp;(buddy-&amp;gt;is_away&nbsp;!=&nbsp;was_away))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;x&nbsp;=&nbsp;<br>
xmlnode_new_tag(&quot;presence&quot;);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
xmlnode_put_attrib(x,&nbsp;&quot;to&quot;,&nbsp;<br>
jid_full(s-&amp;gt;cur));&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
xmlnode_put_attrib(x,&nbsp;&quot;from&quot;,&nbsp;<br>
ti-&amp;gt;i-&amp;gt;id);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
jp&nbsp;=&nbsp;jpacket_new(x);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
jid_set(jp-&amp;gt;from,&nbsp;at_normalize(userinfo-&amp;gt;sn),&nbsp;<br>
JID_USER);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
xmlnode_put_attrib(jp-&amp;gt;x,&nbsp;&quot;from&quot;,&nbsp;<br>
jid_full(jp-&amp;gt;from));&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;status&nbsp;=&nbsp;<br>
xmlnode_insert_tag(x,&nbsp;&quot;status&quot;);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
xmlnode_insert_cdata(status,&nbsp;&quot;Online&quot;,&nbsp;<br>
-1);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
deliver(dpacket_new(jp-&amp;gt;x),&nbsp;ti-&amp;gt;i);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&gt;&lt;FONT&nbsp;face=Courier&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;else&nbsp;<br>
if(buddy-&amp;gt;is_away&nbsp;==&nbsp;1&nbsp;&amp;amp;&amp;amp;&nbsp;(buddy-&amp;gt;is_away&nbsp;!=&nbsp;<br>
was_away))&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;{&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
log_debug(ZONE,&nbsp;&quot;[AT]&nbsp;Requesting&nbsp;Away&nbsp;message&nbsp;for&nbsp;%s&quot;,&nbsp;<br>
userinfo-&amp;gt;sn);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;aim_getinfo(ass,&nbsp;<br>
command-&amp;gt;conn,&nbsp;userinfo-&amp;gt;sn,&nbsp;<br>
AIM_GETINFO_AWAYMESSAGE);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;}&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&gt;&lt;FONT&nbsp;face=Courier&gt;&lt;BR&gt;&amp;nbsp;&lt;/DIV&gt;&lt;/FONT&gt;&lt;/FONT&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;This&nbsp;code&nbsp;makes&nbsp;calls&nbsp;to&nbsp;<br>
generate&nbsp;an&nbsp;XML&nbsp;presence&nbsp;message&nbsp;back&nbsp;to&nbsp;the&nbsp;jabberd,&nbsp;so&nbsp;it&nbsp;may&nbsp;alert&nbsp;the&nbsp;client&nbsp;<br>
of&nbsp;a&nbsp;change&nbsp;in&nbsp;user&nbsp;presence&nbsp;information.&nbsp;However,&nbsp;it&nbsp;does&nbsp;not&nbsp;account&nbsp;for&nbsp;the&nbsp;<br>
case&nbsp;where:&nbsp;buddy-&amp;gt;is_away&nbsp;is&nbsp;initially&nbsp;0&nbsp;and&nbsp;&lt;/FONT&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
size=2&gt;userinfo-&amp;gt;flags&amp;amp;AIM_FLAG_AWAY&nbsp;is&nbsp;also&nbsp;0.&nbsp;In&nbsp;that&nbsp;case,&nbsp;<br>
buddy-&amp;gt;is_away&nbsp;is&nbsp;set&nbsp;to&nbsp;0&nbsp;(this&nbsp;occurs&nbsp;when&nbsp;a&nbsp;buddy,&nbsp;who&nbsp;was&nbsp;not&nbsp;'away'&nbsp;logs&nbsp;<br>
out&nbsp;and&nbsp;back&nbsp;in&nbsp;again),&nbsp;and&nbsp;the&amp;nbsp;expression&nbsp;(buddy-&amp;gt;is_away&nbsp;==&nbsp;0&nbsp;<br>
&amp;amp;&amp;amp;&nbsp;(buddy-&amp;gt;is_away&nbsp;!=&nbsp;was_away))&nbsp;is&nbsp;false,&nbsp;so&nbsp;no&nbsp;presence&nbsp;message&nbsp;is&nbsp;<br>
sent&nbsp;to&nbsp;the&nbsp;jabberd&nbsp;in&nbsp;this&nbsp;case.&nbsp;(I&nbsp;assume&nbsp;that&nbsp;the&nbsp;other&nbsp;case&nbsp;of&nbsp;'was_away&nbsp;==&nbsp;<br>
1&nbsp;&amp;amp;&amp;amp;&nbsp;buddy-&amp;gt;is_away&nbsp;==&nbsp;1'&nbsp;should&nbsp;never&nbsp;occur.)&lt;/FONT&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
size=2&gt;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Changing&nbsp;the&nbsp;expression&nbsp;(buddy-&amp;gt;is_away&nbsp;==&nbsp;0&nbsp;<br>
&amp;amp;&amp;amp;&nbsp;(buddy-&amp;gt;is_away&nbsp;!=&nbsp;was_away))&nbsp;to&nbsp;just&nbsp;(&nbsp;buddy-&amp;gt;is_away&nbsp;==&nbsp;0&nbsp;)&nbsp;<br>
after&nbsp;the&nbsp;'if'&nbsp;apparently&nbsp;resolves&nbsp;the&nbsp;problem&nbsp;-&nbsp;at&nbsp;least&nbsp;for&nbsp;my&nbsp;WinJab&nbsp;<br>
tests.&amp;nbsp;Since&nbsp;I&nbsp;am&nbsp;not&nbsp;familiar&nbsp;with&nbsp;precisely&nbsp;what&nbsp;each&nbsp;line&nbsp;of&nbsp;code&nbsp;does,&nbsp;<br>
I'm&nbsp;not&nbsp;certain&nbsp;if&nbsp;this&nbsp;is&nbsp;completely&nbsp;correct,&nbsp;or&nbsp;whether&nbsp;another&nbsp;'else&nbsp;if'&nbsp;to&nbsp;<br>
do&nbsp;something&nbsp;slightly&nbsp;different&nbsp;is&nbsp;preferred.&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;-Kevin&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
