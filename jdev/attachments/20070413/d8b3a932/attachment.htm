<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=gb2312&quot;&gt;<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;6.00.2900.3059&quot;&nbsp;name=GENERATOR&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;hi&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;I&nbsp;have&nbsp;a&nbsp;similar&nbsp;<br>
problem.&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;i'm&nbsp;trying&nbsp;out&nbsp;the&nbsp;feature&nbsp;of&nbsp;&quot;XEP-0013&nbsp;<br>
Flexible&nbsp;Offline&nbsp;Message&nbsp;Retrieval&quot;,&nbsp;and&nbsp;I&nbsp;wish&nbsp;the&nbsp;Server&nbsp;will&nbsp;keep&nbsp;the&nbsp;offline&nbsp;<br>
messages&nbsp;.&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;I&nbsp;wrote&nbsp;the&nbsp;following&nbsp;codes&nbsp;is&nbsp;function&nbsp;<br>
&quot;XmppCon_OnRosterEnd&quot;&nbsp;of&nbsp;agsXMPP&nbsp;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;<br>
size=2&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;//Send&nbsp;<br>
Request&nbsp;of&nbsp;Offline&nbsp;Message&nbsp;<br>
Headers&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;IQ&nbsp;<br>
offLineIQ&nbsp;=&nbsp;new&nbsp;<br>
IQ(IqType.get);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
Element&nbsp;el&nbsp;=&nbsp;new&nbsp;Element()&nbsp;<br>
;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
el.TagName&nbsp;=&nbsp;<br>
&quot;query&quot;;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
el.SetNamespace(&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/disco#item&quot;&gt;http://jabber.org/protocol/disco#item&lt;/A&gt;&quot;);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
el.SetAttribute(&quot;node&quot;,&nbsp;&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/offline&quot;&gt;http://jabber.org/protocol/offline&lt;/A&gt;&quot;);&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
offLineIQ.Query&nbsp;=&nbsp;<br>
el;&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;<br>
XmppCon.Send(offLineIQ);&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;and&nbsp;here&nbsp;is&nbsp;the&nbsp;messages&nbsp;between&nbsp;client&nbsp;and&nbsp;<br>
server&nbsp;when&nbsp;login(the&nbsp;Client&nbsp;is&nbsp;Using&nbsp;agsXMPP&nbsp;lib&nbsp;I&nbsp;<br>
modified):&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;...................&lt;BR&gt;SEND:&nbsp;&amp;lt;iq&nbsp;<br>
xmlns=&quot;jabber:client&quot;&nbsp;id=&quot;agsXMPP_6&quot;&nbsp;type=&quot;get&quot;&nbsp;to=&quot;sunxiaodong&quot;&amp;gt;&amp;lt;query&nbsp;<br>
xmlns=&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/disco#info&quot;&gt;http://jabber.org/protocol/disco#info&lt;/A&gt;&quot;&nbsp;<br>
/&amp;gt;&amp;lt;/iq&amp;gt;&lt;BR&gt;.............&lt;BR&gt;SEND:&nbsp;&amp;lt;iq&nbsp;xmlns=&quot;jabber:client&quot;&nbsp;<br>
type=&quot;get&quot;&amp;gt;&amp;lt;query&nbsp;xmlns=&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/disco#item&quot;&gt;http://jabber.org/protocol/disco#item&lt;/A&gt;&quot;&nbsp;<br>
node=&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/offline&quot;&gt;http://jabber.org/protocol/offline&lt;/A&gt;&quot;&nbsp;<br>
/&amp;gt;&amp;lt;/iq&amp;gt;&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;SEND:&nbsp;&amp;lt;presence&nbsp;<br>
xmlns=&quot;jabber:client&quot;&amp;gt;&amp;lt;status&nbsp;<br>
/&amp;gt;&amp;lt;priority&amp;gt;10&amp;lt;/priority&amp;gt;&amp;lt;/presence&amp;gt;&lt;BR&gt;................&lt;BR&gt;RECV:&nbsp;<br>
&amp;lt;iq&nbsp;xmlns=&quot;jabber:client&quot;&nbsp;from=&quot;sunxiaodong&quot;&nbsp;to=&quot;&lt;A&nbsp;<br>
href=&quot;mailto:offmsg@sunxiaodong/MiniClient&quot;&gt;offmsg@sunxiaodong/MiniClient&lt;/A&gt;&quot;&nbsp;<br>
type=&quot;result&quot;&nbsp;id=&quot;agsXMPP_6&quot;&amp;gt;&amp;lt;query&nbsp;xmlns=&quot;&lt;A&nbsp;<br>
href='http://jabber.org/protocol/disco#info&quot;&gt;&lt;identity'&gt;http://jabber.org/protocol/disco#info&quot;&amp;gt;&amp;lt;identity&lt;/A&gt;&nbsp;<br>
name=&quot;Wildfire&nbsp;Server&quot;&nbsp;category=&quot;server&quot;&nbsp;type=&quot;im&quot;&nbsp;/&amp;gt;&amp;lt;feature&nbsp;var=&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/disco#info&quot;&gt;http://jabber.org/protocol/disco#info&lt;/A&gt;&quot;&nbsp;<br>
/&amp;gt;&amp;lt;feature&nbsp;var=&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/address&quot;&gt;http://jabber.org/protocol/address&lt;/A&gt;&quot;&nbsp;<br>
/&amp;gt;&amp;lt;feature&nbsp;var=&quot;vcard-temp&quot;&nbsp;/&amp;gt;&amp;lt;feature&nbsp;var=&quot;jabber:iq:private&quot;&nbsp;<br>
/&amp;gt;&amp;lt;feature&nbsp;var=&quot;jabber:iq:register&quot;&nbsp;/&amp;gt;&amp;lt;feature&nbsp;<br>
var=&quot;jabber:iq:roster&quot;&nbsp;/&amp;gt;&amp;lt;feature&nbsp;var=&quot;jabber:iq:time&quot;&nbsp;/&amp;gt;&amp;lt;feature&nbsp;<br>
var=&quot;jabber:iq:version&quot;&nbsp;/&amp;gt;&amp;lt;feature&nbsp;var=&quot;jabber:iq:last&quot;&nbsp;/&amp;gt;&amp;lt;feature&nbsp;<br>
var=&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/disco#items&quot;&gt;http://jabber.org/protocol/disco#items&lt;/A&gt;&quot;&nbsp;<br>
/&amp;gt;&amp;lt;feature&nbsp;var=&quot;&lt;A&nbsp;<br>
href='http://jabber.org/protocol/offline&quot;/&gt;&lt;feature'&gt;http://jabber.org/protocol/offline&quot;/&amp;gt;&amp;lt;feature&lt;/A&gt;&nbsp;<br>
var=&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/commands&quot;&gt;http://jabber.org/protocol/commands&lt;/A&gt;&quot;&nbsp;<br>
/&amp;gt;&amp;lt;feature&nbsp;var=&quot;jabber:iq:privacy&quot;&nbsp;<br>
/&amp;gt;&amp;lt;/query&amp;gt;&amp;lt;/iq&amp;gt;&lt;BR&gt;....................&lt;BR&gt;RECV:&nbsp;&amp;lt;iq&nbsp;<br>
xmlns=&quot;jabber:client&quot;&nbsp;to=&quot;&lt;A&nbsp;<br>
href=&quot;mailto:offmsg@sunxiaodong/MiniClient&quot;&gt;offmsg@sunxiaodong/MiniClient&lt;/A&gt;&quot;&nbsp;<br>
type=&quot;error&quot;&amp;gt;&amp;lt;query&nbsp;xmlns=&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/disco#item&quot;&gt;http://jabber.org/protocol/disco#item&lt;/A&gt;&quot;&nbsp;<br>
node=&quot;&lt;A&nbsp;<br>
href=&quot;http://jabber.org/protocol/offline&quot;&gt;http://jabber.org/protocol/offline&lt;/A&gt;&quot;&nbsp;<br>
/&amp;gt;&amp;lt;error&nbsp;code=&quot;503&quot;&nbsp;type=&quot;cancel&quot;&amp;gt;&amp;lt;service-unavailable&nbsp;<br>
xmlns=&quot;urn:ietf:params:xml:ns:xmpp-stanzas&quot;&nbsp;<br>
/&amp;gt;&amp;lt;/error&amp;gt;&amp;lt;/iq&amp;gt;&lt;BR&gt;...................&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;503&nbsp;is&nbsp;&quot;Service&nbsp;Unavailable&quot;&nbsp;error,&nbsp;but&nbsp;<br>
why?&nbsp;I&nbsp;think&nbsp;the&nbsp;bold&nbsp;characters&nbsp;mean&nbsp;that&nbsp;the&nbsp;server&nbsp;support&nbsp;the&nbsp;feature,&nbsp;isn't&nbsp;<br>
it?&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;this&nbsp;troubles&nbsp;me,&nbsp;help&nbsp;please&nbsp;.....&nbsp;thank&nbsp;<br>
you&nbsp;very&nbsp;much!&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Verdana&gt;&lt;FONT&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&nbsp;align=left&gt;&lt;FONT&nbsp;size=2&gt;<br>
&lt;HR&nbsp;style=&quot;WIDTH:&nbsp;122px;&nbsp;HEIGHT:&nbsp;2px&quot;&nbsp;SIZE=2&gt;<br>
&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;color=#c0c0c0&gt;&lt;FONT&nbsp;size=2&gt;sunng&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;size=2&gt;2007-04-13&lt;/FONT&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;/FONT&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
