<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;HTML&gt;&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;TITLE&gt;Question&nbsp;about&nbsp;jabber:iq:auth&nbsp;packets&nbsp;and&nbsp;XDB&lt;/TITLE&gt;<br>
<br>
&lt;META&nbsp;content=&quot;MSHTML&nbsp;5.50.4807.2300&quot;&nbsp;name=GENERATOR&gt;&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=095455813-23102002&gt;All,&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=095455813-23102002&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;class=095455813-23102002&gt;I&nbsp;sent&nbsp;<br>
this&nbsp;message&nbsp;in&nbsp;the&nbsp;other&nbsp;day&nbsp;and&nbsp;have&nbsp;since&nbsp;spent&nbsp;some&nbsp;time&nbsp;on&nbsp;the&nbsp;problem&nbsp;and&nbsp;<br>
have&nbsp;narrowed&nbsp;down&nbsp;to&nbsp;one&nbsp;line&nbsp;of&nbsp;code&nbsp;in&nbsp;mod_auth_plain.c&nbsp;that&nbsp;could&nbsp;be&nbsp;changed&nbsp;<br>
to&nbsp;help&nbsp;me&nbsp;with&nbsp;my&nbsp;need&nbsp;and&nbsp;probably&nbsp;not&nbsp;break&nbsp;any&nbsp;other&nbsp;implementations.&nbsp;Line&nbsp;<br>
70&nbsp;(see&nbsp;below)&nbsp;is&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;check&nbsp;routine&nbsp;and&nbsp;as&nbsp;you&nbsp;can&nbsp;see&nbsp;only&nbsp;the&nbsp;<br>
password&nbsp;tag&nbsp;from&nbsp;the&nbsp;original&nbsp;XML&nbsp;is&nbsp;passed&nbsp;on&nbsp;to&nbsp;the&nbsp;xdb&nbsp;subsystem.&nbsp;If&nbsp;this&nbsp;<br>
line&nbsp;could&nbsp;be&nbsp;modified&nbsp;in&nbsp;a&nbsp;way&nbsp;that&nbsp;the&nbsp;password&nbsp;and&nbsp;resource&nbsp;are&nbsp;passed&nbsp;to&nbsp;the&nbsp;<br>
xdb&nbsp;subsystem&nbsp;it&nbsp;shouldn't&nbsp;break&nbsp;anything&nbsp;else&nbsp;and&nbsp;should&nbsp;make&nbsp;things&nbsp;easier&nbsp;for&nbsp;<br>
losers&nbsp;like&nbsp;me&nbsp;who&nbsp;want&nbsp;to&nbsp;re-write&nbsp;xdb&nbsp;in&nbsp;some&nbsp;language&nbsp;other&nbsp;than&nbsp;<br>
C.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;<br>
class=095455813-23102002&gt;&lt;/SPAN&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;SPAN&nbsp;class=095455813-23102002&gt;I&nbsp;<br>
looked&nbsp;at&nbsp;the&nbsp;xmlnode_get_tag&nbsp;and&nbsp;could&nbsp;see&nbsp;how&nbsp;it&nbsp;can&nbsp;get&nbsp;tags&nbsp;in&nbsp;many&nbsp;ways,&nbsp;<br>
but&nbsp;I&nbsp;couldn't&nbsp;see&nbsp;how&nbsp;it&nbsp;could&nbsp;return&nbsp;multiple&nbsp;tags&nbsp;on&nbsp;the&nbsp;same&nbsp;level.&nbsp;A&nbsp;<br>
modification&nbsp;to&nbsp;that&nbsp;routine&nbsp;which&nbsp;in&nbsp;found&nbsp;in&nbsp;the&nbsp;source&nbsp;file&nbsp;xmlnode.c&nbsp;around&nbsp;<br>
line&nbsp;331&nbsp;would&nbsp;be&nbsp;nice.&nbsp;Maybe&nbsp;something&nbsp;allowing&nbsp;a&nbsp;|&nbsp;separated&nbsp;list&nbsp;of&nbsp;tags&nbsp;that&nbsp;<br>
would&nbsp;return&nbsp;a&nbsp;structure&nbsp;with&nbsp;all&nbsp;of&nbsp;the&nbsp;found&nbsp;requested&nbsp;<br>
tags.&lt;/SPAN&gt;&lt;/FONT&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;SPAN&nbsp;class=095455813-23102002&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;if(xdb_act(m-&amp;gt;si-&amp;gt;xc,&nbsp;<br>
m-&amp;gt;user-&amp;gt;id,&nbsp;NS_AUTH,&nbsp;&quot;check&quot;,&nbsp;NULL,&nbsp;<br>
xmlnode_get_tag(m-&amp;gt;packet-&amp;gt;iq,&quot;password&quot;)))&lt;/FONT&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/P&gt;<br>
&lt;P&gt;&lt;SPAN&nbsp;class=095455813-23102002&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;<br>
size=2&gt;Thanks,&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;SPAN&nbsp;class=095455813-23102002&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;Joe&nbsp;<br>
Breeden&lt;BR&gt;Education&nbsp;Networks&nbsp;of&nbsp;America&lt;/FONT&gt;&lt;/SPAN&gt;&lt;/P&gt;<br>
&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;color=#0000ff&nbsp;size=2&gt;&lt;/FONT&gt;&amp;nbsp;&lt;/P&gt;&lt;/SPAN&gt;&lt;/DIV&gt;<br>
&lt;BLOCKQUOTE&nbsp;<br>
style=&quot;PADDING-LEFT:&nbsp;5px;&nbsp;MARGIN-LEFT:&nbsp;5px;&nbsp;BORDER-LEFT:&nbsp;#0000ff&nbsp;2px&nbsp;solid&quot;&gt;<br>
&nbsp;&nbsp;&lt;DIV&nbsp;class=OutlookMessageHeader&nbsp;dir=ltr&nbsp;align=left&gt;&lt;FONT&nbsp;face=Tahoma&nbsp;<br>
&nbsp;&nbsp;size=2&gt;-----Original&nbsp;Message-----&lt;BR&gt;&lt;B&gt;From:&lt;/B&gt;&nbsp;Joe&nbsp;Breeden&nbsp;&lt;BR&gt;&lt;B&gt;Sent:&lt;/B&gt;&nbsp;<br>
&nbsp;&nbsp;Friday,&nbsp;October&nbsp;18,&nbsp;2002&nbsp;10:31&nbsp;AM&lt;BR&gt;&lt;B&gt;To:&lt;/B&gt;&nbsp;Jdev&nbsp;<br>
&nbsp;&nbsp;(E-mail)&lt;BR&gt;&lt;B&gt;Subject:&lt;/B&gt;&nbsp;[JDEV]&nbsp;Question&nbsp;about&nbsp;jabber:iq:auth&nbsp;packets&nbsp;and&nbsp;<br>
&nbsp;&nbsp;XDB&lt;BR&gt;&lt;BR&gt;&lt;/FONT&gt;&lt;/DIV&gt;&lt;!--&nbsp;Converted&nbsp;from&nbsp;text/rtf&nbsp;format&nbsp;--&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;All,&lt;/FONT&gt;&nbsp;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;I&nbsp;have&nbsp;noticed&nbsp;a&nbsp;quirk,&nbsp;if&nbsp;you&nbsp;will,&nbsp;in&nbsp;the&nbsp;way&nbsp;<br>
&nbsp;&nbsp;jabberd&nbsp;passes&nbsp;jabber:iq:auth&nbsp;packets&nbsp;to&nbsp;XDB.&nbsp;If&nbsp;you&nbsp;look&nbsp;at&nbsp;the&nbsp;output&nbsp;from&nbsp;<br>
&nbsp;&nbsp;my&nbsp;debug&nbsp;log&nbsp;(greatly&nbsp;edited&nbsp;for&nbsp;brevity)&nbsp;it&nbsp;looks&nbsp;like&nbsp;the&nbsp;client&nbsp;is&nbsp;sending&nbsp;<br>
&nbsp;&nbsp;a&nbsp;&amp;lt;resource&amp;gt;&nbsp;tag&nbsp;which&nbsp;is&nbsp;getting&nbsp;stripped&nbsp;from&nbsp;the&nbsp;stream&nbsp;when&nbsp;the&nbsp;<br>
&nbsp;&nbsp;packet&nbsp;is&nbsp;forwarded&nbsp;to&nbsp;my&nbsp;XDB&nbsp;service.&nbsp;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;My&nbsp;guess&nbsp;is&nbsp;that&nbsp;deliver.c&nbsp;is&nbsp;responsible&nbsp;for&nbsp;<br>
&nbsp;&nbsp;rewriting&nbsp;the&nbsp;XML,&nbsp;but&nbsp;I&nbsp;can't&nbsp;figure&nbsp;out&nbsp;where&nbsp;as&nbsp;my&nbsp;C&nbsp;is&nbsp;so&nbsp;poor&nbsp;that&nbsp;I&nbsp;<br>
&nbsp;&nbsp;wouldn't&nbsp;begin&nbsp;to&nbsp;claim&nbsp;to&nbsp;understand&nbsp;what&nbsp;the&nbsp;program&nbsp;is&nbsp;doing.&nbsp;I&nbsp;want&nbsp;to&nbsp;be&nbsp;<br>
&nbsp;&nbsp;able&nbsp;to&nbsp;store&nbsp;the&nbsp;resources&nbsp;a&nbsp;user&nbsp;is&nbsp;sending&nbsp;like&nbsp;xdb_sql&nbsp;does&nbsp;and&nbsp;it&nbsp;seems&nbsp;<br>
&nbsp;&nbsp;to&nbsp;me&nbsp;the&nbsp;perfect&nbsp;time&nbsp;to&nbsp;do&nbsp;this&nbsp;would&nbsp;be&nbsp;when&nbsp;an&nbsp;iq:auth&nbsp;packet&nbsp;is&nbsp;received,&nbsp;<br>
&nbsp;&nbsp;except&nbsp;that&nbsp;this&nbsp;handy-dandy&nbsp;piece&nbsp;of&nbsp;information&nbsp;is&nbsp;not&nbsp;being&nbsp;passed&nbsp;to&nbsp;my&nbsp;<br>
&nbsp;&nbsp;component.&nbsp;Any&nbsp;help&nbsp;here&nbsp;would&nbsp;be&nbsp;appreciated.&nbsp;Thanks&nbsp;in&nbsp;advance.&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
&nbsp;&nbsp;size=2&gt;---------------------------------------------------------------BEGIN&nbsp;<br>
&nbsp;&nbsp;TRACE-----------------------------------------------------------------------------------------------------------&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;size=2&gt;Fri&nbsp;Oct&nbsp;18&nbsp;08:57:22&nbsp;2002&amp;nbsp;&nbsp;mio.c:760&nbsp;<br>
&nbsp;&nbsp;MIO&nbsp;read&nbsp;from&nbsp;socket&nbsp;15:&nbsp;&amp;lt;iq&nbsp;type='set'&nbsp;id='__AUTH__'&amp;gt;&amp;lt;query&nbsp;<br>
&nbsp;&nbsp;xmlns='jabber:iq:auth'&amp;gt;&amp;lt;username&amp;gt;joehep&amp;lt;/username&amp;gt;&amp;lt;resource&amp;gt;GAIM&amp;lt;/resource&amp;gt;&amp;lt;password&amp;gt;password&amp;lt;/password&amp;gt;&amp;lt;/query&amp;gt;&amp;lt;/iq&amp;gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;size=2&gt;Fri&nbsp;Oct&nbsp;18&nbsp;08:57:22&nbsp;2002&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;deliver.c:474&nbsp;DELIVER&nbsp;4:shrieker.ena.com&nbsp;&amp;lt;route&nbsp;type='auth'&nbsp;<br>
&nbsp;&nbsp;to='joehep@shrieker.ena.com/GAIM'&nbsp;from='15@c2s/812F628'&amp;gt;&amp;lt;iq&nbsp;type='set'&nbsp;<br>
&nbsp;&nbsp;id='__AUTH__'&amp;gt;&amp;lt;query&nbsp;<br>
&nbsp;&nbsp;xmlns='jabber:iq:auth'&amp;gt;&amp;lt;username&amp;gt;joehep&amp;lt;/username&amp;gt;&amp;lt;resource&amp;gt;GAIM&amp;lt;/resource&amp;gt;&amp;lt;password&amp;gt;password&amp;lt;/password&amp;gt;&amp;lt;/query&amp;gt;&amp;lt;/iq&amp;gt;&amp;lt;/route&amp;gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;size=2&gt;Fri&nbsp;Oct&nbsp;18&nbsp;08:57:22&nbsp;2002&amp;nbsp;&nbsp;deliver.c:94&nbsp;<br>
&nbsp;&nbsp;(80D84A0)incoming&nbsp;packet&nbsp;&amp;lt;route&nbsp;type='auth'&nbsp;<br>
&nbsp;&nbsp;to='joehep@shrieker.ena.com/GAIM'&nbsp;from='15@c2s/812F628'&amp;gt;&amp;lt;iq&nbsp;type='set'&nbsp;<br>
&nbsp;&nbsp;id='__AUTH__'&amp;gt;&amp;lt;query&nbsp;<br>
&nbsp;&nbsp;xmlns='jabber:iq:auth'&amp;gt;&amp;lt;username&amp;gt;joehep&amp;lt;/username&amp;gt;&amp;lt;resource&amp;gt;GAIM&amp;lt;/resource&amp;gt;&amp;lt;password&amp;gt;password&amp;lt;/password&amp;gt;&amp;lt;/query&amp;gt;&amp;lt;/iq&amp;gt;&amp;lt;/route&amp;gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=&quot;Courier&nbsp;New&quot;&nbsp;size=2&gt;Fri&nbsp;Oct&nbsp;18&nbsp;08:57:22&nbsp;2002&amp;nbsp;&nbsp;<br>
&nbsp;&nbsp;deliver.c:474&nbsp;DELIVER&nbsp;2:shrieker.ena.com&nbsp;&amp;lt;xdb&nbsp;type='set'&nbsp;action='check'&nbsp;<br>
&nbsp;&nbsp;to='joehep@shrieker.ena.com'&nbsp;from='sessions'&nbsp;ns='jabber:iq:auth'&nbsp;<br>
&nbsp;&nbsp;id='85'&amp;gt;&amp;lt;password&amp;gt;password&amp;lt;/password&amp;gt;&amp;lt;/xdb&amp;gt;&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;<br>
&nbsp;&nbsp;size=2&gt;------------------------------------------------------------------END&nbsp;<br>
&nbsp;&nbsp;TRACE-----------------------------------------------------------------------------------------------------------&lt;/FONT&gt;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;Again,&nbsp;thanks&nbsp;for&nbsp;the&nbsp;help,&lt;/FONT&gt;&nbsp;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=2&gt;--Joe&nbsp;Breeden&lt;/FONT&gt;&nbsp;&lt;/P&gt;<br>
&nbsp;&nbsp;&lt;P&gt;&lt;FONT&nbsp;face=Arial&nbsp;size=1&gt;From&nbsp;Murphy's&nbsp;Laws&nbsp;of&nbsp;Computing:&lt;/FONT&gt;&nbsp;&lt;BR&gt;&lt;FONT&nbsp;<br>
&nbsp;&nbsp;face=Arial&nbsp;size=1&gt;9.&nbsp;A&nbsp;complex&nbsp;system&nbsp;that&nbsp;does&nbsp;not&nbsp;work&nbsp;is&nbsp;invariably&nbsp;found&nbsp;<br>
&nbsp;&nbsp;to&nbsp;have&nbsp;evolved&nbsp;from&nbsp;a&nbsp;simpler&nbsp;system&nbsp;that&nbsp;worked&nbsp;just&nbsp;fine.&lt;/FONT&gt;&nbsp;<br>
&lt;/P&gt;&lt;BR&gt;&lt;/BLOCKQUOTE&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
