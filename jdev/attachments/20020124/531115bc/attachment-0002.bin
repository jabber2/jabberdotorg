*** mod_groups.c.cvs	Thu Jan 24 18:06:25 2002
--- mod_groups.c	Thu Jan 24 18:06:25 2002
***************
*** 578,584 ****
      log_debug(ZONE,"Setting");
  
      gid = strchr(jp->to->resource,'/');
!     if (gid == NULL || ++gid == NULL);
      {
          js_bounce(m->si,jp->x,TERROR_NOTACCEPTABLE);
          return;
--- 578,584 ----
      log_debug(ZONE,"Setting");
  
      gid = strchr(jp->to->resource,'/');
!     if (gid == NULL || ++gid == NULL)
      {
          js_bounce(m->si,jp->x,TERROR_NOTACCEPTABLE);
          return;
***************
*** 596,602 ****
      }
  
      info = mod_groups_get_info(mi,p,jp->to->server,gid);
!     if (info == NULL ||  xmlnode_get_tag(info,spools(p,"edit/user=",jp->from->user,p)) == NULL)
      {
          js_bounce(m->si,jp->x,TERROR_NOTALLOWED);
          return;
--- 596,602 ----
      }
  
      info = mod_groups_get_info(mi,p,jp->to->server,gid);
!     if (info == NULL ||  xmlnode_get_tag(info,spools(p,"edit/user=",jid_full(jp->from),p)) == NULL)
      {
          js_bounce(m->si,jp->x,TERROR_NOTALLOWED);
          return;
***************
*** 941,947 ****
          return M_HANDLED;
      }
  
!     if (xmlnode_get_tag(info,spools(jp->p,"write/user=",jp->from->user,jp->p)) != NULL)
          mod_groups_message_online(mi,jp->x,gid);
      else
          js_bounce(m->si,jp->x,TERROR_NOTALLOWED);
--- 941,947 ----
          return M_HANDLED;
      }
  
!     if (xmlnode_get_tag(info,spools(jp->p,"write/user=",jid_full(jp->from),jp->p)) != NULL)
          mod_groups_message_online(mi,jp->x,gid);
      else
          js_bounce(m->si,jp->x,TERROR_NOTALLOWED);
