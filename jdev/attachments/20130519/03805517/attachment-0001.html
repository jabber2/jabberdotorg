<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;dir=&quot;auto&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;the&nbsp;issue&nbsp;with&nbsp;embedding&nbsp;it&nbsp;in&nbsp;a&nbsp;message&nbsp;is&nbsp;the&nbsp;neither&nbsp;XEP-0136&nbsp;or&nbsp;XEP-0313&nbsp;store&nbsp;message&nbsp;that&nbsp;have&nbsp;no&nbsp;body,&nbsp;which&nbsp;a&nbsp;includes&nbsp;a&nbsp;last&nbsp;read&nbsp;message.&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;id=&quot;reply-content&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;reply-content&quot;&gt;Keeping&nbsp;it&nbsp;as&nbsp;a&nbsp;separate&nbsp;XEP&nbsp;means&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;with&nbsp;any&nbsp;Message&nbsp;Archiving&nbsp;solution.&lt;/div&gt;&lt;div&nbsp;id=&quot;reply-content&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;reply-content&quot;&gt;Also&nbsp;the&nbsp;auto&nbsp;sending&nbsp;of&nbsp;read&nbsp;is&nbsp;something&nbsp;I&nbsp;want&nbsp;to&nbsp;avoid,&nbsp;if&nbsp;they&nbsp;haven't&nbsp;read&nbsp;it&nbsp;then&nbsp;don't&nbsp;move&nbsp;the&nbsp;marker.&nbsp;There&nbsp;is&nbsp;a&nbsp;separate&nbsp;delivered&nbsp;marker&nbsp;for&nbsp;this.&nbsp;I&nbsp;appreciate&nbsp;that&nbsp;delivery&nbsp;&nbsp;receipts&nbsp;already&nbsp;exist&nbsp;but&nbsp;they&nbsp;have&nbsp;to&nbsp;be&nbsp;sent&nbsp;for&nbsp;every&nbsp;message&nbsp;that&nbsp;requests&nbsp;them&nbsp;and&nbsp;as&nbsp;you&nbsp;alluded&nbsp;to,&nbsp;how&nbsp;your&nbsp;supposed&nbsp;to&nbsp;handle&nbsp;them&nbsp;with&nbsp;archived&nbsp;messages&nbsp;is&nbsp;a&nbsp;bit&nbsp;ambiguous.&lt;/div&gt;&lt;div&nbsp;id=&quot;reply-content&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;reply-content&quot;&gt;One&nbsp;solution&nbsp;I&nbsp;thought&nbsp;of&nbsp;for&nbsp;duplicate&nbsp;message&nbsp;ids,&nbsp;is&nbsp;for&nbsp;the&nbsp;server&nbsp;to&nbsp;embed&nbsp;a&nbsp;timestamp&nbsp;based&nbsp;on&nbsp;the&nbsp;archive&nbsp;into&nbsp;the&nbsp;chat&nbsp;marker.&lt;/div&gt;&lt;div&nbsp;id=&quot;reply-content&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;reply-content&quot;&gt;Naturally&nbsp;if&nbsp;I&nbsp;turned&nbsp;this&nbsp;into&nbsp;any&nbsp;XEP&nbsp;then&nbsp;all&nbsp;of&nbsp;this&nbsp;would&nbsp;only&nbsp;be&nbsp;sent&nbsp;to&nbsp;clients&nbsp;that&nbsp;advertise&nbsp;support.&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;id=&quot;CFDD3CA7A4704484B0D708FA1D3700A8&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Regards&lt;br&gt;&lt;br&gt;Spencer&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&nbsp;style=&quot;color:&nbsp;#A0A0A8;&quot;&gt;On&nbsp;Sunday,&nbsp;19&nbsp;May&nbsp;2013&nbsp;at&nbsp;09:23,&nbsp;Lance&nbsp;Stout&nbsp;wrote:&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;border-left-style:solid;border-width:1px;margin-left:0px;padding-left:10px;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;id=&quot;quoted-message-content&quot;&gt;&lt;div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;Any&nbsp;thoughts&nbsp;either&nbsp;way&nbsp;on&nbsp;my&nbsp;&quot;Chat&nbsp;Marker&quot;&nbsp;proposal?&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;after&nbsp;some&nbsp;pondering,&nbsp;there&nbsp;are&nbsp;three&nbsp;user&nbsp;experiences&nbsp;I&nbsp;can&nbsp;see:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1)&nbsp;The&nbsp;primary&nbsp;clients&nbsp;talking&nbsp;to&nbsp;each&nbsp;other:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;XEP-0085&nbsp;by&nbsp;itself&nbsp;should&nbsp;cover&nbsp;this,&nbsp;as&nbsp;Stefan&nbsp;pointed&nbsp;out.&nbsp;However,&nbsp;it&lt;/div&gt;&lt;div&gt;might&nbsp;leave&nbsp;holes&nbsp;because&nbsp;of&nbsp;non-instanaeous&nbsp;delivery.&nbsp;Eg,&nbsp;Juliet&nbsp;sends&nbsp;Romeo&lt;/div&gt;&lt;div&gt;a&nbsp;message&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;he&nbsp;sends&nbsp;an&nbsp;active&nbsp;state&nbsp;message.&nbsp;So&nbsp;Juliet&nbsp;would&lt;/div&gt;&lt;div&gt;assume&nbsp;Romeo&nbsp;has&nbsp;read&nbsp;a&nbsp;message&nbsp;that&nbsp;he&nbsp;might&nbsp;not&nbsp;have&nbsp;actually&nbsp;received&nbsp;yet.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;we&nbsp;make&nbsp;a&nbsp;new&nbsp;element&nbsp;to&nbsp;tie&nbsp;the&nbsp;update&nbsp;with&nbsp;a&nbsp;specific&nbsp;message&lt;/div&gt;&lt;div&gt;ID,&nbsp;then&nbsp;that&nbsp;potential&nbsp;hole&nbsp;goes&nbsp;away.&nbsp;So&nbsp;we&nbsp;can&nbsp;add&nbsp;a&nbsp;new&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;lastread&nbsp;id=&quot;1234etc&quot;&nbsp;xmlns=&quot;urn:xmpp:lastread:tmp&quot;&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;element&nbsp;to&nbsp;outgoing&nbsp;messages&nbsp;when:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;a)&nbsp;The&nbsp;last&nbsp;ID&nbsp;sent&nbsp;by&nbsp;the&nbsp;other&nbsp;person&nbsp;has&nbsp;changed&nbsp;(so&nbsp;only&nbsp;send&nbsp;a&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&lt;lastread&nbsp;/&gt;&nbsp;update&nbsp;once&nbsp;per&nbsp;change&nbsp;in&nbsp;ID)&lt;/div&gt;&lt;div&gt;b)&nbsp;If&nbsp;the&nbsp;user&nbsp;doesn't&nbsp;send&nbsp;a&nbsp;response&nbsp;chat&nbsp;within&nbsp;some&nbsp;period&nbsp;of&nbsp;time,&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;automatically&nbsp;send&nbsp;a&nbsp;&lt;lastread&nbsp;/&gt;&nbsp;update.&nbsp;Basically,&nbsp;give&nbsp;the&nbsp;user&nbsp;a&nbsp;chance&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;to&nbsp;respond&nbsp;with&nbsp;a&nbsp;message&nbsp;and&nbsp;piggyback&nbsp;the&nbsp;&lt;lastread&nbsp;/&gt;&nbsp;update&nbsp;with&nbsp;that&nbsp;(maybe&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;a&nbsp;composing&nbsp;state&nbsp;message&nbsp;would&nbsp;suffice),&nbsp;but&nbsp;if&nbsp;after&nbsp;a&nbsp;few&nbsp;seconds&nbsp;the&nbsp;user&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;hasn't&nbsp;done&nbsp;something&nbsp;and&nbsp;the&nbsp;client&nbsp;is&nbsp;still&nbsp;focused&nbsp;and&nbsp;active,&nbsp;etc,&nbsp;emit&nbsp;a&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;standalone&nbsp;update.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;usual,&nbsp;we&nbsp;don't&nbsp;send&nbsp;these&nbsp;updates&nbsp;when&nbsp;the&nbsp;other&nbsp;client&nbsp;doesn't&nbsp;advertise&lt;/div&gt;&lt;div&gt;support&nbsp;for&nbsp;it&nbsp;in&nbsp;disco.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;combination&nbsp;of&nbsp;just&nbsp;delivery&nbsp;receipt&nbsp;and&nbsp;chat&nbsp;state&nbsp;might&nbsp;be&nbsp;sufficient,&nbsp;&lt;/div&gt;&lt;div&gt;but&nbsp;I've&nbsp;not&nbsp;been&nbsp;able&nbsp;to&nbsp;convince&nbsp;myself&nbsp;yet&nbsp;that&nbsp;it&nbsp;would&nbsp;properly&nbsp;handle&nbsp;&lt;/div&gt;&lt;div&gt;case&nbsp;3&nbsp;with&nbsp;offline&nbsp;messages.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2)&nbsp;A&nbsp;secondary&nbsp;client&nbsp;that&nbsp;is&nbsp;online,&nbsp;which&nbsp;wishes&nbsp;to&nbsp;stay&nbsp;in&nbsp;sync:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;the&nbsp;purpose&nbsp;of&nbsp;XEP-0280&nbsp;Message&nbsp;Carbons.&nbsp;So&nbsp;long&nbsp;as&nbsp;the&nbsp;delivery&nbsp;receipts,&lt;/div&gt;&lt;div&gt;chat&nbsp;state&nbsp;notifications&nbsp;and&nbsp;the&nbsp;&lt;lastread&nbsp;/&gt;&nbsp;updates&nbsp;from&nbsp;case&nbsp;1&nbsp;are&nbsp;also&nbsp;synced&lt;/div&gt;&lt;div&gt;via&nbsp;carbons,&nbsp;everything&nbsp;should&nbsp;be&nbsp;covered.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3)&nbsp;A&nbsp;user&nbsp;has&nbsp;received&nbsp;messages&nbsp;while&nbsp;offline:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;this&nbsp;is&nbsp;the&nbsp;fun&nbsp;one&nbsp;because&nbsp;it&nbsp;requires&nbsp;some&nbsp;interaction&nbsp;with&nbsp;the&nbsp;archives.&lt;/div&gt;&lt;div&gt;When&nbsp;requesting&nbsp;history,&nbsp;the&nbsp;results&nbsp;should&nbsp;note&nbsp;the&nbsp;ID&nbsp;where&nbsp;the&nbsp;offline&lt;/div&gt;&lt;div&gt;storage&nbsp;began,&nbsp;as&nbsp;Zash&nbsp;pointed&nbsp;out.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Based&nbsp;on&nbsp;that,&nbsp;the&nbsp;client&nbsp;can&nbsp;send&nbsp;a&nbsp;&lt;lastread&nbsp;/&gt;&nbsp;update.&nbsp;Likewise&nbsp;it&nbsp;can&lt;/div&gt;&lt;div&gt;generate&nbsp;the&nbsp;delivery&nbsp;receipts&nbsp;requested&nbsp;in&nbsp;the&nbsp;offline&nbsp;messages&nbsp;(although,&lt;/div&gt;&lt;div&gt;there&nbsp;shouldn't&nbsp;actually&nbsp;be&nbsp;any&nbsp;since&nbsp;you&nbsp;wouldn't&nbsp;request&nbsp;receipts&nbsp;when&nbsp;sending&lt;/div&gt;&lt;div&gt;to&nbsp;an&nbsp;offline&nbsp;JID,&nbsp;and&nbsp;XEP-0184&nbsp;has&nbsp;a&nbsp;slight&nbsp;ambiguity&nbsp;with&nbsp;how&nbsp;to&nbsp;handle&nbsp;offline&lt;/div&gt;&lt;div&gt;messages).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;would&nbsp;suggest&nbsp;that&nbsp;standalone&nbsp;lastread&nbsp;updates&nbsp;should&nbsp;be&nbsp;included&nbsp;in&nbsp;archived&nbsp;&lt;/div&gt;&lt;div&gt;history&nbsp;because&nbsp;they're&nbsp;required&nbsp;to&nbsp;fully&nbsp;resume&nbsp;conversation&nbsp;state&nbsp;to&nbsp;match&lt;/div&gt;&lt;div&gt;other&nbsp;systems&nbsp;like&nbsp;iMessage,&nbsp;etc.&nbsp;The&nbsp;main&nbsp;question&nbsp;at&nbsp;this&nbsp;point&nbsp;is&nbsp;where&nbsp;to&nbsp;&lt;/div&gt;&lt;div&gt;send&nbsp;the&nbsp;updates&nbsp;(if&nbsp;at&nbsp;all),&nbsp;particularly&nbsp;when&nbsp;the&nbsp;sender&nbsp;JID&nbsp;is&nbsp;no&nbsp;longer&nbsp;online.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;general,&nbsp;what&nbsp;makes&nbsp;things&nbsp;challenging&nbsp;is&nbsp;that&nbsp;message&nbsp;IDs&nbsp;are&nbsp;not&nbsp;required&nbsp;to&lt;/div&gt;&lt;div&gt;be&nbsp;globally&nbsp;unique.&nbsp;The&nbsp;same&nbsp;ID&nbsp;could&nbsp;be&nbsp;used&nbsp;multiple&nbsp;times&nbsp;during&nbsp;the&nbsp;same&lt;/div&gt;&lt;div&gt;conversation&nbsp;if&nbsp;a&nbsp;user&nbsp;is&nbsp;bouncing&nbsp;between&nbsp;clients&nbsp;or&nbsp;reconnects.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&nbsp;Lance&lt;/div&gt;&lt;div&gt;_______________________________________________&lt;/div&gt;&lt;div&gt;JDev&nbsp;mailing&nbsp;list&lt;/div&gt;&lt;div&gt;Info:&nbsp;&lt;a&nbsp;href=&quot;http://mail.jabber.org/mailman/listinfo/jdev&quot;&gt;http://mail.jabber.org/mailman/listinfo/jdev&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Unsubscribe:&nbsp;&lt;a&nbsp;href=&quot;mailto:JDev-unsubscribe@jabber.org&quot;&gt;JDev-unsubscribe@jabber.org&lt;/a&gt;&lt;/div&gt;&lt;div&gt;_______________________________________________&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;style=&quot;border-bottom:&nbsp;1px&nbsp;solid&nbsp;#f0f0f0;&nbsp;height:&nbsp;10px;&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;style=&quot;font-weight:&nbsp;bold;&nbsp;font-size:&nbsp;14px;&nbsp;margin-bottom:&nbsp;5px;&quot;&gt;Attachments:&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;style=&quot;&quot;&gt;-&nbsp;smime.p7s&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&gt;&lt;span&gt;_______________________________________________&lt;/span&gt;&lt;br&gt;&lt;span&gt;JDev&nbsp;mailing&nbsp;list&lt;/span&gt;&lt;br&gt;&lt;span&gt;Info:&nbsp;&lt;a&nbsp;href=&quot;http://mail.jabber.org/mailman/listinfo/jdev&quot;&gt;http://mail.jabber.org/mailman/listinfo/jdev&lt;/a&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;Unsubscribe:&nbsp;&lt;a&nbsp;href=&quot;mailto:JDev-unsubscribe@jabber.org&quot;&gt;JDev-unsubscribe@jabber.org&lt;/a&gt;&lt;/span&gt;&lt;br&gt;&lt;span&gt;_______________________________________________&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
