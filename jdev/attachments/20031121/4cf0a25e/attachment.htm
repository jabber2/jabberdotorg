<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
Hi&nbsp;all,&lt;br&gt;<br>
&lt;br&gt;<br>
I'm&nbsp;developing&nbsp;a&nbsp;jabberd&nbsp;1.4.2&nbsp;module&nbsp;which&nbsp;only&nbsp;aim&nbsp;is&nbsp;to&nbsp;know&nbsp;whenever<br>
some&nbsp;user&nbsp;connects/disconnects&nbsp;to/from&nbsp;the&nbsp;jabber&nbsp;server&nbsp;&nbsp;(and&nbsp;update&nbsp;a&nbsp;db<br>
accordingly).&lt;br&gt;<br>
&lt;br&gt;<br>
I'd&nbsp;like&nbsp;to&nbsp;know&nbsp;wheter&nbsp;the&nbsp;logic&nbsp;behind&nbsp;my&nbsp;code&nbsp;is&nbsp;OK:&lt;br&gt;<br>
&lt;br&gt;<br>
1&nbsp;)&nbsp;To&nbsp;know&nbsp;when&nbsp;a&nbsp;user&nbsp;connects,&nbsp;I&nbsp;have&nbsp;a&nbsp;callback&nbsp;associated&nbsp;to&nbsp;e_SESSION<br>
event.&nbsp;That's&nbsp;all.&lt;br&gt;<br>
&lt;br&gt;<br>
2&nbsp;)&nbsp;To&nbsp;know&nbsp;when&nbsp;a&nbsp;user&nbsp;disconnects,&nbsp;I&nbsp;have&nbsp;a&nbsp;callback&nbsp;associated&nbsp;to&nbsp;e_DELIVER<br>
event.&nbsp;Then&nbsp;I&nbsp;filter&nbsp;JPACKET_PRESENCE&nbsp;packets,&nbsp;and&nbsp;then&nbsp;I&nbsp;filter&nbsp;those&nbsp;packets<br>
which&nbsp;&amp;nbsp;are&nbsp;JPACKET__UNAVAILABLE&nbsp;and&nbsp;which&nbsp;user-&amp;gt;sessions&nbsp;is&nbsp;not&nbsp;NULL&nbsp;(I<br>
found&nbsp;that&nbsp;I&nbsp;was&nbsp;receiving&nbsp;the&nbsp;unavailable&nbsp;packet&nbsp;twice&nbsp;every&nbsp;time&nbsp;a&nbsp;user<br>
disconnected...&nbsp;the&nbsp;only&nbsp;difference&nbsp;I&nbsp;found&nbsp;between&nbsp;those&nbsp;packets&nbsp;was&nbsp;user-&amp;gt;sessions.<br>
Is&nbsp;there&nbsp;any&nbsp;other&nbsp;way?).&lt;br&gt;<br>
&lt;br&gt;<br>
Is&nbsp;it&nbsp;ok?&nbsp;(it&nbsp;works...&nbsp;but&nbsp;maybe&nbsp;I'm&nbsp;omitting&nbsp;something.&lt;br&gt;<br>
&lt;br&gt;<br>
I'm&nbsp;also&nbsp;wondering&nbsp;why&nbsp;I'm&nbsp;receiving&nbsp;&quot;unavailables&quot;&nbsp;from&nbsp;msn&nbsp;transport&nbsp;users<br>
but&nbsp;I&nbsp;don't&nbsp;receive&nbsp;&quot;available&quot;&nbsp;packets...&nbsp;I&nbsp;launch&nbsp;my&nbsp;module&nbsp;after&nbsp;all&nbsp;jsm<br>
modules&nbsp;are&nbsp;launched...&nbsp;may&nbsp;this&nbsp;be&nbsp;the&nbsp;reason?(although&nbsp;msn&nbsp;transport&nbsp;is<br>
launched&nbsp;after&nbsp;these&nbsp;modules,&nbsp;isn't&nbsp;it?)&amp;nbsp;&nbsp;I&nbsp;get&nbsp;a&nbsp;log&nbsp;like&nbsp;this&amp;nbsp;&nbsp;when&nbsp;dperez<br>
(me)&nbsp;disconnects&nbsp;from&nbsp;the&nbsp;server&nbsp;(POA&nbsp;is&nbsp;the&nbsp;code&nbsp;name&nbsp;of&nbsp;the&nbsp;module):&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Fri&nbsp;Nov&nbsp;21&nbsp;13:26:05&nbsp;2003&amp;nbsp;&nbsp;presence.c:64&nbsp;POA&nbsp;::&nbsp;dperez/Work&nbsp;is&nbsp;connected&lt;br&gt;<br>
Fri&nbsp;Nov&nbsp;21&nbsp;13:27:10&nbsp;2003&amp;nbsp;&nbsp;presence.c:108&nbsp;POA&nbsp;::&nbsp;dperez/Work&nbsp;has&nbsp;left.&lt;br&gt;<br>
Fri&nbsp;Nov&nbsp;21&nbsp;13:27:10&nbsp;2003&amp;nbsp;&nbsp;presence.c:108&nbsp;POA&nbsp;::&nbsp;(null)/registered&nbsp;has&nbsp;left.<br>
&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;lt;-----------------------------&nbsp;I&nbsp;suppose&nbsp;this&nbsp;is&nbsp;the&nbsp;msn<br>
transport&nbsp;fake&nbsp;user.&lt;br&gt;<br>
Fri&nbsp;Nov&nbsp;21&nbsp;13:27:10&nbsp;2003&amp;nbsp;&nbsp;presence.c:108&nbsp;POA&nbsp;::&nbsp;foo1%hotmail.com/(null)&amp;nbsp;has<br>
left.&nbsp;(when&nbsp;does&nbsp;this&nbsp;user&nbsp;connects?)&lt;br&gt;<br>
Fri&nbsp;Nov&nbsp;21&nbsp;13:27:10&nbsp;2003&amp;nbsp;&nbsp;presence.c:108&nbsp;POA&nbsp;::&nbsp;foo2%hotmail.com/(null)&amp;nbsp;has<br>
left.&nbsp;(and&nbsp;this?&nbsp;He&nbsp;may&nbsp;be&nbsp;foo1's&nbsp;friend&nbsp;;-)&nbsp;)&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;in&nbsp;advance,&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;moz-signature&quot;&gt;&lt;img<br>
&nbsp;src=&quot;cid:part1.07030204.09050108@fib.upc.es&quot;&nbsp;border=&quot;0&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
