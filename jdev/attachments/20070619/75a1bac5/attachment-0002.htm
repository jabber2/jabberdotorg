<tt>
Thanks&nbsp;for&nbsp;the&nbsp;information,&nbsp;too.&lt;br&gt;Now&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;is&nbsp;to&nbsp;make&nbsp;the&nbsp;client&nbsp;as&nbsp;fault-tolerant&nbsp;as&nbsp;possible&nbsp;:)&nbsp;&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;19/06/07,&nbsp;&lt;b&nbsp;class=&quot;gmail_sendername&quot;&gt;Sylvain&nbsp;Hellegouarch&lt;/b&gt;&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:sh@defuze.org&quot;&gt;<br>
sh@defuze.org&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;Thanks&nbsp;for&nbsp;this&nbsp;summary&nbsp;because&nbsp;I&amp;#39;ve&nbsp;been&nbsp;reading&nbsp;these&nbsp;sections&nbsp;of&nbsp;RFC<br>
&lt;br&gt;3921&nbsp;*a&nbsp;lot*&nbsp;and&nbsp;there&nbsp;are&nbsp;so&nbsp;many&nbsp;different&nbsp;combinations&nbsp;that&nbsp;I&nbsp;lose&nbsp;it&lt;br&gt;quickly.&lt;br&gt;&lt;br&gt;/me&nbsp;pokes&nbsp;psa&nbsp;too.&nbsp;A&nbsp;diagram&nbsp;of&nbsp;all&nbsp;the&nbsp;different&nbsp;interactions&nbsp;would&nbsp;go&lt;br&gt;a&nbsp;long&nbsp;way&nbsp;/me&nbsp;thinks&lt;br&gt;&lt;br&gt;-&nbsp;Sylvain&lt;br&gt;&lt;br&gt;Mridul&nbsp;Muralidharan&nbsp;a&nbsp;Ã©crit&nbsp;:<br>
&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Hi,&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;nbsp;&amp;nbsp;&nbsp;I&nbsp;think&nbsp;Peter&nbsp;is&nbsp;in&nbsp;the&nbsp;process&nbsp;of&nbsp;clarifying&nbsp;the&nbsp;bis&nbsp;spec&nbsp;on&nbsp;the&lt;br&gt;&amp;gt;&nbsp;subscription&nbsp;appendix&amp;#39;s.&nbsp;/me&nbsp;pokes&nbsp;psa&nbsp;:)&lt;br&gt;&amp;gt;&nbsp;It&nbsp;might&nbsp;be&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;wait&nbsp;for&nbsp;that&nbsp;to&nbsp;be&nbsp;complete&nbsp;...&nbsp;currently,<br>
&lt;br&gt;&amp;gt;&nbsp;the&nbsp;state&nbsp;of&nbsp;specs&nbsp;is&nbsp;a&nbsp;bit&nbsp;icky&nbsp;from&nbsp;an&nbsp;impl&nbsp;point&nbsp;of&nbsp;view&nbsp;(though&lt;br&gt;&amp;gt;&nbsp;well&nbsp;defined).&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Roughly,&nbsp;3921&nbsp;says&nbsp;these&nbsp;:&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;-&nbsp;a&nbsp;user&nbsp;can&nbsp;add&nbsp;any&nbsp;contact&nbsp;to&nbsp;his&nbsp;roster,&nbsp;this&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a<br>
&lt;br&gt;&amp;gt;&nbsp;presence&nbsp;subscription&nbsp;request&nbsp;-&nbsp;but&nbsp;a&nbsp;roster&nbsp;push(*)&nbsp;will&nbsp;occur.&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;-&nbsp;a&nbsp;user&nbsp;can&nbsp;ask&nbsp;for&nbsp;subscription&nbsp;to&nbsp;contact&nbsp;:&nbsp;(if&nbsp;contact&nbsp;is&nbsp;not&nbsp;in&lt;br&gt;&amp;gt;&nbsp;the&nbsp;user&amp;#39;s&nbsp;roster&nbsp;(step&nbsp;1&nbsp;omitted),&nbsp;it&nbsp;gets&nbsp;automatically&nbsp;added)&nbsp;this<br>
&lt;br&gt;&amp;gt;&nbsp;triggers&nbsp;a&nbsp;roster&nbsp;push(*)&nbsp;with&nbsp;change&nbsp;in&nbsp;subscription&nbsp;status&nbsp;(ask&lt;br&gt;&amp;gt;&nbsp;attribute).&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;-&nbsp;if&nbsp;contact&nbsp;is&nbsp;online,&nbsp;subscribe&nbsp;is&nbsp;pushed&nbsp;to&nbsp;all&nbsp;available&nbsp;resources&lt;br&gt;&amp;gt;&nbsp;using&nbsp;rules&nbsp;similar&nbsp;to&nbsp;roster&nbsp;push(*).<br>
&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;-&nbsp;if&nbsp;contact&nbsp;is&nbsp;offline&nbsp;or&nbsp;no&nbsp;resource&nbsp;is&nbsp;available&nbsp;which&nbsp;satisfies&lt;br&gt;&amp;gt;&nbsp;rule&nbsp;for&nbsp;roster&nbsp;push(*),&nbsp;this&nbsp;is&nbsp;stored&nbsp;for&nbsp;later&nbsp;delivery.&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;-&nbsp;if&nbsp;contact&nbsp;rejects&nbsp;subscription&nbsp;(unsubscribed),&nbsp;this&nbsp;triggers&nbsp;a<br>
&lt;br&gt;&amp;gt;&nbsp;roster&nbsp;update&nbsp;in&nbsp;user&amp;#39;s&nbsp;roster&nbsp;appropriately&nbsp;(must&nbsp;not&nbsp;result&nbsp;in&lt;br&gt;&amp;gt;&nbsp;removal&nbsp;of&nbsp;entry&nbsp;-&nbsp;I&nbsp;see&nbsp;that&nbsp;some&nbsp;servers&nbsp;remove&nbsp;the&nbsp;contact&amp;#39;s&nbsp;jid&lt;br&gt;&amp;gt;&nbsp;from&nbsp;user&nbsp;roster)&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;roster&nbsp;push(*).&lt;br&gt;<br>
&amp;gt;&lt;br&gt;&amp;gt;&nbsp;-&nbsp;3921&nbsp;says&nbsp;that&nbsp;the&nbsp;unsubscribed&nbsp;must&nbsp;be&nbsp;delivered&nbsp;to&nbsp;the&nbsp;user&amp;#39;s&lt;br&gt;&amp;gt;&nbsp;resources(*).&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;(*)&nbsp;The&nbsp;roster&nbsp;push&nbsp;above&nbsp;will&nbsp;happen&nbsp;only&nbsp;to&nbsp;all&nbsp;resources&nbsp;which&nbsp;have&lt;br&gt;&amp;gt;&nbsp;requested&nbsp;(or&nbsp;modified)&nbsp;roster&nbsp;in&nbsp;some&nbsp;way&nbsp;(including&nbsp;asking&nbsp;for<br>
&lt;br&gt;&amp;gt;&nbsp;subscription).&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Similar&nbsp;steps&nbsp;above&nbsp;when&nbsp;contact&amp;#39;s&nbsp;approves&nbsp;subscription.&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;The&nbsp;state&nbsp;table&nbsp;related&nbsp;to&nbsp;inbound&nbsp;unsubscribe,&nbsp;unsubscribed&nbsp;and&lt;br&gt;&amp;gt;&nbsp;subscribed&nbsp;could&nbsp;be&nbsp;changed&nbsp;for&nbsp;3921&nbsp;bis&nbsp;spec&nbsp;(it&nbsp;has&nbsp;already&nbsp;been<br>
&lt;br&gt;&amp;gt;&nbsp;changed&nbsp;for&nbsp;subscribed).&nbsp;If&nbsp;I&nbsp;am&nbsp;not&nbsp;wrong,&nbsp;the&nbsp;last&nbsp;step&nbsp;above&nbsp;would&lt;br&gt;&amp;gt;&nbsp;not&nbsp;happen&nbsp;-&nbsp;that&nbsp;is,&nbsp;unsubscribe(d)&nbsp;will&nbsp;not&nbsp;be&nbsp;routed&nbsp;to&nbsp;the&nbsp;user.&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Here,&nbsp;I&nbsp;assumed&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;subscription&nbsp;between&nbsp;user&nbsp;&amp;amp;&nbsp;contact,<br>
&lt;br&gt;&amp;gt;&nbsp;if&nbsp;that&nbsp;is&nbsp;present,&nbsp;it&nbsp;just&nbsp;adds&nbsp;more&nbsp;to&nbsp;the&nbsp;flow&nbsp;-&nbsp;refer&nbsp;to&nbsp;section&nbsp;9&lt;br&gt;&amp;gt;&nbsp;in&nbsp;3921&nbsp;[1]&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Hope&nbsp;this&nbsp;clarifies.&nbsp;The&nbsp;steps&nbsp;above&nbsp;are&nbsp;the&nbsp;same&nbsp;irrespective&nbsp;of&lt;br&gt;&amp;gt;&nbsp;whether&nbsp;it&nbsp;is&nbsp;a&nbsp;local&nbsp;contact,&nbsp;s2s&nbsp;contact,&nbsp;clustered&nbsp;configuration&nbsp;or<br>
&lt;br&gt;&amp;gt;&nbsp;other&nbsp;combinations.&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Regards,&lt;br&gt;&amp;gt;&nbsp;Mridul&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;[1]&nbsp;&lt;a&nbsp;href=&quot;http://www.xmpp.org/rfcs/rfc3921.html#substates&quot;&gt;http://www.xmpp.org/rfcs/rfc3921.html#substates&lt;/a&gt;&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;Tran&nbsp;Thai&nbsp;Son&nbsp;wrote:<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;Hi&nbsp;all,&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;gt;&nbsp;I&nbsp;am&nbsp;writing&nbsp;a&nbsp;client&nbsp;and&nbsp;I&amp;#39;ve&nbsp;experienced&nbsp;different&nbsp;behaviors&nbsp;from&lt;br&gt;&amp;gt;&amp;gt;&nbsp;different&nbsp;servers&nbsp;in&nbsp;handling&nbsp;client&amp;#39;s&nbsp;actions&nbsp;such&nbsp;as&nbsp;add&nbsp;/&nbsp;accept&nbsp;/&lt;br&gt;&amp;gt;&amp;gt;&nbsp;deny&nbsp;subscription&nbsp;requests.&nbsp;What&nbsp;surprised&nbsp;me&nbsp;is&nbsp;that&nbsp;it&nbsp;seems&nbsp;there<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;is&nbsp;no&nbsp;standard&nbsp;behaviors&nbsp;(&nbsp;e.g.&nbsp;processes&nbsp;of&nbsp;treating&nbsp;actions,&nbsp;order&lt;br&gt;&amp;gt;&amp;gt;&nbsp;of&nbsp;notification&nbsp;messages&nbsp;pushing&nbsp;to&nbsp;the&nbsp;clients...)&nbsp;for&nbsp;the&nbsp;server.&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;gt;&nbsp;E.g.:&lt;br&gt;&amp;gt;&amp;gt;&nbsp;-&nbsp;ejabbered&nbsp;1.1.3<br>
&nbsp;always&nbsp;adds&nbsp;the&nbsp;incoming&nbsp;contact&nbsp;to&nbsp;the&nbsp;user&amp;#39;s&lt;br&gt;&amp;gt;&amp;gt;&nbsp;roster&nbsp;(with&nbsp;the&nbsp;subscription&nbsp;status&nbsp;=&nbsp;0,&nbsp;means&nbsp;no&nbsp;relationship)&lt;br&gt;&amp;gt;&amp;gt;&nbsp;before&nbsp;pushing&nbsp;the&nbsp;subscription&nbsp;(add-friend)&nbsp;request&nbsp;to&nbsp;the&nbsp;user.&nbsp;So&lt;br&gt;&amp;gt;&amp;gt;&nbsp;the&nbsp;client&nbsp;gets&nbsp;two&nbsp;messages:&nbsp;one&nbsp;to&nbsp;notify&nbsp;that&nbsp;there&nbsp;is&nbsp;an&nbsp;item<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;added,&nbsp;the&nbsp;next&nbsp;to&nbsp;notify&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;subscription&nbsp;request.&lt;br&gt;&amp;gt;&amp;gt;&nbsp;-&nbsp;meanwhile,&nbsp;openFire&nbsp;3.3.1&nbsp;does&nbsp;not&nbsp;add&nbsp;the&nbsp;contact&nbsp;before,&nbsp;so&nbsp;you&lt;br&gt;&amp;gt;&amp;gt;&nbsp;get&nbsp;only&nbsp;the&nbsp;later&nbsp;message.&nbsp;One&nbsp;(probably)&nbsp;bug&nbsp;I&nbsp;found:&nbsp;even&nbsp;when&nbsp;the<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;client&nbsp;sent&nbsp;a&nbsp;message&nbsp;denying&nbsp;the&nbsp;subscription&nbsp;request,&nbsp;the&nbsp;server&lt;br&gt;&amp;gt;&amp;gt;&nbsp;still&nbsp;adds&nbsp;the&nbsp;contact&nbsp;to&nbsp;the&nbsp;user&amp;#39;s&nbsp;roster&nbsp;(with&nbsp;subscription=&nbsp;0)&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;gt;&nbsp;Furthermore,&nbsp;with&nbsp;the&nbsp;same&nbsp;actions&nbsp;from&nbsp;the&nbsp;clients,&nbsp;the&nbsp;number&amp;nbsp;&amp;nbsp;and<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;order&nbsp;of&nbsp;messages&nbsp;that&nbsp;the&nbsp;servers&nbsp;send&nbsp;significantly&nbsp;different.&lt;br&gt;&amp;gt;&amp;gt;&nbsp;E.g.&lt;br&gt;&amp;gt;&amp;gt;&nbsp;-&nbsp;ejabbered&nbsp;1.1.3&nbsp;tends&nbsp;to&nbsp;not&nbsp;to&nbsp;send&nbsp;any&nbsp;message&nbsp;to&nbsp;the&nbsp;contact&lt;br&gt;&amp;gt;&amp;gt;&nbsp;with&nbsp;subscription&nbsp;=&nbsp;0.&nbsp;Example:&nbsp;If&nbsp;user&nbsp;B&nbsp;denied&nbsp;a&nbsp;subscription<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;request&nbsp;from&nbsp;user&nbsp;B&nbsp;(means&nbsp;no&nbsp;relationship&nbsp;at&nbsp;the&nbsp;moment),&nbsp;B&nbsp;will&nbsp;not&lt;br&gt;&amp;gt;&amp;gt;&nbsp;receive&nbsp;the&nbsp;next&nbsp;unsubscription&nbsp;request&nbsp;from&nbsp;A,&nbsp;but&nbsp;with&nbsp;openFire&lt;br&gt;&amp;gt;&amp;gt;&nbsp;3.3.1,&nbsp;it&nbsp;will.&lt;br&gt;&amp;gt;&amp;gt;&nbsp;-&nbsp;Furthermore,&nbsp;I&nbsp;found&nbsp;the&nbsp;order&nbsp;of&nbsp;messages&nbsp;that&nbsp;openFire&nbsp;pushes&nbsp;to<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;the&nbsp;clients&nbsp;rather&nbsp;annoying.&nbsp;For&nbsp;example,&nbsp;if&nbsp;user&nbsp;A&nbsp;removes&nbsp;user&nbsp;B&lt;br&gt;&amp;gt;&amp;gt;&nbsp;from&nbsp;its&nbsp;roster&nbsp;(and&nbsp;therefore&nbsp;B&nbsp;will&nbsp;also&nbsp;remove&nbsp;A&nbsp;-&nbsp;my&lt;br&gt;&amp;gt;&amp;gt;&nbsp;implementation),&nbsp;A&nbsp;will&nbsp;receive&nbsp;&amp;quot;unsubscribed&amp;quot;&nbsp;and&nbsp;&amp;quot;unsubscribe&amp;quot;<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;(respectively)&nbsp;from&nbsp;B&nbsp;before&nbsp;received&nbsp;the&nbsp;notification&nbsp;that&nbsp;its&lt;br&gt;&amp;gt;&amp;gt;&nbsp;removal&nbsp;was&nbsp;done.&nbsp;So&nbsp;you&nbsp;cannot&nbsp;trust&nbsp;that:&nbsp;when&nbsp;you&nbsp;remove&nbsp;a&nbsp;contact&lt;br&gt;&amp;gt;&amp;gt;&nbsp;from&nbsp;your&nbsp;roster,&nbsp;you&nbsp;won&amp;#39;t&nbsp;receive&nbsp;unexpected&nbsp;message&nbsp;from&nbsp;that<br>
&lt;br&gt;&amp;gt;&amp;gt;&nbsp;contact;&nbsp;You&nbsp;also&nbsp;see&nbsp;that&nbsp;contact&nbsp;still&nbsp;in&nbsp;your&nbsp;roster&nbsp;for&nbsp;a&nbsp;while&lt;br&gt;&amp;gt;&amp;gt;&nbsp;(with&nbsp;subscription&nbsp;=&nbsp;0).&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;gt;&nbsp;Does&nbsp;any&nbsp;body&nbsp;experience&nbsp;similar&nbsp;problems&nbsp;?&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;gt;&nbsp;Son.&lt;br&gt;&amp;gt;&amp;gt;<br>
&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&amp;gt;&amp;gt;&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;
</tt>
