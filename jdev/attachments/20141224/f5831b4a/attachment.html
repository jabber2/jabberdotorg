<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt; &nbsp;I&nbsp;m&nbsp;using&nbsp;GLOOX&nbsp;example&nbsp;code&nbsp;to&nbsp;do&nbsp;file&nbsp;transfer..(ft_send.cpp&nbsp;file)&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;eJabberd&nbsp;server&nbsp;in&nbsp;my&nbsp;machine&nbsp;(binding&nbsp;to&nbsp;localhost&nbsp;:&nbsp;5222)&nbsp;and&nbsp;a&nbsp;Jabber&nbsp;Messenger.&lt;/div&gt;&lt;div&gt;I&nbsp;m&nbsp;running&nbsp;my&nbsp;code&nbsp;in&nbsp;windows&nbsp;platform&nbsp;using&nbsp;the&nbsp;example&nbsp;code&nbsp;given&nbsp;in&nbsp;ft_send.cpp..&lt;/div&gt;&lt;div&gt;I&nbsp;m&nbsp;not&nbsp;able&nbsp;to&nbsp;transfer&nbsp;the&nbsp;file.&lt;/div&gt;&lt;div&gt;Please&nbsp;let&nbsp;me&nbsp;know&nbsp;what&nbsp;I&nbsp;m&nbsp;doing&nbsp;wrong&nbsp;here..And&nbsp;also&nbsp;wanted&nbsp;to&nbsp;know&nbsp;when&nbsp;handleFTBytestream()&nbsp;API&nbsp;will&nbsp;get&nbsp;called..&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance&nbsp;for&nbsp;your&nbsp;help.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;see&nbsp;below&nbsp;my&nbsp;code//&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;#include&nbsp;&quot;client.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;connectionlistener.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;stanza.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;gloox.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;disco.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;loghandler.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;logsink.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;siprofileft.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;siprofilefthandler.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;bytestreamdatahandler.h&quot;&lt;/div&gt;&lt;div&gt;#include&nbsp;&quot;socks5bytestreamserver.h&quot;&lt;/div&gt;&lt;div&gt;using&nbsp;namespace&nbsp;gloox;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#include&nbsp;&lt;sys/types.h&gt;&lt;/div&gt;&lt;div&gt;#include&nbsp;&lt;sys/stat.h&gt;&lt;/div&gt;&lt;div&gt;//#include&nbsp;&lt;unistd.h&gt;&lt;/div&gt;&lt;div&gt;#include&nbsp;&lt;stdio.h&gt;&lt;/div&gt;&lt;div&gt;#include&nbsp;&lt;string&gt;&lt;/div&gt;&lt;div&gt;#include&nbsp;&lt;fstream&gt;&lt;/div&gt;&lt;div&gt;#include&nbsp;&lt;ios&gt;&lt;/div&gt;&lt;div&gt;#include&nbsp;&lt;time.h&gt;&lt;/div&gt;&lt;div&gt;#include&nbsp;&lt;cstdio&gt;&nbsp;//&nbsp;[s]print[f]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#if&nbsp;defined(&nbsp;WIN32&nbsp;)&nbsp;||&nbsp;defined(&nbsp;_WIN32&nbsp;)&lt;/div&gt;&lt;div&gt;#&nbsp;include&nbsp;&lt;windows.h&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/**&lt;/div&gt;&lt;div&gt; *&nbsp;Usage:&lt;/div&gt;&lt;div&gt; *&nbsp; &nbsp;ft_send&nbsp;jid@server/full&nbsp;/path/to/file&lt;/div&gt;&lt;div&gt; *&lt;/div&gt;&lt;div&gt; *&nbsp;Sends&nbsp;the&nbsp;given&nbsp;file&nbsp;to&nbsp;the&nbsp;given&nbsp;full&nbsp;JID.&lt;/div&gt;&lt;div&gt; */&lt;/div&gt;&lt;div&gt;class&nbsp;FTTest&nbsp;:&nbsp;public&nbsp;LogHandler,&nbsp;ConnectionListener,&nbsp;SIProfileFTHandler,&nbsp;BytestreamDataHandler&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt; &nbsp;public:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;FTTest(&nbsp;const&nbsp;JID&amp;&nbsp;to,&nbsp;const&nbsp;std::string&amp;&nbsp;file&nbsp;)&nbsp;:&nbsp;m_bs(&nbsp;0&nbsp;),&nbsp;m_to(&nbsp;to&nbsp;),&nbsp;m_file(&nbsp;file&nbsp;),&nbsp;m_quit(&nbsp;false&nbsp;)&nbsp;{}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;~FTTest()&nbsp;{}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;void&nbsp;start()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;struct&nbsp;stat&nbsp;f_stat;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;if(&nbsp;stat(&nbsp;m_file.c_str(),&nbsp;&amp;f_stat&nbsp;)&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;return;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;m_size&nbsp;=&nbsp;f_stat.st_size;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;std::ifstream&nbsp;ifile(&nbsp;m_file.c_str(),&nbsp;std::ios_base::in&nbsp;|&nbsp;std::ios_base::binary&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;if(&nbsp;!ifile&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;return;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;JID&nbsp;jid(&nbsp;&quot;&lt;a&nbsp;href=&quot;http://kalpana@127.0.0.1/Jabber&quot;&gt;kalpana@127.0.0.1/Jabber&lt;/a&gt;&nbsp;Messenger&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;j&nbsp;=&nbsp;new&nbsp;Client(&nbsp;jid,&nbsp;&quot;kalpana&quot;&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;j-&gt;registerConnectionListener(&nbsp;this&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;j-&gt;disco()-&gt;setVersion(&nbsp;&quot;ftsend&quot;,&nbsp;GLOOX_VERSION,&nbsp;&quot;Linux&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;j-&gt;disco()-&gt;setIdentity(&nbsp;&quot;client&quot;,&nbsp;&quot;bot&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;StringList&nbsp;ca;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;ca.push_back(&nbsp;&quot;/path/to/cacert.crt&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;j-&gt;setCACerts(&nbsp;ca&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;j-&gt;logInstance().registerLogHandler(&nbsp;LogLevelDebug,&nbsp;LogAreaAll,&nbsp;this&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;m_server&nbsp;=&nbsp;new&nbsp;SOCKS5BytestreamServer(&nbsp;j-&gt;logInstance(),&nbsp;7777&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;about&nbsp;to&nbsp;listen\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;ConnectionError&nbsp;le&nbsp;=&nbsp;ConnNoError;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;if(&nbsp;(&nbsp;le&nbsp;=&nbsp;m_server-&gt;listen()&nbsp;)&nbsp;!=&nbsp;ConnNoError&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;listen&nbsp;returned:&nbsp;%d\n&quot;,&nbsp;le&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;listening\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;f&nbsp;=&nbsp;new&nbsp;SIProfileFT(&nbsp;j,&nbsp;this&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;f-&gt;registerSOCKS5BytestreamServer(&nbsp;m_server&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;&nbsp; f-&gt;addStreamHost(&nbsp;j-&gt;jid(),&quot;localhost&quot;,&nbsp;7777);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;//&nbsp;you&nbsp;should&nbsp;obtain&nbsp;this&nbsp;using&nbsp;disco,&nbsp;really:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; f-&gt;addStreamHost(&nbsp;JID(&nbsp;&quot;&lt;a&nbsp;href=&quot;http://reflector.amessage.eu&quot;&gt;reflector.amessage.eu&lt;/a&gt;&quot;&nbsp;),&nbsp;&quot;&lt;a&nbsp;href=&quot;http://reflector.amessage.eu&quot;&gt;reflector.amessage.eu&lt;/a&gt;&quot;,&nbsp;6565&nbsp;);&lt;/div&gt;&lt;div&gt;//&nbsp; &nbsp; &nbsp; &nbsp;f-&gt;addStreamHost(&nbsp;JID(&nbsp;&quot;&lt;a&nbsp;href=&quot;http://proxy.jabber.org&quot;&gt;proxy.jabber.org&lt;/a&gt;&quot;&nbsp;),&nbsp;&quot;208.245.212.98&quot;,&nbsp;7777&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;if(&nbsp;j-&gt;connect(&nbsp;false&nbsp;)&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;char&nbsp;input[200024];&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;ConnectionError&nbsp;ce&nbsp;=&nbsp;ConnNoError;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;ConnectionError&nbsp;se&nbsp;=&nbsp;ConnNoError;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;while(&nbsp;ce&nbsp;==&nbsp;ConnNoError&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(&nbsp;m_quit&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;j-&gt;disconnect();&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ce&nbsp;=&nbsp;j-&gt;recv(&nbsp;1&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(&nbsp;m_server&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;se&nbsp;=&nbsp;m_server-&gt;recv(&nbsp;1&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(&nbsp;se&nbsp;!=&nbsp;ConnNoError&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;SOCKS5BytestreamServer&nbsp;returned:&nbsp;%d\n&quot;,&nbsp;se&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;delete&nbsp;m_server;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;m_server&nbsp;=&nbsp;0;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;m_quit&nbsp;=&nbsp;true;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(!ifile.eof()&nbsp;)&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp; {&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp; if(&nbsp;m_bs&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(&nbsp;m_bs-&gt;isOpen()&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ifile.read(&nbsp;input,&nbsp;200024&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;std::string&nbsp;t(&nbsp;input,&nbsp;ifile.gcount()&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(&nbsp;!m_bs-&gt;send(&nbsp;t&nbsp;)&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;m_quit&nbsp;=&nbsp;true;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;m_bs-&gt;recv(&nbsp;1&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&nbsp; }&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else&nbsp;if(&nbsp;m_bs&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;m_bs-&gt;close();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;ce:&nbsp;%d\n&quot;,&nbsp;ce&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;f-&gt;dispose(&nbsp;m_bs&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;delete&nbsp;f;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;delete&nbsp;m_server;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;delete&nbsp;j;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;onConnect()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;connected!!!\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt; &lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&lt;/span&gt;&nbsp;f-&gt;requestFT(&nbsp;m_to,&nbsp;m_file,&nbsp;m_size);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;//&nbsp; f-&gt;requestFT(&nbsp;m_to,&nbsp;m_file,&nbsp;m_size&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;onDisconnect(&nbsp;ConnectionError&nbsp;e&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;ft_send:&nbsp;disconnected:&nbsp;%d\n&quot;,&nbsp;e&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;if(&nbsp;e&nbsp;==&nbsp;ConnAuthenticationFailed&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;auth&nbsp;failed.&nbsp;reason:&nbsp;%d\n&quot;,&nbsp;j-&gt;authError()&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;bool&nbsp;onTLSConnect(&nbsp;const&nbsp;CertInfo&amp;&nbsp;info&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;time_t&nbsp;from(&nbsp;info.date_from&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;time_t&nbsp;to(&nbsp;info.date_to&nbsp;);&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;status:&nbsp;%d\nissuer:&nbsp;%s\npeer:&nbsp;%s\nprotocol:&nbsp;%s\nmac:&nbsp;%s\ncipher:&nbsp;%s\ncompression:&nbsp;%s\n&quot;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;from:&nbsp;%s\nto:&nbsp;%s\n&quot;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;info.status,&nbsp;info.issuer.c_str(),&nbsp;info.server.c_str(),&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;info.protocol.c_str(),&nbsp;info.mac.c_str(),&nbsp;info.cipher.c_str(),&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;info.compression.c_str(),&nbsp;ctime(&nbsp;&amp;from&nbsp;),&nbsp;ctime(&nbsp;&amp;to&nbsp;)&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;return&nbsp;true;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;handleLog(&nbsp;LogLevel&nbsp;level,&nbsp;LogArea&nbsp;area,&nbsp;const&nbsp;std::string&amp;&nbsp;message&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&quot;log:&nbsp;level:&nbsp;%d,&nbsp;area:&nbsp;%d,&nbsp;%s\n&quot;,&nbsp;level,&nbsp;area,&nbsp;message.c_str()&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;handleFTRequest(&nbsp;const&nbsp;JID&amp;&nbsp;from,&nbsp;const&nbsp;JID&amp;&nbsp;/*to*/,&nbsp;const&nbsp;std::string&amp;&nbsp;sid,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const&nbsp;std::string&amp;&nbsp;name,&nbsp;long&nbsp;size,&nbsp;const&nbsp;std::string&amp;&nbsp;hash,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const&nbsp;std::string&amp;&nbsp;date,&nbsp;const&nbsp;std::string&amp;&nbsp;mimetype,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const&nbsp;std::string&amp;&nbsp;desc,&nbsp;int&nbsp;/*stypes*/&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;received&nbsp;ft&nbsp;request&nbsp;from&nbsp;%s:&nbsp;%s&nbsp;(%ld&nbsp;bytes,&nbsp;sid:&nbsp;%s).&nbsp;hash:&nbsp;%s,&nbsp;date:&nbsp;%s,&nbsp;mime-type:&nbsp;%s\n&quot;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;desc:&nbsp;%s\n&quot;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;from.full().c_str(),&nbsp;name.c_str(),&nbsp;size,&nbsp;sid.c_str(),&nbsp;hash.c_str(),&nbsp;date.c_str(),&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mimetype.c_str(),&nbsp;desc.c_str()&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;f-&gt;acceptFT(&nbsp;from,&nbsp;sid,&nbsp;SIProfileFT::FTTypeS5B&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;//&nbsp; &nbsp; &nbsp;virtual&nbsp;void&nbsp;handleFTRequestResult(&nbsp;const&nbsp;JID&amp;&nbsp;/*from*/,&nbsp;const&nbsp;std::string&amp;&nbsp;/*sid*/&nbsp;)&lt;/div&gt;&lt;div&gt;//&nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt;//&nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;handleFTRequestError(&nbsp;const&nbsp;IQ&amp;&nbsp;/*iq*/,&nbsp;const&nbsp;std::string&amp;&nbsp;/*sid*/&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;ft&nbsp;request&nbsp;error\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;m_quit&nbsp;=&nbsp;true;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;handleFTBytestream(&nbsp;Bytestream*&nbsp;bs&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;received&nbsp;bytestream&nbsp;of&nbsp;type:&nbsp;%s&quot;,&nbsp;bs-&gt;type()&nbsp;==&nbsp;Bytestream::S5B&nbsp;?&nbsp;&quot;s5b&quot;&nbsp;:&nbsp;&quot;ibb&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;m_bs&nbsp;=&nbsp;bs;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;m_bs-&gt;registerBytestreamDataHandler(&nbsp;this&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;if(&nbsp;m_bs-&gt;connect()&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;if(&nbsp;bs-&gt;type()&nbsp;==&nbsp;Bytestream::S5B&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;ok!&nbsp;s5b&nbsp;connected&nbsp;to&nbsp;streamhost\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;else&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;ok!&nbsp;ibb&nbsp;sent&nbsp;request&nbsp;to&nbsp;remote&nbsp;entity\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;const&nbsp;std::string&nbsp;handleOOBRequestResult(&nbsp;const&nbsp;JID&amp;&nbsp;/*from*/,&nbsp;const&nbsp;JID&amp;&nbsp;/*to*/,&nbsp;const&nbsp;std::string&amp;&nbsp;/*sid*/&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;return&nbsp;std::string();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;};&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;handleBytestreamData(&nbsp;Bytestream*&nbsp;/*bs*/,&nbsp;const&nbsp;std::string&amp;&nbsp;data&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;received&nbsp;%d&nbsp;bytes&nbsp;of&nbsp;data:\n%s\n&quot;,&nbsp;data.length(),&nbsp;data.c_str()&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;handleBytestreamError(&nbsp;Bytestream*&nbsp;/*bs*/,&nbsp;const&nbsp;IQ&amp;&nbsp;/*iq*/&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;bytestream&nbsp;error\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;handleBytestreamOpen(&nbsp;Bytestream*&nbsp;/*bs*/&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;bytestream&nbsp;opened\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;virtual&nbsp;void&nbsp;handleBytestreamClose(&nbsp;Bytestream*&nbsp;/*bs*/&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;bytestream&nbsp;closed\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;m_quit&nbsp;=&nbsp;true;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;private:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Client&nbsp;*j;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;SIProfileFT*&nbsp;f;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;Bytestream*&nbsp;m_bs;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;SOCKS5BytestreamServer*&nbsp;m_server;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;JID&nbsp;m_to;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;std::string&nbsp;m_file;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;bool&nbsp;m_quit;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;int&nbsp;m_size;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;int&nbsp;main(&nbsp;int&nbsp;argc,&nbsp;char**&nbsp;argv&nbsp;)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt; //&nbsp;if(&nbsp;argc&nbsp;==&nbsp;3&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;JID&nbsp;j(&nbsp;&quot;&lt;a&nbsp;href=&quot;http://best@127.0.0.1/Jabber&quot;&gt;best@127.0.0.1/Jabber&lt;/a&gt;&nbsp;Messenger&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;if(&nbsp;j.resource().empty()&nbsp;)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;printf(&nbsp;&quot;error:&nbsp;need&nbsp;full&nbsp;jid\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;return&nbsp;1;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;}&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;FTTest&nbsp;*r&nbsp;=&nbsp;new&nbsp;FTTest(&nbsp;j,&nbsp;&quot;c:\\read.xml&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;r-&gt;start();&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;delete(&nbsp;r&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp;}&lt;/div&gt;&lt;div&gt;//&nbsp; else&lt;/div&gt;&lt;div&gt; &nbsp;{&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;printf(&nbsp;&quot;error:&nbsp;need&nbsp;jid&nbsp;+&nbsp;file\n&quot;&nbsp;);&lt;/div&gt;&lt;div&gt; &nbsp;}&lt;/div&gt;&lt;div&gt; &nbsp;return&nbsp;0;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;kalpana&lt;/div&gt;&lt;/div&gt;<br>

</tt>
