<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=windows-1252&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;5.5.2654.45&quot;&gt;<br>
&lt;TITLE&gt;RE:&nbsp;[JDEV]&nbsp;Re:&nbsp;OOB&nbsp;filetransfer&nbsp;negotiation&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;The&nbsp;jabber:iq:oob&nbsp;packets&nbsp;can&nbsp;be&nbsp;used&nbsp;along&nbsp;with&nbsp;the&nbsp;mini-HTTP&nbsp;server&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;to&nbsp;ensure&nbsp;that&nbsp;only&nbsp;the&nbsp;intended&nbsp;person&nbsp;downloads&nbsp;the&nbsp;file,&nbsp;even&nbsp;if&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;someone&nbsp;is&nbsp;sniffing&nbsp;the&nbsp;Jabber&nbsp;messages.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;Here&nbsp;is&nbsp;the&nbsp;sequence&nbsp;of&nbsp;events&nbsp;that&nbsp;we&nbsp;use&nbsp;when&nbsp;client&nbsp;A&nbsp;wants&nbsp;to&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;send&nbsp;client&nbsp;B&nbsp;a&nbsp;file.&amp;nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;1.&nbsp;Client&nbsp;A&nbsp;starts&nbsp;up&nbsp;its&nbsp;mini-web&nbsp;server,&nbsp;generates&nbsp;a&nbsp;unique&nbsp;URI&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;for&nbsp;that&nbsp;file&nbsp;and&nbsp;sends&nbsp;a&nbsp;jabber:iq:oob&nbsp;packet&nbsp;through&nbsp;the&nbsp;Jabber&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;server,&nbsp;with&nbsp;the&nbsp;URL&nbsp;for&nbsp;that&nbsp;file.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;2.&nbsp;Client&nbsp;B&nbsp;reads&nbsp;the&nbsp;jabber:iq:oob&nbsp;packet&nbsp;and&nbsp;tries&nbsp;to&nbsp;connect&nbsp;to&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;that&nbsp;URL.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;3.&nbsp;Client&nbsp;A's&nbsp;HTTP&nbsp;server&nbsp;gets&nbsp;the&nbsp;new&nbsp;connection&nbsp;and&nbsp;request&nbsp;for&nbsp;that&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;URI&nbsp;and&nbsp;sends&nbsp;its&nbsp;HTTP&nbsp;headers&nbsp;back&nbsp;to&nbsp;client&nbsp;B.&amp;nbsp;&nbsp;After&nbsp;sending&nbsp;the&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;headers,&nbsp;the&nbsp;HTTP&nbsp;server&nbsp;waits&nbsp;for&nbsp;a&nbsp;response&nbsp;to&nbsp;the&nbsp;original&nbsp;iq&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;before&nbsp;sending&nbsp;the&nbsp;file.&amp;nbsp;&nbsp;It&nbsp;waits&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;it&nbsp;is&nbsp;client&nbsp;B&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;that&nbsp;is&nbsp;trying&nbsp;to&nbsp;download&nbsp;that&nbsp;file.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;4.&nbsp;Client&nbsp;B&nbsp;reads&nbsp;the&nbsp;HTTP&nbsp;headers&nbsp;and&nbsp;sends&nbsp;a&nbsp;jabber:iq:oob&nbsp;with&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;a&nbsp;type='result'&nbsp;attribute&nbsp;packet&nbsp;back&nbsp;through&nbsp;the&nbsp;jabber&nbsp;server.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;This&nbsp;tells&nbsp;client&nbsp;A&nbsp;that&nbsp;it&nbsp;has&nbsp;successfully&nbsp;connected&nbsp;and&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;successfully&nbsp;requested&nbsp;the&nbsp;file&nbsp;from&nbsp;the&nbsp;web&nbsp;server.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;5.&nbsp;Client&nbsp;A&nbsp;reads&nbsp;the&nbsp;iq&nbsp;result&nbsp;packet&nbsp;from&nbsp;the&nbsp;jabber&nbsp;server&nbsp;and&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;proceeds&nbsp;with&nbsp;sending&nbsp;the&nbsp;file&nbsp;through&nbsp;the&nbsp;HTTP&nbsp;server.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;6.&nbsp;Client&nbsp;A&nbsp;shuts&nbsp;down&nbsp;its&nbsp;mini-web&nbsp;server&nbsp;if&nbsp;no&nbsp;more&nbsp;file&nbsp;transfers&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;are&nbsp;pending.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;If&nbsp;for&nbsp;some&nbsp;reason&nbsp;client&nbsp;B&nbsp;cannot&nbsp;connect&nbsp;to&nbsp;client&nbsp;A's&nbsp;HTTP&nbsp;server,&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;or&nbsp;if&nbsp;client&nbsp;B&nbsp;decides&nbsp;it&nbsp;doesn't&nbsp;want&nbsp;to&nbsp;download&nbsp;the&nbsp;file,&nbsp;then&nbsp;client&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;B&nbsp;sends&nbsp;an&nbsp;error&nbsp;as&nbsp;the&nbsp;response&nbsp;to&nbsp;the&nbsp;iq&nbsp;and&nbsp;A&nbsp;rejects&nbsp;any&nbsp;downloading&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;from&nbsp;that&nbsp;URI.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;As&nbsp;far&nbsp;as&nbsp;I&nbsp;know,&nbsp;this&nbsp;is&nbsp;the&nbsp;correct&nbsp;way&nbsp;to&nbsp;send&nbsp;files&nbsp;in&nbsp;Jabber&nbsp;and&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;ensure&nbsp;that&nbsp;the&nbsp;files&nbsp;go&nbsp;to&nbsp;the&nbsp;right&nbsp;person.&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;There&nbsp;was&nbsp;a&nbsp;good&nbsp;discussion&nbsp;jabber:iq:oob&nbsp;about&nbsp;it&nbsp;in&nbsp;November,&nbsp;look&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;for&nbsp;the&nbsp;jabber:iq:oob&nbsp;thread.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&lt;A&nbsp;HREF=&quot;http://mailman.jabber.org/pipermail/jdev/2000-November/thread.html&quot;&nbsp;TARGET=&quot;_blank&quot;&gt;http://mailman.jabber.org/pipermail/jdev/2000-November/thread.html&lt;/A&gt;&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;-Robert&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;-----Original&nbsp;Message-----&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;From:&nbsp;Jens&nbsp;Alfke&nbsp;[&lt;A&nbsp;HREF=&quot;mailto:jens@mac.com&quot;&gt;mailto:jens@mac.com&lt;/A&gt;]&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;Sent:&nbsp;Tuesday,&nbsp;August&nbsp;14,&nbsp;2001&nbsp;9:24&nbsp;AM&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;To:&nbsp;jdev@jabber.org&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;Subject:&nbsp;[JDEV]&nbsp;Re:&nbsp;OOB&nbsp;filetransfer&nbsp;negotiation&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;On&nbsp;Monday,&nbsp;August&nbsp;13,&nbsp;2001,&nbsp;at&nbsp;05:05&nbsp;PM,&nbsp;Julie&nbsp;wrote:&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&amp;gt;&amp;nbsp;&amp;nbsp;&nbsp;From&nbsp;my&nbsp;understanding&nbsp;of&nbsp;the&nbsp;descriptions&nbsp;of&nbsp;the&nbsp;two&nbsp;iq&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;tags,&nbsp;they&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;are&nbsp;used&nbsp;only&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;to&nbsp;send&nbsp;the&nbsp;URL&nbsp;to&nbsp;the&nbsp;client.&amp;nbsp;&nbsp;The&nbsp;client&nbsp;then&nbsp;goes&nbsp;to&nbsp;the&nbsp;URL&nbsp;to&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;retrieve&nbsp;the&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;file.&amp;nbsp;&nbsp;Am&nbsp;I&nbsp;right?&amp;nbsp;&nbsp;Is&nbsp;there&nbsp;anyway&nbsp;to&nbsp;do&nbsp;a&nbsp;direct&nbsp;client-to-client&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&amp;gt;&nbsp;file&nbsp;transfer?&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;Yes&nbsp;—&nbsp;run&nbsp;a&nbsp;tiny&nbsp;HTTP&nbsp;server&nbsp;on&nbsp;the&nbsp;sending&nbsp;client&nbsp;that&nbsp;can&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;deliver&nbsp;the&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;file&nbsp;to&nbsp;the&nbsp;recipient.&nbsp;Then&nbsp;the&nbsp;sender&nbsp;just&nbsp;creates&nbsp;a&nbsp;URL&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;with&nbsp;its&nbsp;own&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;IP&nbsp;address&nbsp;as&nbsp;the&nbsp;host.&nbsp;In&nbsp;my&nbsp;client&nbsp;I&nbsp;use&nbsp;a&nbsp;random&nbsp;port&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;number&nbsp;and&nbsp;also&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;make&nbsp;up&nbsp;a&nbsp;random&nbsp;64-bit&nbsp;number&nbsp;to&nbsp;put&nbsp;in&nbsp;the&nbsp;URL&nbsp;before&nbsp;the&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;name&nbsp;of&nbsp;the&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;file,&nbsp;just&nbsp;to&nbsp;make&nbsp;it&nbsp;harder&nbsp;for&nbsp;a&nbsp;3rd&nbsp;party&nbsp;to&nbsp;find&nbsp;the&nbsp;file&nbsp;(unless&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;they&nbsp;intercept&nbsp;the&nbsp;Jabber&nbsp;message,&nbsp;in&nbsp;which&nbsp;case&nbsp;all&nbsp;bets&nbsp;are&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;off.)&nbsp;So&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;the&nbsp;URL&nbsp;I&nbsp;send&nbsp;would&nbsp;look&nbsp;like:&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://my.ip.address:randomportnumber/sixteenrandomhexdigits/n&quot;&nbsp;TARGET=&quot;_blank&quot;&gt;http://my.ip.address:randomportnumber/sixteenrandomhexdigits/n&lt;/A&gt;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;ameoffile&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;However,&nbsp;this&nbsp;only&nbsp;works&nbsp;if&nbsp;the&nbsp;receiver&nbsp;can&nbsp;make&nbsp;an&nbsp;HTTP&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;connection&nbsp;to&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;the&nbsp;sender,&nbsp;i.e.&nbsp;the&nbsp;sender&nbsp;is&nbsp;not&nbsp;behind&nbsp;a&nbsp;firewall&nbsp;or&nbsp;NAT.&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;--Jens&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;_______________________________________________&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;jdev&nbsp;mailing&nbsp;list&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;jdev@jabber.org&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;A&nbsp;HREF=&quot;http://mailman.jabber.org/listinfo/jdev&quot;&nbsp;TARGET=&quot;_blank&quot;&gt;http://mailman.jabber.org/listinfo/jdev&lt;/A&gt;&lt;/FONT&gt;<br>
&lt;BR&gt;&lt;FONT&nbsp;SIZE=2&gt;&amp;gt;&nbsp;&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;<br>
&lt;/HTML&gt;
</tt>
