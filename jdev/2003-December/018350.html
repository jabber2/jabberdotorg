<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [JDEV] Videoconferencing with jabber / Re:[speex-dev]Videoconferencing with speex and jabber
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=%5BJDEV%5D%20Videoconferencing%20with%20jabber%20/%20Re%3A%5Bspeex-dev%5DVideoconferencing%20with%20speex%20and%20jabber&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018339.html">
   <LINK REL="Next"  HREF="018351.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[JDEV] Videoconferencing with jabber / Re:[speex-dev]Videoconferencing with speex and jabber</H1>
    <B>Richard Dobson</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=%5BJDEV%5D%20Videoconferencing%20with%20jabber%20/%20Re%3A%5Bspeex-dev%5DVideoconferencing%20with%20speex%20and%20jabber&In-Reply-To="
       TITLE="[JDEV] Videoconferencing with jabber / Re:[speex-dev]Videoconferencing with speex and jabber">richard at dobson-i.net
       </A><BR>
    <I>Tue Dec  2 04:50:36 CST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="018339.html">[JDEV] Videoconferencing with jabber / Re:[speex-dev]Videoconferencing with speex and jabber
</A></li>
        <LI>Next message: <A HREF="018351.html">[JDEV] Videoconferencing with jabber / Re:[speex-dev]Videoconferencing with speex and jabber
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18350">[ date ]</a>
              <a href="thread.html#18350">[ thread ]</a>
              <a href="subject.html#18350">[ subject ]</a>
              <a href="author.html#18350">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> More advanced clients are likely to also implement a server that supports
</I>&gt;<i> hosting a conference with more than 2 people. Or they'll implement a
</I>&gt;<i> direct link conferencing extention (still based on the same protocol
</I>&gt;<i> ofcourse). Those two are complimentary not competitive. But as pointed out
</I>&gt;<i> by you, direct link person to person is definatly needed most, and as
</I>&gt;<i> pointed out by other, server based conferencing is needed most too.
</I>&gt;<i>
</I>&gt;<i> That doesn't mean there are no use cases left for direct link based
</I>&gt;<i> conferencing, but IMHO not enough to justify a spec that will miss out on
</I>&gt;<i> server based conferencing when you can get that practically for free, and
</I>&gt;<i> will complicate the spec and raise the requirments for conferencing.
</I>&gt;<i> Again, it's not impossible.
</I>
I didnt intend to say that we should not have server based conferencing at
all, all I originally meant to object to was putting that into a client
rather than just using a dedicated server, and in cases where you can that
you should use p2p. Now I can see that p2p wont cover all cases, but also I
am unconvinced server based will cover all uses either, so as I suggested at
the bottom of the email is a hybrid cs/p2p mechanism that can take the best
of both worlds and cover more situations that either one of them alone plus
being more flexable.

&gt;<i> Skype uses UDP NAT travelsal based on getting it's IP from someone outside
</I>&gt;<i> the NAT (at least, so it was suggested either here or on SJIG), wich is
</I>&gt;<i> currently being rejected by the jabber server folks
</I>
I was under the impression it was asking your server for the IP address that
they are objecting to not other methods of obtaining it.

&gt;<i> SOCKS5 is hardly integrated with an excisting mechanism, it just uses part
</I>&gt;<i> of the same spec. Using SI you can intergrate other solutions, almost
</I>&gt;<i> transparently, and fall back on others if they don't work. That doesn't
</I>&gt;<i> eliminate the need for a spec of setting up these things, and I see no
</I>&gt;<i> good reason to not use a c/s architecture there.
</I>
Well it is using an existing protocol rather than baking our own, I was
suggesting that maybe we could do the same in this case and see if there is
an existing protocol/system that we could integrate with rather than
possibly duplicating effort and saving us time.

&gt;<i> Agreed, when creating such a spec based on c/s, attention should be paid
</I>&gt;<i> to allowing a direct-link conference style solution from the start. For
</I>&gt;<i> that matter, it should also allow for things such as distrubited hosting
</I>&gt;<i> of a conference (a sort of hybrid between direct links and c/s) or any
</I>&gt;<i> other things people can come up with. It should just be as generic as
</I>&gt;<i> possible.
</I>
Good

&gt;<i> &gt; Yes but the server has to do more than simply mix the streams, it also
</I>&gt;<i> &gt; has
</I>&gt;<i> &gt; to re-encode the mixed streams, also if you want to remove echo's as you
</I>&gt;<i> &gt; suggest below or be able to ignore partipants as someone has already
</I>&gt;<i> &gt; suggested as useful functionality you need to re-mix and re-encode all
</I>&gt;<i> &gt; outgoing streams individually, which would I expect be quite a CPU
</I>drain,
&gt;<i> &gt; but in p2p mode clients if using available technologies (directx or the
</I>&gt;<i> &gt; equivalent) you dont even need to mix the streams as you can play
</I>&gt;<i> &gt; simultaneous WAVE streams at the same time, also the client isnt needing
</I>&gt;<i> &gt; to
</I>&gt;<i> &gt; re-encode the stream to send out again.
</I>&gt;<i>
</I>&gt;<i> Well, I agree that, just like with the bandwith requirments, demands on
</I>&gt;<i> the server will be higher than on a node in a direct link conference. Just
</I>&gt;<i> not THAT much higher
</I>
Sorry but it is much higher because of the fact that in p2p clients do not
need to do any re-encoding at all, plus the fact that you need individually
mix the streams before re-encoding them to send out, this IS much more of a
requirement since using p2p you dont necessarly even have to do the mixing
step, let alone the re-encoding step (which will be the most CPU intensive
part). Plus remember to prevent echoing you really need to mix/encode each
of the outgoing streams individually.

&gt;<i>, unless you want some more advanced features. There's
</I>&gt;<i> always trade-offs between the two solutions, and at times you could prefer
</I>&gt;<i> yours over the other. But the point I'm making is that we can have *all*
</I>&gt;<i> of them, relativly simple with a c/s based architecture, even if a p2p
</I>&gt;<i> spec might be just a *little* easier to work with in your case, or at
</I>&gt;<i> least sound more logical when reading the spec.
</I>&gt;<i>
</I>&gt;<i> Ofcourse you still have to mix when you use DirectX ;)
</I>
Playing two (or more) streams simultaneously is not mixing as far as I am
concerned, so no you dont necessarly have to even mix.

&gt;<i> Servers can use
</I>&gt;<i> existing technology too ofcourse.. Servers (components) specializing in
</I>&gt;<i> hosting this kind for companies or paying customers could even use DSP
</I>&gt;<i> hardware and such.
</I>
Sure but using hardware such as that will be out of reach for the vast
majority of people.

&gt;<i> &gt; Not sure how you would suppress the echo of what someone said without
</I>&gt;<i> &gt; re-coding the streams individually to exclude that person on their own
</I>&gt;<i> &gt; incoming listening stream.
</I>&gt;<i>
</I>&gt;<i> Well, aside from that you can surpress it client side... (which would
</I>&gt;<i> raise the requirments for our poor pocketPC clients a little too much) I'm
</I>&gt;<i> not an expert on audio technology but I'd imagine there are some
</I>&gt;<i> optimizations heavy possible when making different mixes based on the same
</I>&gt;<i> streams? I could be wrong ofcourse..
</I>
I doubt it would be very clean and pretty hard to do, the only way I can see
it really working is by individually encoding each outgoing stream on the
server.

&gt;<i> &gt;&gt; Latency is an intresting case, but in practise the results would
</I>&gt;<i> &gt;&gt; probably
</I>&gt;<i> &gt;&gt; surprise you. Because on low-bandwith nodes to bandwith requirments
</I>&gt;<i> &gt;&gt; dramatically drop when they act as a client rather than a node in the
</I>&gt;<i> &gt;&gt; direct link conference, latency in many cases will actually improve in
</I>a
&gt;<i> &gt;&gt; lot of cases!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thats good but do you have any real evidence of this?
</I>&gt;<i>
</I>&gt;<i> I assume you have no problems with the idea that latency is lower on
</I>&gt;<i> low-bandwith connections when the bandwith used is lower too? If not..
</I>&gt;<i> just play an online game, then exit it, turn on some filesharing network,
</I>&gt;<i> and play the game again ;) That's just simple maths!
</I>&gt;<i>
</I>&gt;<i> Even on my old &quot;broadband&quot; connection, where I had 15 KB/s upstream
</I>&gt;<i> availably, latency would jump from about 25-40ms to 50-400ms if I used
</I>&gt;<i> only 10KB/s of it for different purposes.
</I>&gt;<i>
</I>&gt;<i> Gaming provides another example.. in the old days when I played Quake, I'd
</I>&gt;<i> be a lot faster to play on my ISPs server with someone, then for either of
</I>&gt;<i> us to host the server (latency would be higher and less reliable there).
</I>&gt;<i> Experiance in using the old ICQ protocol gave me the same idea, even
</I>&gt;<i> though the amounts of data are *very* limited there.
</I>&gt;<i>
</I>&gt;<i> If latency is your main point for choosing direct link conferencing, I'd
</I>&gt;<i> be very carefull if I were you cause the result might dissappoint in many
</I>&gt;<i> cases.
</I>
Ok but isnt that really an issue with you consuming so much of your outgoing
bandwidth that the TCP replies are having a hard job getting back which
slows down the particular TCP socket, I would expect that we would use a UDP
transport like RTP which wouldnt have this problem as there are no replies
to return in UDP, the packets will just get dropped if there is a problem
and the audio transport should be able to transparently handle this easily.

&gt;<i> &gt;&gt; Now lets talk about out-of-sync mixing. With direct-link based
</I>&gt;<i> &gt;&gt; conferences
</I>&gt;<i> &gt;&gt; every client will produce a different &quot;mix&quot; based on the latency /
</I>&gt;<i> &gt;&gt; bandwith of their connections, and that of the other nodes. This means
</I>&gt;<i> &gt;&gt; when we're in a meeting, for me it can sound like 3 people were talking
</I>&gt;<i> &gt;&gt; at
</I>&gt;<i> &gt;&gt; once, while for you it can sound like they didn't at all. (that means I
</I>&gt;<i> &gt;&gt; didn't hear what they said and I'll ask them to repeat, while you'll be
</I>&gt;<i> &gt;&gt; annoyed with me (even more ;) cause for you it sounded like I could
</I>have
&gt;<i> &gt;&gt; heard perfectly).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sure that could be a problem, but its a problem people will be used to
</I>if
&gt;<i> &gt; they have ever made long distance phone calls, this sort of thing is the
</I>&gt;<i> &gt; least of our worries IMO.
</I>&gt;<i>
</I>&gt;<i> This problem doesn't occur when you make long distance phonecalls..??? How
</I>&gt;<i> could it? It doesn't even happen in a long distance *conference* call!
</I>
Because you will hear yourself echo from the other end, that is I thought
what you meant, but overall I doubt syncing is something we really need to
concentrate on or worry about too much.

&gt;<i> That's not anything like what I am proposing. To start with, practically
</I>&gt;<i> all person to person communication would be over direct links. Secondly,
</I>&gt;<i> conferences would not be held on some gigantic server, rather there will
</I>&gt;<i> be small clusters spread all over the place.
</I>&gt;<i>
</I>&gt;<i> As you might know many p2p network have made this same change, relying
</I>&gt;<i> more on the stronger better clients, letting them take some roles that
</I>&gt;<i> traditionally were meant for servers, Peer caches, supernodes etc.
</I>
If you think supernodes are good then you must like my compromise solution
below, since in the supernode model each supernode commuicates p2p with
other supernodes, and clients talk to the supernodes.

&gt;<i> &gt; Maybe what we actually need to solve the low bandwidth problem of dial
</I>up
&gt;<i> &gt; users and the reliability problem of having a single point of failure is
</I>&gt;<i> &gt; to
</I>&gt;<i> &gt; have a hybrid client server and p2p system where the people with
</I>&gt;<i> &gt; sufficent
</I>&gt;<i> &gt; bandwidth run as both servers and p2p between each other (like the idea
</I>&gt;<i> &gt; of a
</I>&gt;<i> &gt; supernode) and the low bandwidth users connect to one of those servers,
</I>&gt;<i> &gt; it
</I>&gt;<i> &gt; solves the low bandwidth user problem and the reliablity problem by
</I>&gt;<i> &gt; having
</I>&gt;<i> &gt; multiple servers users can switch to if one goes down, and also the CPU
</I>&gt;<i> &gt; usage problem by not having too many people all connected to one server.
</I>&gt;<i>
</I>&gt;<i> In previous email I already briefly touched the subject, and some in this
</I>&gt;<i> email. I definatly think most of this could be handeled in the SI layer
</I>&gt;<i> though (with a little cheating), a c/s based spec will not rule this out
</I>&gt;<i> at all.
</I>
Im not sure how my solution above can be handled in the SI layer, its a
modified version of your model where instead of having a single server you
could have as many as possible which communicate with each other via p2p,
but anyone who is incapable due to platform issues, bandwidth, CPU, firewall
etc to act as a server itself connects to one of these servers, this
provides the benefit of more evenly load balancing the CPU/bandwidth use of
the chat over several nodes rather than concentrating on one, provides
instant fall back to another server if one has problems or leaves, and
provides your primary benefit of being able to support dialup users or
simple clients like pocket pc's or people who cant go p2p because of
firewalls.

Richard


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018339.html">[JDEV] Videoconferencing with jabber / Re:[speex-dev]Videoconferencing with speex and jabber
</A></li>
	<LI>Next message: <A HREF="018351.html">[JDEV] Videoconferencing with jabber / Re:[speex-dev]Videoconferencing with speex and jabber
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18350">[ date ]</a>
              <a href="thread.html#18350">[ thread ]</a>
              <a href="subject.html#18350">[ subject ]</a>
              <a href="author.html#18350">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
