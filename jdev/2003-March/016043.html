<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [JDEV] xdb_ldap problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:jdev%40jabber.org?Subject=%5BJDEV%5D%20xdb_ldap%20problems&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016038.html">
   <LINK REL="Next"  HREF="016042.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[JDEV] xdb_ldap problems</H1>
    <B>LOCK,HUN-YA (HP-Singapore,ex4)</B> 
    <A HREF="mailto:jdev%40jabber.org?Subject=%5BJDEV%5D%20xdb_ldap%20problems&In-Reply-To="
       TITLE="[JDEV] xdb_ldap problems">hun-ya.lock at hp.com
       </A><BR>
    <I>Tue Mar 18 21:42:09 CST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="016038.html">[JDEV] Looking for Java based GroupChat server component.
</A></li>
        <LI>Next message: <A HREF="016042.html">[JDEV] CEBIT 2003
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16043">[ date ]</a>
              <a href="thread.html#16043">[ thread ]</a>
              <a href="subject.html#16043">[ subject ]</a>
              <a href="author.html#16043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, 

I am trying to get jabberd1.4.2 to authenticate against Sun One Directory
Server v 5.1 using xdb_ldap module (latest version off jabberstudio).  I get
2 problems:

1. Authenticating Existing User
===============================
I created a user hylock in the ldap server (uid=hylock, dc=sgp, dc=hp,
dc=com)

When I try to log into jabberd, I get the following debug msg:

--- debug log ---
Wed Mar 19 11:43:00 2003  users.c:143
js_user(<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock at hpstmd151.sgp.hp.com</A>,8137338)
Wed Mar 19 11:43:00 2003  users.c:150 js_user not current
Wed Mar 19 11:43:00 2003  deliver.c:474 DELIVER 2:hpstmd151.sgp.hp.com &lt;xdb
type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock at hpstmd151.sgp.hp.com</A>' from='sessions'
ns='jabber:iq:auth' id='1'/&gt;
Wed Mar 19 11:43:00 2003  deliver.c:678 delivering to instance 'xdb_ldap'
Wed Mar 19 11:43:00 2003  xdb_ldap.c:107 [xdb_ldap_phandler] got &lt;xdb
type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock at hpstmd151.sgp.hp.com</A>' from='sessions'
ns='jabber:iq:auth' id='1'/&gt; (user = hylock) (jid =
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock at hpstmd151.sgp.hp.com</A>) (ns = jabber:iq:auth)
[xdb_ldap_getpasswd] filter is uid=hylock
Wed Mar 19 11:43:00 2003  xdb_ldap_common.c:67 [xdb_ldap_getpasswd]
retrieving data for hylock
Wed Mar 19 11:43:00 2003  mtq 8136B00 starting
Wed Mar 19 11:43:00 2003  mtq 8136B00 leaving to pth
Wed Mar 19 11:43:00 2003  mtq 8136E00 starting
Wed Mar 19 11:43:00 2003  mtq 8136E00 leaving to pth
Wed Mar 19 11:43:00 2003  mtq 81C8CE8 starting
Wed Mar 19 11:43:00 2003  mtq 81C8CE8 leaving to pth
Wed Mar 19 11:43:00 2003  mtq 81D8FF0 starting
Wed Mar 19 11:43:00 2003  mtq 81D8FF0 leaving to pth
Wed Mar 19 11:43:00 2003  xdb_ldap_common.c:101 [xdb_ldap_getpasswd] user
has no password !
Wed Mar 19 11:43:00 2003  xdb_ldap.c:211 [xdb_ldap_phandler] setting an auth
entry
Wed Mar 19 11:43:00 2003  xdb_ldap.c:282 [xdb_ldap_phandler] dispatching
ldap request for (hylock, jabber:iq:auth)
[xdb_ldap_getpasswd] filter is uid=hylock
Wed Mar 19 11:43:00 2003  xdb_ldap_common.c:67 [xdb_ldap_getpasswd]
retrieving data for hylock
Wed Mar 19 11:43:00 2003  xdb_ldap_common.c:101 [xdb_ldap_getpasswd] user
has no password !
Wed Mar 19 11:43:00 2003  deliver.c:474 DELIVER 1:sessions &lt;xdb
type='result' to='sessions' from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock at hpstmd151.sgp.hp.com</A>'
ns='jabber:iq:auth' id='1'&gt;&lt;password&gt;&lt;/password&gt;&lt;/xdb&gt;
Wed Mar 19 11:43:00 2003  deliver.c:678 delivering to instance 'sessions'
Wed Mar 19 11:43:00 2003  xdb.c:52 xdb_results checking xdb packet &lt;xdb
type='result' to='sessions' from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock at hpstmd151.sgp.hp.com</A>'
ns='jabber:iq:auth' id='1'&gt;&lt;password&gt;&lt;/password&gt;&lt;/xdb&gt;
Wed Mar 19 11:43:00 2003  users.c:169 js_user debug 81E9D00 81E9D00
Wed Mar 19 11:43:00 2003  modules.c:135 mapi_call 5
Wed Mar 19 11:43:00 2003  modules.c:158 MAPI 80D6C88
Wed Mar 19 11:43:00 2003  mod_auth_plain checking
Wed Mar 19 11:43:00 2003  modules.c:158 MAPI 80D6D18
Wed Mar 19 11:43:00 2003  mod_auth_digest checking
Wed Mar 19 11:43:00 2003  modules.c:158 MAPI 80D6D70
Wed Mar 19 11:43:00 2003  mod_auth_0k.c:118 checking
Wed Mar 19 11:43:00 2003  deliver.c:474 DELIVER 2:hpstmd151.sgp.hp.com &lt;xdb
type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock at hpstmd151.sgp.hp.com</A>' from='sessions'
ns='jabber:iq:auth:0k' id='2'/&gt;
Wed Mar 19 11:43:00 2003  deliver.c:678 delivering to instance 'xdb_ldap'
Wed Mar 19 11:43:00 2003  xdb_ldap.c:107 [xdb_ldap_phandler] got &lt;xdb
type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock at hpstmd151.sgp.hp.com</A>' from='sessions'
ns='jabber:iq:auth:0k' id='2'/&gt; (user = hylock) (jid =
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock at hpstmd151.sgp.hp.com</A>) (ns = jabber:iq:auth:0k)
[xdb_ldap_getpasswd] filter is uid=hylock
Wed Mar 19 11:43:00 2003  xdb_ldap_common.c:67 [xdb_ldap_getpasswd]
retrieving data for hylock
Wed Mar 19 11:43:00 2003  xdb_ldap_common.c:101 [xdb_ldap_getpasswd] user
has no password !
Wed Mar 19 11:43:00 2003  xdb_ldap.c:211 [xdb_ldap_phandler] setting an auth
entry
Wed Mar 19 11:43:00 2003  xdb_ldap.c:282 [xdb_ldap_phandler] dispatching
ldap request for (hylock, jabber:iq:auth:0k)
jabberd: ../../../libraries/libldap/search.c:100: ldap_search_ext: Assertion
`ld != ((void *)0)' failed.
Wed Mar 19 11:43:00 2003  dnsrv.c:155 dnsrv: Read error on coprocess(29588):
0 Success
Wed Mar 19 11:43:00 2003  dnsrv.c:169 DNSRV CHILD: out of loop.. exiting
normal
--- end debug log ---

And the program aborts.

2. Creating New Users
=====================
When I log into jabberd as a new user, it prompts me to create a new acct
which I agreed and the program exits with Segmentation Fault.

--- debug log ---
Wed Mar 19 11:44:35 2003  deliver.c:474 DELIVER 2:hpstmd151.sgp.hp.com &lt;xdb
type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>' from='sessions'
ns='jabber:iq:auth' id='3'/&gt;
Wed Mar 19 11:44:35 2003  deliver.c:678 delivering to instance 'xdb_ldap'
Wed Mar 19 11:44:35 2003  xdb_ldap.c:107 [xdb_ldap_phandler] got &lt;xdb
type='get' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>' from='sessions'
ns='jabber:iq:auth' id='3'/&gt; (user = hylock1) (jid =
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>) (ns = jabber:iq:auth)
[xdb_ldap_getpasswd] filter is uid=hylock1
Wed Mar 19 11:44:35 2003  xdb_ldap_common.c:67 [xdb_ldap_getpasswd]
retrieving data for hylock1
Wed Mar 19 11:44:35 2003  xdb_ldap_common.c:85 [xdb_ldap_getpasswd] user
does not exist
Wed Mar 19 11:44:35 2003  deliver.c:474 DELIVER 1:sessions &lt;xdb
type='result' to='sessions' from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>'
ns='jabber:iq:auth' id='3'/&gt;
Wed Mar 19 11:44:35 2003  deliver.c:678 delivering to instance 'sessions'
Wed Mar 19 11:44:35 2003  xdb.c:52 xdb_results checking xdb packet &lt;xdb
type='result' to='sessions' from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>'
ns='jabber:iq:auth' id='3'/&gt;
Wed Mar 19 11:44:35 2003  modules.c:135 mapi_call 6
Wed Mar 19 11:44:35 2003  modules.c:158 MAPI 80D5FF8
Wed Mar 19 11:44:35 2003  mod_last storing last for user
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>
Wed Mar 19 11:44:35 2003  deliver.c:474 DELIVER 2:hpstmd151.sgp.hp.com &lt;xdb
type='set' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>' from='sessions'
ns='jabber:iq:last' id='4'&gt;&lt;query xmlns='jabber:iq:last'
last='1048045475'&gt;Registered&lt;/query&gt;&lt;/xdb&gt;
Wed Mar 19 11:44:35 2003  deliver.c:606 delivery failed (Unable to deliver,
destination unknown)
Wed Mar 19 11:44:35 2003  log.c:116 &lt;log type='warn'
from='hpstmd151.sgp.hp.com'&gt;dropping a set xdb request to
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A> for jabber:iq:last&lt;/log&gt;
Wed Mar 19 11:44:35 2003  deliver.c:474 DELIVER 3:hpstmd151.sgp.hp.com &lt;log
type='warn' from='hpstmd151.sgp.hp.com'&gt;dropping a set xdb request to
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A> for jabber:iq:last&lt;/log&gt;
Wed Mar 19 11:44:35 2003  deliver.c:678 delivering to instance 'elogger'
20030319T03:44:35: [warn] (hpstmd151.sgp.hp.com): dropping a set xdb request
to <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A> for jabber:iq:last
Wed Mar 19 11:44:35 2003  log.c:116 &lt;log type='notice'
from='hpstmd151.sgp.hp.com'&gt;bouncing a routed packet to
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A> from sessions: Unable to deliver, destination
unknown&lt;/log&gt;
Wed Mar 19 11:44:35 2003  deliver.c:474 DELIVER 3:hpstmd151.sgp.hp.com &lt;log
type='notice' from='hpstmd151.sgp.hp.com'&gt;bouncing a routed packet to
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A> from sessions: Unable to deliver, destination
unknown&lt;/log&gt;
Wed Mar 19 11:44:35 2003  deliver.c:678 delivering to instance 'elogger'
20030319T03:44:35: [notice] (hpstmd151.sgp.hp.com): bouncing a routed packet
to <A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A> from sessions: Unable to deliver,
destination unknown
Wed Mar 19 11:44:35 2003  deliver.c:474 DELIVER 1:sessions &lt;xdb type='error'
to='sessions' from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>' ns='jabber:iq:last' id='4'
error='Unable to deliver, destination unknown'&gt;&lt;query xmlns='jabber:iq:last'
last='1048045475'&gt;Registered&lt;/query&gt;&lt;/xdb&gt;
Wed Mar 19 11:44:35 2003  deliver.c:678 delivering to instance 'sessions'
Wed Mar 19 11:44:35 2003  xdb.c:52 xdb_results checking xdb packet &lt;xdb
type='error' to='sessions' from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>'
ns='jabber:iq:last' id='4' error='Unable to deliver, destination
unknown'&gt;&lt;query xmlns='jabber:iq:last'
last='1048045475'&gt;Registered&lt;/query&gt;&lt;/xdb&gt;
Wed Mar 19 11:44:35 2003  modules.c:158 MAPI 80D6CE8
Wed Mar 19 11:44:35 2003  mod_auth_plain resetting password
Wed Mar 19 11:44:35 2003  deliver.c:474 DELIVER 2:hpstmd151.sgp.hp.com &lt;xdb
type='set' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>' from='sessions'
ns='jabber:iq:auth' id='5'&gt;&lt;password
xmlns='jabber:iq:auth'&gt;hylock1&lt;/password&gt;&lt;/xdb&gt;
Wed Mar 19 11:44:35 2003  deliver.c:678 delivering to instance 'xdb_ldap'
Wed Mar 19 11:44:35 2003  xdb_ldap.c:107 [xdb_ldap_phandler] got &lt;xdb
type='set' to='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>' from='sessions'
ns='jabber:iq:auth' id='5'&gt;&lt;password
xmlns='jabber:iq:auth'&gt;hylock1&lt;/password&gt;&lt;/xdb&gt; (user = hylock1) (jid =
<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>) (ns = jabber:iq:auth)
[xdb_ldap_getpasswd] filter is uid=hylock1
Wed Mar 19 11:44:35 2003  xdb_ldap_common.c:67 [xdb_ldap_getpasswd]
retrieving data for hylock1
Wed Mar 19 11:44:35 2003  xdb_ldap_common.c:85 [xdb_ldap_getpasswd] user
does not exist
Wed Mar 19 11:44:35 2003  xdb_ldap.c:185 [xdb_ldap_phandler] setting an auth
entry
Wed Mar 19 11:44:35 2003  xdb_ldap.c:282 [xdb_ldap_phandler] dispatching
ldap request for (hylock1, jabber:iq:auth)
Wed Mar 19 11:44:35 2003  xdb_ldap_auth.c:207 [xdbldap_auth_set] now gonna
add an new user in LDAP
Wed Mar 19 11:44:35 2003  xdb_ldap_auth.c:179 [xdb_ldap_auth_set_new] user
successfully added in LDAP
Wed Mar 19 11:44:35 2003  deliver.c:474 DELIVER 1:sessions &lt;xdb
type='result' to='sessions' from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>'
ns='jabber:iq:auth' id='5'&gt;&lt;password
xmlns='jabber:iq:auth'&gt;hylock1&lt;/password&gt;&lt;/xdb&gt;
Wed Mar 19 11:44:35 2003  deliver.c:678 delivering to instance 'sessions'
Wed Mar 19 11:44:35 2003  xdb.c:52 xdb_results checking xdb packet &lt;xdb
type='result' to='sessions' from='<A HREF="http://mail.jabber.org/mailman/listinfo/jdev">hylock1 at hpstmd151.sgp.hp.com</A>'
ns='jabber:iq:auth' id='5'&gt;&lt;password
xmlns='jabber:iq:auth'&gt;hylock1&lt;/password&gt;&lt;/xdb&gt;
Wed Mar 19 11:44:35 2003  modules.c:158 MAPI 80D6DD0
Wed Mar 19 11:44:35 2003  util.c:103 config query
mod_auth_0k/enable_registration
Wed Mar 19 11:44:35 2003  dnsrv.c:155 dnsrv: Read error on coprocess(1): 0
Success
Wed Mar 19 11:44:35 2003  dnsrv.c:169 DNSRV CHILD: out of loop.. exiting
normal
--- end debug log ---

I did notice that it says user sucessfully added but I checked the server
and can't find it.

Any help will be much appreciated.

Thanks very much in advance!!!

best regards
----
LOCK Hun Ya
Consultant
Hewlett-Packard Consulting &amp; Integration
Office Tel: (+65) 6361-3521     HP Telnet: 831-3521
Fax: (+65) 6361-6985

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016038.html">[JDEV] Looking for Java based GroupChat server component.
</A></li>
	<LI>Next message: <A HREF="016042.html">[JDEV] CEBIT 2003
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16043">[ date ]</a>
              <a href="thread.html#16043">[ thread ]</a>
              <a href="subject.html#16043">[ subject ]</a>
              <a href="author.html#16043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mail.jabber.org/mailman/listinfo/jdev">More information about the JDev
mailing list</a><br>
</body></html>
